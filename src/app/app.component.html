<div class="layout">
  <app-header
    [selectedCharacter]="selectedCharacter"
    [savedCharacterNames]="savedCharacterNames"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    [fullHeal]="fullHeal"
    [character]="character"
    [classes]="classes"
    (characterSelected)="onCharacterSelection($event)"
    (deleteCharacter)="deleteCharacter($event)"
    (shortRest)="shortRest()"
    (longRest)="longRest()"
    (fullHealChange)="onFullHealToggle($event)"
    (classSelected)="onHeaderClassSelected($event)"
    (levelChanged)="onHeaderLevelChanged($event)"
  ></app-header>

  @if (isCreatingNewCharacter) {
  <div class="newChar">
    <mat-form-field appearance="fill">
      <mat-label i18n>New Character Name</mat-label>
      <input
        matInput
        [(ngModel)]="newCharacterName"
        placeholder="Enter new character name"
        i18n-placeholder
      />
    </mat-form-field>
    <button mat-raised-button color="primary" (click)="saveNewCharacter()" i18n>
      Save Character
    </button>
  </div>
  }

  <app-hp
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    [percentHP]="percentHP"
    [deathSaveMessage]="deathSaveMessage"
    (characterChange)="onHpCharacterChange()"
    (hurt)="onHurt($event)"
    (heal)="onHeal($event)"
    (maxHpEditFinished)="onMaxHpEditFinished()"
  ></app-hp>

  <div class="body-buttons">
    <button
      mat-stroked-button
      color="primary"
      [disabled]="showingMoney"
      (click)="showingMoney = true"
      i18n
    >
      Money
    </button>
    <button
      mat-stroked-button
      color="primary"
      [disabled]="!showingMoney"
      (click)="showingMoney = false"
      i18n
    >
      Trackable Resources
    </button>
  </div>

  <div class="row money-row" [class.disabled]="isCreatingNewCharacter">
    @if (showingMoney) {
    <app-money
      [character]="character"
      [isCreatingNewCharacter]="isCreatingNewCharacter"
      (characterChange)="updateChar()"
    ></app-money>
    } @if (!showingMoney) {
    <app-resources
      [character]="character"
      [isCreatingNewCharacter]="isCreatingNewCharacter"
      (characterChange)="updateChar()"
    ></app-resources>
    }
  </div>

  @if (character.class === 'Monk') {
  <app-ki-points
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    (characterChange)="updateChar()"
  ></app-ki-points>
  } @if (character.class === 'Druid') {
  <app-wild-shape
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    (characterChange)="updateChar()"
  ></app-wild-shape>
  } @if (character.spellSlots.length > 0) {
  <app-spell-slots
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    (characterChange)="updateChar()"
  ></app-spell-slots>
  } @if (character.class === 'Barbarian') {
  <app-rage
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    (characterChange)="updateChar()"
  ></app-rage>
  }

  <div class="body-buttons">
    <button
      mat-stroked-button
      color="primary"
      [disabled]="showingDeathSaves"
      (click)="showingDeathSaves = true"
      i18n
    >
      Death Saves
    </button>
    <button
      mat-stroked-button
      color="primary"
      [disabled]="!showingDeathSaves"
      (click)="showingDeathSaves = false"
      i18n
    >
      Hit Dice
    </button>
  </div>

  <div>
    @if (showingDeathSaves) {
    <app-death-saves
      [character]="character"
      (deathSaveMessageChange)="deathSaveMessage = $event"
      (characterChange)="updateChar()"
    ></app-death-saves>
    } @if (!showingDeathSaves) {
    <app-hit-dice
      [character]="character"
      [isCreatingNewCharacter]="isCreatingNewCharacter"
      (characterChange)="updateChar()"
    ></app-hit-dice>
    }
  </div>

  <app-language-switcher></app-language-switcher>
</div>
