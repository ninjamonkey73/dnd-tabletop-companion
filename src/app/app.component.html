<div class="layout">
  <app-header
    [selectedCharacter]="selectedCharacter"
    [savedCharacterNames]="savedCharacterNames"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    [fullHeal]="fullHeal"
    [character]="character"
    [classes]="classes"
    (characterSelected)="onCharacterSelection($event)"
    (deleteCharacter)="deleteCharacter($event)"
    (shortRest)="shortRest()"
    (longRest)="longRest()"
    (fullHealChange)="onFullHealToggle($event)"
    (classSelected)="onHeaderClassSelected($event)"
    (levelChanged)="onHeaderLevelChanged($event)"
  ></app-header>

  @if (isCreatingNewCharacter) {
  <div class="newChar">
    <mat-form-field appearance="fill">
      <mat-label i18n>New Character Name</mat-label>
      <input
        matInput
        [(ngModel)]="newCharacterName"
        placeholder="Enter new character name"
        i18n-placeholder
      />
    </mat-form-field>
    <button
      class="save-button"
      mat-raised-button
      color="primary"
      (click)="createNewCharacter()"
      i18n
    >
      Save Character
    </button>
  </div>
  }

  <app-hp
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    [percentHP]="percentHP"
    [deathSaveMessage]="deathSaveMessage"
    [isCharacterLoaded]="isCharacterLoaded"
    (characterChange)="onHpCharacterChange()"
    (hurt)="onHurt($event)"
    (heal)="onHeal($event)"
    (maxHpEditFinished)="onMaxHpEditFinished()"
  ></app-hp>
  <div class="body-buttons">
    <button
      mat-stroked-button
      color="primary"
      [disabled]="showingMoney"
      (click)="showingMoney = true"
      i18n
    >
      Money
    </button>
    <button
      mat-stroked-button
      color="primary"
      [disabled]="!showingMoney"
      (click)="showingMoney = false"
      i18n
    >
      Trackable Resources
    </button>
  </div>

  <div class="row money-row" [class.disabled]="isCreatingNewCharacter">
    @if (showingMoney) {
    <app-money
      [character]="character"
      [isCreatingNewCharacter]="isCreatingNewCharacter"
      (characterChange)="onMoneyChange()"
    ></app-money>
    } @if (!showingMoney) {
    <app-resources
      [character]="character"
      [isCreatingNewCharacter]="isCreatingNewCharacter"
      (characterChange)="onResourcesChange()"
    ></app-resources>
    }
  </div>

  <!-- Stat section toggle: show when 2+ sections available -->
  @if (availableStatSections().length > 1) {
  <div class="body-buttons">
    @if (hasKi()) {
    <button
      mat-stroked-button
      color="primary"
      [disabled]="selectedStatSection === 'ki'"
      (click)="setSelectedStatSection('ki')"
      i18n
    >
      Ki Points
    </button>
    } @if (hasRage()) {
    <button
      mat-stroked-button
      color="primary"
      [disabled]="selectedStatSection === 'rage'"
      (click)="setSelectedStatSection('rage')"
      i18n
    >
      Rage
    </button>
    } @if (hasWild()) {
    <button
      mat-stroked-button
      color="primary"
      [disabled]="selectedStatSection === 'wild'"
      (click)="setSelectedStatSection('wild')"
      i18n
    >
      Wild Shape
    </button>
    } @if (hasSlots()) {
    <button
      mat-stroked-button
      color="primary"
      [disabled]="selectedStatSection === 'slots'"
      (click)="setSelectedStatSection('slots')"
      i18n
    >
      Spell Slots
    </button>
    }
  </div>
  }

  <!-- Render selected stat section only -->
  @if (selectedStatSection === 'ki') {
  <app-ki-points
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    (characterChange)="onKiPointsChange()"
  ></app-ki-points>
  } @if (selectedStatSection === 'wild') {
  <app-wild-shape
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    (characterChange)="onWildShapeChange()"
  ></app-wild-shape>
  } @if (selectedStatSection === 'slots') {
  <app-spell-slots
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    (characterChange)="onSpellSlotsChange()"
    (remainingChanged)="onSpellSlotRemainingChanged($event)"
  ></app-spell-slots>
  } @if (selectedStatSection === 'rage') {
  <app-rage
    [character]="character"
    [isCreatingNewCharacter]="isCreatingNewCharacter"
    (characterChange)="onRageChange()"
  ></app-rage>
  }

  <div class="body-buttons">
    <button
      mat-stroked-button
      color="primary"
      [disabled]="showingDeathSaves"
      (click)="showingDeathSaves = true"
      i18n
    >
      Death Saves
    </button>
    <button
      mat-stroked-button
      color="primary"
      [disabled]="!showingDeathSaves"
      (click)="showingDeathSaves = false"
      i18n
    >
      Hit Dice
    </button>
  </div>

  <div>
    @if (showingDeathSaves) {
    <app-death-saves
      [character]="character"
      (deathSaveMessageChange)="deathSaveMessage = $event"
      (characterChange)="onDeathSavesChange()"
    ></app-death-saves>
    } @if (!showingDeathSaves) {
    <app-hit-dice
      [character]="character"
      [isCreatingNewCharacter]="isCreatingNewCharacter"
      (characterChange)="onHitDieChange()"
    ></app-hit-dice>
    }
  </div>

  <app-language-switcher></app-language-switcher>
</div>
