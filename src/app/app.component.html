<head>
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Goudy+Bookletter+1911&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=snooze"
  />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=bedtime"
  />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=edit"
  />
</head>
<body>
  <div class="layout">
    <div class="language-button-container">
      <a
        mat-stroked-button
        class="language-button"
        [href]="currentLocale === 'es' ? '/' : '/es/'"
        onclick="currentLocale = currentLocale === 'es' ? 'en' : 'es';"
      >
        {{ currentLocale === "es" ? "Ingl√©s" : "Spanish" }}
      </a>
    </div>
    <div mat-card class="card-container">
      <div class="row top">
        <div class="button-container">
          <button
            mat-fab
            extended
            class="rest-button"
            (click)="shortRest()"
            matTooltip="Short Rest"
            i18n-matTooltip
            i18n
          >
            <mat-icon>snooze</mat-icon>
            SR
          </button>
        </div>
        <div class="char-select-container">
          <mat-form-field appearance="fill" class="charName">
            <mat-label i18n>Character Name</mat-label>
            <mat-select
              [(ngModel)]="selectedCharacter"
              (selectionChange)="onCharacterSelection($event.value)"
              [disabled]="isCreatingNewCharacter"
            >
              <mat-option
                *ngFor="let name of savedCharacterNames"
                [value]="name"
              >
                {{ name }}
              </mat-option>
              <mat-option i18n value="new">New Character</mat-option>
            </mat-select>
          </mat-form-field>
          <button
            mat-icon-button
            color="warn"
            class="delete-icon"
            [disabled]="
              !selectedCharacter ||
              selectedCharacter === 'new' ||
              isCreatingNewCharacter
            "
            (click)="deleteCharacter(selectedCharacter)"
            [attr.aria-label]="'delete character ' + selectedCharacter"
            i18n-aria-label
          >
            <mat-icon i18n-matTooltip matTooltip="Delete Character"
              >delete</mat-icon
            >
          </button>
        </div>
        <div class="longRest">
          <div class="long-rest-toggle">
            <mat-slide-toggle
              [(ngModel)]="fullHeal"
              (change)="saveHealToggle()"
              [attr.aria-label]="'long rest heals'"
              i18n-aria-label
              i18n
              >LR Heals</mat-slide-toggle
            >
          </div>
        </div>
        <div class="button-container">
          <button
            mat-fab
            extended
            class="rest-button"
            (click)="longRest()"
            matTooltip="Long Rest"
            i18n-matTooltip
            i18n
          >
            <mat-icon class="longRest">bedtime</mat-icon>
            LR
          </button>
        </div>
      </div>
      @if (isCreatingNewCharacter) {
      <div class="newChar">
        <mat-form-field appearance="fill">
          <mat-label i18n>New Character Name</mat-label>
          <input
            matInput
            [(ngModel)]="newCharacterName"
            placeholder="Enter new character name"
            i18n-placeholder
          />
        </mat-form-field>
        <button
          mat-raised-button
          color="primary"
          (click)="saveNewCharacter()"
          i18n
        >
          Save Character
        </button>
      </div>
      }
      <div class="row form-row">
        <mat-form-field class="classLevel">
          <mat-label i18n>Character Class</mat-label>
          <mat-select
            id="class"
            [(ngModel)]="character.class"
            (selectionChange)="onClassSelection($event.value)"
            [disabled]="isCreatingNewCharacter"
          >
            @for (class of classes; track class) {
            <mat-option [value]="class">
              {{ class }}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field class="classLevel">
          <mat-label i18n>Character Level</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="character.level"
            min="1"
            max="20"
            placeholder="Enter Level"
            (change)="updateCharLevel()"
            (blur)="updateCharLevel()"
            [disabled]="isCreatingNewCharacter"
            i18n-placeholder
            [attr.aria-label]="'character level for ' + character.name"
            i18n-aria-label
          />
        </mat-form-field>
      </div>
      <div class="row hp-row" [class.disabled]="isCreatingNewCharacter">
        <mat-card-title i18n class="card-title">Hit Points</mat-card-title>
        <div class="status-key">
          @if (character.currentHP == 0 && character.stable == true) {
          <span i18n class="stable">You are stable</span>
          } @if (deathSaveMessage) {
          <div class="incapacitated">{{ deathSaveMessage }}</div>
          } @if (character.currentHP == 0 && character.stable == false &&
          !deathSaveMessage) {
          <span i18n class="incapacitated">You are incapacitated</span>
          }
        </div>
        <mat-card-content>
          <div class="hp-table">
            <div class="hp-header">
              <div i18n>Current HP</div>
              <div class="maxHP-header">
                <span i18n>Max HP</span>
                <button
                  class="edit"
                  mat-fab
                  extended
                  (click)="editMaxHP()"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Edit Max HP"
                  [attr.aria-label]="'edit max HP for ' + character.name"
                  i18n-aria-label
                  i18n-matTooltip
                >
                  <mat-icon>edit</mat-icon>
                </button>
              </div>
              <div i18n>Temp HP</div>
              <div i18n>% of Max</div>
            </div>
            <div class="hpRow">
              <div class="currentHP">
                {{ character.currentHP }}
                @if (character.currentHP == 0 && character.stable == true) {
                <span class="stable-icon">
                  <!-- The letter inside the square -->
                  <span i18n="Letter for stable health">S</span>
                </span>
                } @if (character.currentHP == 0 && character.stable == false &&
                deathSaveMessage == null) {
                <span class="incapacitated-icon">
                  <!-- The letter inside the square -->
                  <span i18n="Letter for incapacitated">I</span>
                </span>
                } @if (deathSaveMessage) {
                <span class="incapacitated-icon">
                  <!-- The letter inside the square -->
                  <span i18n="Letter for dead">D</span>
                </span>
                }
              </div>
              <div>
                <ng-container *ngIf="isEditingMaxHP; else displayMaxHP">
                  <input
                    matInput
                    type="number"
                    [(ngModel)]="character.maxHP"
                    class="hp-input"
                    placeholder="Enter Max HP"
                    (keydown.enter)="onEnterMaxHP()"
                    [disabled]="isCreatingNewCharacter"
                    i18n-placeholder
                    [attr.aria-label]="'max HP for ' + character.name"
                    i18n-aria-label
                  />
                </ng-container>
                <ng-template #displayMaxHP>
                  {{ character.maxHP }}
                </ng-template>
              </div>
              <div>
                <input
                  matInput
                  type="number"
                  [(ngModel)]="character.tempHP"
                  class="tempHP-input"
                  placeholder="Enter Temp HP"
                  (keydown.enter)="updateChar()"
                  [disabled]="isCreatingNewCharacter"
                  i18n-placeholder
                  [attr.aria-label]="'temp HP for ' + character.name"
                  i18n-aria-label
                />
              </div>
              <div>{{ percentHP }}%</div>
            </div>
          </div>
          <div
            class="hp-controls hp-controls-flex"
            [class.disabled]="isCreatingNewCharacter"
          >
            <div class="hp-controls-flex-row">
              <mat-form-field appearance="fill" class="HPInput">
                <input
                  matInput
                  placeholder="HP to +/-"
                  type="number"
                  [(ngModel)]="changeVal"
                  class="hp-input"
                  [disabled]="isCreatingNewCharacter"
                />
              </mat-form-field>
              <div class="hp-button-stack">
                <button
                  mat-fab
                  extended
                  class="hurt-button"
                  (click)="hurt()"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Apply Damage"
                  [attr.aria-label]="'apply damage to ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                  i18n
                >
                  <mat-icon>remove</mat-icon>
                  Hurt
                </button>
                <button
                  mat-fab
                  extended
                  class="heal-button"
                  (click)="heal()"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Heal Character"
                  [attr.aria-label]="'heal ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                  i18n
                >
                  <mat-icon>add</mat-icon>
                  Heal
                </button>
              </div>
            </div>
          </div>
        </mat-card-content>
      </div>
    </div>
    <div class="body-buttons">
      <button
        mat-stroked-button
        color="primary"
        [disabled]="showingMoney"
        (click)="showingMoney = true"
        i18n
      >
        Money
      </button>
      <button
        mat-stroked-button
        color="primary"
        [disabled]="!showingMoney"
        (click)="showingMoney = false"
        i18n
      >
        Trackable Resources
      </button>
    </div>
    <div class="row money-row" [class.disabled]="isCreatingNewCharacter">
      @if (showingMoney) {
      <mat-card-content>
        <div class="money-flex">
          <mat-form-field appearance="fill" class="money-input">
            <mat-label i18n>Coin +/-</mat-label>
            <input
              matInput
              type="number"
              [(ngModel)]="money"
              class="money-input"
              (focus)="selectMoneyInput($event)"
              [disabled]="isCreatingNewCharacter"
            />
          </mat-form-field>
          <div class="money-display-stack">
            <div class="money-display-col">
              <mat-form-field appearance="fill" class="coins">
                <mat-label i18n>Copper</mat-label>
                <input
                  matInput
                  [value]="character.cp"
                  class="cp-input"
                  readonly
                  tabindex="-1"
                  [disabled]="isCreatingNewCharacter"
                />
              </mat-form-field>
              <div class="money-buttons">
                <button
                  mat-mini-button
                  class="sub"
                  (click)="adjustMoney('cp', -money)"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Subtract Copper"
                  [attr.aria-label]="'subtract copper from ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                >
                  <mat-icon>remove</mat-icon>
                </button>
                <button
                  mat-mini-button
                  class="add"
                  (click)="adjustMoney('cp', money)"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Add Copper"
                  [attr.aria-label]="'add copper to ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                >
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
            <div class="money-display-col">
              <mat-form-field appearance="fill" class="coins">
                <mat-label i18n>Silver</mat-label>
                <input
                  matInput
                  [value]="character.sp"
                  class="sp-input"
                  readonly
                  tabindex="-1"
                  [disabled]="isCreatingNewCharacter"
                />
              </mat-form-field>
              <div class="money-buttons">
                <button
                  mat-mini-button
                  class="sub"
                  (click)="adjustMoney('sp', -money)"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Subtract Silver"
                  [attr.aria-label]="'subtract silver from ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                >
                  <mat-icon>remove</mat-icon>
                </button>
                <button
                  mat-mini-button
                  class="add"
                  (click)="adjustMoney('sp', money)"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Add Silver"
                  [attr.aria-label]="'add silver to ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                >
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
            <div class="money-display-col">
              <mat-form-field appearance="fill" class="coins">
                <mat-label i18n>Gold</mat-label>
                <input
                  matInput
                  [value]="character.gp"
                  class="gp-input"
                  readonly
                  tabindex="-1"
                  [disabled]="isCreatingNewCharacter"
                />
              </mat-form-field>
              <div class="money-buttons">
                <button
                  mat-mini-button
                  class="sub"
                  (click)="adjustMoney('gp', -money)"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Subtract Gold"
                  [attr.aria-label]="'subtract gold from ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                >
                  <mat-icon>remove</mat-icon>
                </button>
                <button
                  mat-mini-button
                  class="add"
                  (click)="adjustMoney('gp', money)"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Add Gold"
                  [attr.aria-label]="'add gold to ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                >
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
            <div class="money-display-col">
              <mat-form-field appearance="fill" class="coins">
                <mat-label i18n>Platinum</mat-label>
                <input
                  matInput
                  [value]="character.pp"
                  class="pp-input"
                  readonly
                  tabindex="-1"
                  [disabled]="isCreatingNewCharacter"
                />
              </mat-form-field>
              <div class="money-buttons">
                <button
                  mat-mini-button
                  class="sub"
                  (click)="adjustMoney('pp', -money)"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Subtract Platinum"
                  [attr.aria-label]="'subtract platinum from ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                >
                  <mat-icon>remove</mat-icon>
                </button>
                <button
                  mat-mini-button
                  class="add"
                  (click)="adjustMoney('pp', money)"
                  [disabled]="isCreatingNewCharacter"
                  matTooltip="Add Platinum"
                  [attr.aria-label]="'add platinum to ' + character.name"
                  i18n-matTooltip
                  i18n-aria-label
                >
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
      } @if (!showingMoney) {
      <mat-card-content>
        <div class="resources">
          @for (record of character.resources; track record.id ) {
          <mat-form-field subscriptSizing="dynamic" class="resource-name">
            <div class="resource-name">
              <input
                matInput
                type="text"
                [(ngModel)]="record.name"
                placeholder="Resource Name"
                [readonly]="editingResourceNameId !== record.id"
                [disabled]="isCreatingNewCharacter"
                (blur)="stopEditingResourceName()"
                i18n-placeholder
              />
              <button
                mat-icon-button
                type="button"
                (click)="startEditingResourceName(record.id)"
                [disabled]="isCreatingNewCharacter"
                [attr.aria-label]="'edit resource name for ' + record.name"
                i18n-aria-label
              >
                <mat-icon>edit</mat-icon>
              </button>
            </div>
          </mat-form-field>
          } @for (record of character.resources; track record.id ) {
          <mat-form-field>
            <input
              matInput
              type="number"
              min="0"
              [(ngModel)]="record.value"
              class="classData-input"
              (change)="updateChar()"
              [disabled]="isCreatingNewCharacter"
              [attr.aria-label]="'resource value for ' + record.name"
              i18n-aria-label
            />
          </mat-form-field>
          }
        </div>
      </mat-card-content>
      }
    </div>
    @if (character.class === "Monk") {
    <div>
      <div mat-card>
        <mat-card-title class="card-title" style="font-size: x-large" i18n
          >Ki Points</mat-card-title
        >
        <br />
        <mat-form-field appearance="fill" class="classData-input">
          <input
            matInput
            type="number"
            min="0"
            max="{{ character.level }}"
            [(ngModel)]="character.kiPoints"
            class="classData-input"
            (change)="updateChar()"
            [disabled]="isCreatingNewCharacter"
            [attr.aria-label]="'ki points for ' + character.name"
            i18n-aria-label
          />
        </mat-form-field>
      </div>
    </div>
    } @if (character.class === "Druid") {
    <div>
      <div mat-card>
        <mat-card-title class="card-title" style="font-size: x-large" i18n
          >Wild Shape</mat-card-title
        >
        <br />
        <mat-form-field appearance="fill" class="classData-input">
          <input
            matInput
            type="number"
            min="0"
            max="2"
            [(ngModel)]="character.wildShapeRemaining"
            class="classData-input"
            (change)="updateChar()"
            [disabled]="isCreatingNewCharacter"
            [attr.aria-label]="'wild shapes for ' + character.name"
            i18n-aria-label
          />
        </mat-form-field>
      </div>
    </div>
    } @if (character.spellSlots.length > 0) {
    <div>
      <div mat-card>
        <mat-card-title class="card-title" style="font-size: x-large" i18n
          >Spell Slots</mat-card-title
        >
        <br />
        <div class="spellSlots">
          @for (slot of character.spellSlots; track $index) { @if (slot > 0) {
          <mat-form-field appearance="fill" class="classData-input">
            <mat-label i18n>Level {{ $index + 1 }}</mat-label>
            <input
              matInput
              type="number"
              min="0"
              max="{{ slot }}"
              [(ngModel)]="character.spellSlotsRemaining[$index]"
              class="classData-input"
              (change)="updateChar()"
              [disabled]="isCreatingNewCharacter"
              [attr.aria-label]="
                'spell slots remaining for level ' +
                ($index + 1) +
                ' for ' +
                character.name
              "
              i18n-aria-label
            />
          </mat-form-field>
          } }
        </div>
      </div>
    </div>
    } @if (character.class === "Barbarian") {
    <div>
      <div mat-card>
        <mat-card-title class="card-title" style="font-size: x-large" i18n
          >Rage</mat-card-title
        >
        <br />
        <mat-form-field appearance="fill" class="classData-input">
          <input
            matInput
            type="number"
            min="0"
            max="{{ character.rage }}"
            [(ngModel)]="character.rageRemaining"
            class="classData-input"
            (change)="updateChar()"
            [disabled]="isCreatingNewCharacter"
            [attr.aria-label]="'rages for ' + character.name"
            i18n-aria-label
          />
        </mat-form-field>
      </div>
    </div>
    }
    <!-- Death Saves & Hit Dice Toggle Area -->
    <div class="body-buttons">
      <button
        mat-stroked-button
        color="primary"
        [disabled]="showingDeathSaves"
        (click)="showingDeathSaves = true"
        i18n
      >
        Death Saves
      </button>
      <button
        mat-stroked-button
        color="primary"
        [disabled]="!showingDeathSaves"
        (click)="showingDeathSaves = false"
        i18n
      >
        Hit Dice
      </button>
    </div>
    <div>
      @if (showingDeathSaves) {
      <div class="death-save-row">
        <div class="death-save-header" i18n>Death Saves</div>
        <div class="death-save-labels">
          <span i18n>Successes</span>
          <span i18n>Failures</span>
        </div>
        <div class="death-save-buttons">
          <div class="death-save-group">
            @for (s of [0, 1, 2]; track s) {
            <button
              class="success"
              mat-icon-button
              (click)="toggleDeathSave('success', s)"
              [attr.aria-label]="'toggle death save success ' + s"
              i18n-aria-label
            >
              <mat-icon [class]="deathSaveSuccess[s] ? 'checked' : 'unchecked'">
                {{
                  deathSaveSuccess[s]
                    ? "check_circle"
                    : "radio_button_unchecked"
                }}
              </mat-icon>
            </button>
            }
          </div>
          <div class="death-save-group">
            @for (f of [0, 1, 2]; track f) {
            <button
              class="failure"
              mat-icon-button
              [class.active-class]="{ 'active-failure': deathSaveFailure[f] }"
              (click)="toggleDeathSave('failure', f)"
              [attr.aria-label]="'toggle death save failure ' + f"
              i18n-aria-label
            >
              <mat-icon [class]="deathSaveFailure[f] ? 'checked' : 'unchecked'">
                {{ deathSaveFailure[f] ? "cancel" : "radio_button_unchecked" }}
              </mat-icon>
            </button>
            }
          </div>
        </div>
      </div>
      } @if (!showingDeathSaves) {
      <div mat-card>
        <mat-card-title class="card-title" style="font-size: x-large" i18n
          >Hit Dice</mat-card-title
        >
        <br />
        <mat-form-field appearance="fill" class="classData-input">
          <input
            matInput
            type="number"
            min="0"
            max="{{ character.level }}"
            [(ngModel)]="character.hitDie"
            class="classData-input"
            (change)="updateChar()"
            [disabled]="isCreatingNewCharacter"
            [attr.aria-label]="'hit dice for ' + character.name"
            i18n-aria-label
          />
        </mat-form-field>
      </div>
      }
    </div>
  </div>
</body>
