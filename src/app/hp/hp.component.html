<div class="hp-section" [class.disabled]="isCreatingNewCharacter()">
  <div class="card-title">Hit Points</div>

  @if ((deathSaveMessage() || character().currentHP === 0) &&
  isCharacterLoaded()) {
  <div class="status-key">
    @if (deathSaveMessage()) {
    <div class="death-message" aria-live="polite">{{ deathSaveMessage() }}</div>
    } @else if (character().currentHP === 0 && character().stable) {
    <span class="status-chip stable-chip">You are stable</span>
    } @else if (character().currentHP === 0 && !character().stable) {
    <span class="status-chip incapacitated-chip">You are incapacitated</span>
    }
  </div>
  }

  <div class="hp-table">
    <div class="hp-header">
      <div>Current HP</div>
      <div class="maxHP-header">
        <span>Max HP</span>
        <button
          class="edit"
          mat-fab
          extended
          (click)="isEditingMaxHP ? finishEditMaxHP() : startEditMaxHP()"
          [disabled]="isCreatingNewCharacter()"
          matTooltip="Edit Max HP"
          [attr.aria-label]="'edit max HP for ' + character().name"
        >
          <mat-icon>edit</mat-icon>
        </button>
      </div>
      <div>Temp HP</div>
      <div>% of Max</div>
    </div>

    <div class="hpRow">
      <div class="currentHP">
        {{ character().currentHP }}
        @if (deathSaveMessage()) {
        <span class="incapacitated-icon"><span>D</span></span>
        } @else if (isCharacterLoaded() && character().currentHP === 0 &&
        character().stable) {
        <span class="stable-icon"><span>S</span></span>
        } @else if (isCharacterLoaded() && character().currentHP === 0 &&
        !character().stable) {
        <span class="incapacitated-icon"><span>I</span></span>
        }
      </div>

      <div>
        @if (isEditingMaxHP) {
        <input
          matInput
          type="number"
          [(ngModel)]="character().maxHP"
          class="hp-input"
          placeholder="Enter Max HP"
          (keydown.enter)="onEnterMaxHP()"
          [disabled]="isCreatingNewCharacter()"
          [attr.aria-label]="'max HP for ' + character().name"
        />
        } @else {
        {{ character().maxHP }}
        }
      </div>

      <div>
        <input
          matInput
          type="number"
          [(ngModel)]="character().tempHP"
          class="tempHP-input"
          placeholder="Enter Temp HP"
          (keydown.enter)="onTempHpEnter()"
          (ngModelChange)="onTempHpChange()"
          (blur)="onTempHpEnter()"
          [disabled]="isCreatingNewCharacter()"
          [attr.aria-label]="'temp HP for ' + character().name"
        />
      </div>

      <div>{{ percentHP() }}%</div>
    </div>
  </div>

  <div class="hp-controls" [class.disabled]="isCreatingNewCharacter()">
    <mat-form-field appearance="fill" class="HPInput">
      <input
        matInput
        placeholder="HP to +/-"
        type="number"
        [(ngModel)]="changeVal"
        class="hp-input"
        [disabled]="isCreatingNewCharacter() || character().maxHP === 0"
      />
    </mat-form-field>

    <div class="hp-button-stack">
      <button
        mat-fab
        extended
        class="hurt-button"
        (click)="applyHurt()"
        [disabled]="isCreatingNewCharacter() || character().maxHP === 0"
        matTooltip="Apply Damage"
        [attr.aria-label]="'apply damage to ' + character().name"
      >
        <mat-icon>remove</mat-icon>
        Hurt
      </button>
      <button
        mat-fab
        extended
        class="heal-button"
        (click)="applyHeal()"
        [disabled]="isCreatingNewCharacter() || character().maxHP === 0"
        matTooltip="Heal Character"
        [attr.aria-label]="'heal ' + character().name"
      >
        <mat-icon>add</mat-icon>
        Heal
      </button>
    </div>
  </div>
</div>
