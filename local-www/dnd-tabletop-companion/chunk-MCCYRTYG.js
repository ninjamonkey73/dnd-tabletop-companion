import{$ as jh,C as On,H as gt,I as sp,J as Fh,K as ip,L as Yt,M as Lh,N as op,U as qh,V as Ea,W as Uh,Z as Bh,a as Gt,b as ya,ca as Gh,d as li,f as _a,fa as va,g as V,i as xh,ia as ap,k as Dh,m as hi,n as wa,o as Nh,p as kh,q as $r,w as Ta,x as Ia,y as Mh,z as Oh}from"./chunk-INIVCUJM.js";var zh,Kh,ce,Aa,$h=li(()=>{"use strict";zh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Kh={};(function(){var r;function t(T,p){function w(){}w.prototype=p.prototype,T.F=p.prototype,T.prototype=new w,T.prototype.constructor=T,T.D=function(E,I,S){for(var _=Array(arguments.length-2),kt=2;kt<arguments.length;kt++)_[kt-2]=arguments[kt];return p.prototype[I].apply(E,_)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(n,e),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,p,w){w||(w=0);let E=Array(16);if(typeof p=="string")for(var I=0;I<16;++I)E[I]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(I=0;I<16;++I)E[I]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=T.g[0],w=T.g[1],I=T.g[2];let S=T.g[3],_;_=p+(S^w&(I^S))+E[0]+3614090360&4294967295,p=w+(_<<7&4294967295|_>>>25),_=S+(I^p&(w^I))+E[1]+3905402710&4294967295,S=p+(_<<12&4294967295|_>>>20),_=I+(w^S&(p^w))+E[2]+606105819&4294967295,I=S+(_<<17&4294967295|_>>>15),_=w+(p^I&(S^p))+E[3]+3250441966&4294967295,w=I+(_<<22&4294967295|_>>>10),_=p+(S^w&(I^S))+E[4]+4118548399&4294967295,p=w+(_<<7&4294967295|_>>>25),_=S+(I^p&(w^I))+E[5]+1200080426&4294967295,S=p+(_<<12&4294967295|_>>>20),_=I+(w^S&(p^w))+E[6]+2821735955&4294967295,I=S+(_<<17&4294967295|_>>>15),_=w+(p^I&(S^p))+E[7]+4249261313&4294967295,w=I+(_<<22&4294967295|_>>>10),_=p+(S^w&(I^S))+E[8]+1770035416&4294967295,p=w+(_<<7&4294967295|_>>>25),_=S+(I^p&(w^I))+E[9]+2336552879&4294967295,S=p+(_<<12&4294967295|_>>>20),_=I+(w^S&(p^w))+E[10]+4294925233&4294967295,I=S+(_<<17&4294967295|_>>>15),_=w+(p^I&(S^p))+E[11]+2304563134&4294967295,w=I+(_<<22&4294967295|_>>>10),_=p+(S^w&(I^S))+E[12]+1804603682&4294967295,p=w+(_<<7&4294967295|_>>>25),_=S+(I^p&(w^I))+E[13]+4254626195&4294967295,S=p+(_<<12&4294967295|_>>>20),_=I+(w^S&(p^w))+E[14]+2792965006&4294967295,I=S+(_<<17&4294967295|_>>>15),_=w+(p^I&(S^p))+E[15]+1236535329&4294967295,w=I+(_<<22&4294967295|_>>>10),_=p+(I^S&(w^I))+E[1]+4129170786&4294967295,p=w+(_<<5&4294967295|_>>>27),_=S+(w^I&(p^w))+E[6]+3225465664&4294967295,S=p+(_<<9&4294967295|_>>>23),_=I+(p^w&(S^p))+E[11]+643717713&4294967295,I=S+(_<<14&4294967295|_>>>18),_=w+(S^p&(I^S))+E[0]+3921069994&4294967295,w=I+(_<<20&4294967295|_>>>12),_=p+(I^S&(w^I))+E[5]+3593408605&4294967295,p=w+(_<<5&4294967295|_>>>27),_=S+(w^I&(p^w))+E[10]+38016083&4294967295,S=p+(_<<9&4294967295|_>>>23),_=I+(p^w&(S^p))+E[15]+3634488961&4294967295,I=S+(_<<14&4294967295|_>>>18),_=w+(S^p&(I^S))+E[4]+3889429448&4294967295,w=I+(_<<20&4294967295|_>>>12),_=p+(I^S&(w^I))+E[9]+568446438&4294967295,p=w+(_<<5&4294967295|_>>>27),_=S+(w^I&(p^w))+E[14]+3275163606&4294967295,S=p+(_<<9&4294967295|_>>>23),_=I+(p^w&(S^p))+E[3]+4107603335&4294967295,I=S+(_<<14&4294967295|_>>>18),_=w+(S^p&(I^S))+E[8]+1163531501&4294967295,w=I+(_<<20&4294967295|_>>>12),_=p+(I^S&(w^I))+E[13]+2850285829&4294967295,p=w+(_<<5&4294967295|_>>>27),_=S+(w^I&(p^w))+E[2]+4243563512&4294967295,S=p+(_<<9&4294967295|_>>>23),_=I+(p^w&(S^p))+E[7]+1735328473&4294967295,I=S+(_<<14&4294967295|_>>>18),_=w+(S^p&(I^S))+E[12]+2368359562&4294967295,w=I+(_<<20&4294967295|_>>>12),_=p+(w^I^S)+E[5]+4294588738&4294967295,p=w+(_<<4&4294967295|_>>>28),_=S+(p^w^I)+E[8]+2272392833&4294967295,S=p+(_<<11&4294967295|_>>>21),_=I+(S^p^w)+E[11]+1839030562&4294967295,I=S+(_<<16&4294967295|_>>>16),_=w+(I^S^p)+E[14]+4259657740&4294967295,w=I+(_<<23&4294967295|_>>>9),_=p+(w^I^S)+E[1]+2763975236&4294967295,p=w+(_<<4&4294967295|_>>>28),_=S+(p^w^I)+E[4]+1272893353&4294967295,S=p+(_<<11&4294967295|_>>>21),_=I+(S^p^w)+E[7]+4139469664&4294967295,I=S+(_<<16&4294967295|_>>>16),_=w+(I^S^p)+E[10]+3200236656&4294967295,w=I+(_<<23&4294967295|_>>>9),_=p+(w^I^S)+E[13]+681279174&4294967295,p=w+(_<<4&4294967295|_>>>28),_=S+(p^w^I)+E[0]+3936430074&4294967295,S=p+(_<<11&4294967295|_>>>21),_=I+(S^p^w)+E[3]+3572445317&4294967295,I=S+(_<<16&4294967295|_>>>16),_=w+(I^S^p)+E[6]+76029189&4294967295,w=I+(_<<23&4294967295|_>>>9),_=p+(w^I^S)+E[9]+3654602809&4294967295,p=w+(_<<4&4294967295|_>>>28),_=S+(p^w^I)+E[12]+3873151461&4294967295,S=p+(_<<11&4294967295|_>>>21),_=I+(S^p^w)+E[15]+530742520&4294967295,I=S+(_<<16&4294967295|_>>>16),_=w+(I^S^p)+E[2]+3299628645&4294967295,w=I+(_<<23&4294967295|_>>>9),_=p+(I^(w|~S))+E[0]+4096336452&4294967295,p=w+(_<<6&4294967295|_>>>26),_=S+(w^(p|~I))+E[7]+1126891415&4294967295,S=p+(_<<10&4294967295|_>>>22),_=I+(p^(S|~w))+E[14]+2878612391&4294967295,I=S+(_<<15&4294967295|_>>>17),_=w+(S^(I|~p))+E[5]+4237533241&4294967295,w=I+(_<<21&4294967295|_>>>11),_=p+(I^(w|~S))+E[12]+1700485571&4294967295,p=w+(_<<6&4294967295|_>>>26),_=S+(w^(p|~I))+E[3]+2399980690&4294967295,S=p+(_<<10&4294967295|_>>>22),_=I+(p^(S|~w))+E[10]+4293915773&4294967295,I=S+(_<<15&4294967295|_>>>17),_=w+(S^(I|~p))+E[1]+2240044497&4294967295,w=I+(_<<21&4294967295|_>>>11),_=p+(I^(w|~S))+E[8]+1873313359&4294967295,p=w+(_<<6&4294967295|_>>>26),_=S+(w^(p|~I))+E[15]+4264355552&4294967295,S=p+(_<<10&4294967295|_>>>22),_=I+(p^(S|~w))+E[6]+2734768916&4294967295,I=S+(_<<15&4294967295|_>>>17),_=w+(S^(I|~p))+E[13]+1309151649&4294967295,w=I+(_<<21&4294967295|_>>>11),_=p+(I^(w|~S))+E[4]+4149444226&4294967295,p=w+(_<<6&4294967295|_>>>26),_=S+(w^(p|~I))+E[11]+3174756917&4294967295,S=p+(_<<10&4294967295|_>>>22),_=I+(p^(S|~w))+E[2]+718787259&4294967295,I=S+(_<<15&4294967295|_>>>17),_=w+(S^(I|~p))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+p&4294967295,T.g[1]=T.g[1]+(I+(_<<21&4294967295|_>>>11))&4294967295,T.g[2]=T.g[2]+I&4294967295,T.g[3]=T.g[3]+S&4294967295}n.prototype.v=function(T,p){p===void 0&&(p=T.length);let w=p-this.blockSize,E=this.C,I=this.h,S=0;for(;S<p;){if(I==0)for(;S<=w;)s(this,T,S),S+=this.blockSize;if(typeof T=="string"){for(;S<p;)if(E[I++]=T.charCodeAt(S++),I==this.blockSize){s(this,E),I=0;break}}else for(;S<p;)if(E[I++]=T[S++],I==this.blockSize){s(this,E),I=0;break}}this.h=I,this.o+=p},n.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var p=1;p<T.length-8;++p)T[p]=0;p=this.o*8;for(var w=T.length-8;w<T.length;++w)T[w]=p&255,p/=256;for(this.v(T),T=Array(16),p=0,w=0;w<4;++w)for(let E=0;E<32;E+=8)T[p++]=this.g[w]>>>E&255;return T};function i(T,p){var w=u;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=p(T)}function a(T,p){this.h=p;let w=[],E=!0;for(let I=T.length-1;I>=0;I--){let S=T[I]|0;E&&S==p||(w[I]=S,E=!1)}this.g=w}var u={};function c(T){return-128<=T&&T<128?i(T,function(p){return new a([p|0],p<0?-1:0)}):new a([T|0],T<0?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return g;if(T<0)return D(h(-T));let p=[],w=1;for(let E=0;T>=w;E++)p[E]=T/w|0,w*=4294967296;return new a(p,0)}function f(T,p){if(T.length==0)throw Error("number format error: empty string");if(p=p||10,p<2||36<p)throw Error("radix out of range: "+p);if(T.charAt(0)=="-")return D(f(T.substring(1),p));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');let w=h(Math.pow(p,8)),E=g;for(let S=0;S<T.length;S+=8){var I=Math.min(8,T.length-S);let _=parseInt(T.substring(S,S+I),p);I<8?(I=h(Math.pow(p,I)),E=E.j(I).add(h(_))):(E=E.j(w),E=E.add(h(_)))}return E}var g=c(0),y=c(1),R=c(16777216);r=a.prototype,r.m=function(){if(x(this))return-D(this).m();let T=0,p=1;for(let w=0;w<this.g.length;w++){let E=this.i(w);T+=(E>=0?E:4294967296+E)*p,p*=4294967296}return T},r.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(k(this))return"0";if(x(this))return"-"+D(this).toString(T);let p=h(Math.pow(T,6));var w=this;let E="";for(;;){let I=Z(w,p).g;w=U(w,I.j(p));let S=((w.g.length>0?w.g[0]:w.h)>>>0).toString(T);if(w=I,k(w))return S+E;for(;S.length<6;)S="0"+S;E=S+E}},r.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function k(T){if(T.h!=0)return!1;for(let p=0;p<T.g.length;p++)if(T.g[p]!=0)return!1;return!0}function x(T){return T.h==-1}r.l=function(T){return T=U(this,T),x(T)?-1:k(T)?0:1};function D(T){let p=T.g.length,w=[];for(let E=0;E<p;E++)w[E]=~T.g[E];return new a(w,~T.h).add(y)}r.abs=function(){return x(this)?D(this):this},r.add=function(T){let p=Math.max(this.g.length,T.g.length),w=[],E=0;for(let I=0;I<=p;I++){let S=E+(this.i(I)&65535)+(T.i(I)&65535),_=(S>>>16)+(this.i(I)>>>16)+(T.i(I)>>>16);E=_>>>16,S&=65535,_&=65535,w[I]=_<<16|S}return new a(w,w[w.length-1]&-2147483648?-1:0)};function U(T,p){return T.add(D(p))}r.j=function(T){if(k(this)||k(T))return g;if(x(this))return x(T)?D(this).j(D(T)):D(D(this).j(T));if(x(T))return D(this.j(D(T)));if(this.l(R)<0&&T.l(R)<0)return h(this.m()*T.m());let p=this.g.length+T.g.length,w=[];for(var E=0;E<2*p;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(let I=0;I<T.g.length;I++){let S=this.i(E)>>>16,_=this.i(E)&65535,kt=T.i(I)>>>16,Ee=T.i(I)&65535;w[2*E+2*I]+=_*Ee,z(w,2*E+2*I),w[2*E+2*I+1]+=S*Ee,z(w,2*E+2*I+1),w[2*E+2*I+1]+=_*kt,z(w,2*E+2*I+1),w[2*E+2*I+2]+=S*kt,z(w,2*E+2*I+2)}for(T=0;T<p;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=p;T<2*p;T++)w[T]=0;return new a(w,0)};function z(T,p){for(;(T[p]&65535)!=T[p];)T[p+1]+=T[p]>>>16,T[p]&=65535,p++}function j(T,p){this.g=T,this.h=p}function Z(T,p){if(k(p))throw Error("division by zero");if(k(T))return new j(g,g);if(x(T))return p=Z(D(T),p),new j(D(p.g),D(p.h));if(x(p))return p=Z(T,D(p)),new j(D(p.g),p.h);if(T.g.length>30){if(x(T)||x(p))throw Error("slowDivide_ only works with positive integers.");for(var w=y,E=p;E.l(T)<=0;)w=Y(w),E=Y(E);var I=J(w,1),S=J(E,1);for(E=J(E,2),w=J(w,2);!k(E);){var _=S.add(E);_.l(T)<=0&&(I=I.add(w),S=_),E=J(E,1),w=J(w,1)}return p=U(T,I.j(p)),new j(I,p)}for(I=g;T.l(p)>=0;){for(w=Math.max(1,Math.floor(T.m()/p.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=E<=48?1:Math.pow(2,E-48),S=h(w),_=S.j(p);x(_)||_.l(T)>0;)w-=E,S=h(w),_=S.j(p);k(S)&&(S=y),I=I.add(S),T=U(T,_)}return new j(I,T)}r.B=function(T){return Z(this,T).h},r.and=function(T){let p=Math.max(this.g.length,T.g.length),w=[];for(let E=0;E<p;E++)w[E]=this.i(E)&T.i(E);return new a(w,this.h&T.h)},r.or=function(T){let p=Math.max(this.g.length,T.g.length),w=[];for(let E=0;E<p;E++)w[E]=this.i(E)|T.i(E);return new a(w,this.h|T.h)},r.xor=function(T){let p=Math.max(this.g.length,T.g.length),w=[];for(let E=0;E<p;E++)w[E]=this.i(E)^T.i(E);return new a(w,this.h^T.h)};function Y(T){let p=T.g.length+1,w=[];for(let E=0;E<p;E++)w[E]=T.i(E)<<1|T.i(E-1)>>>31;return new a(w,T.h)}function J(T,p){let w=p>>5;p%=32;let E=T.g.length-w,I=[];for(let S=0;S<E;S++)I[S]=p>0?T.i(S+w)>>>p|T.i(S+w+1)<<32-p:T.i(S+w);return new a(I,T.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Aa=Kh.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,ce=Kh.Integer=a}).apply(typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{})});var di,le,Sa,up,Fn,ba,Qr,fi,Ra,Pa,Va,Qh=li(()=>{"use strict";di=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},le={};(function(){var r,t=Object.defineProperty;function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof di=="object"&&di];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=e(this);function s(o,l){if(l)t:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var v=o[m];if(!(v in d))break t;d=d[v]}o=o[o.length-1],m=d[o],l=l(m),l!=m&&l!=null&&t(d,o,{configurable:!0,writable:!0,value:l})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(l){var d=[],m;for(m in l)Object.prototype.hasOwnProperty.call(l,m)&&d.push([m,l[m]]);return d}});var i=i||{},a=this||self;function u(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function c(o,l,d){return o.call.apply(o.bind,arguments)}function h(o,l,d){return h=c,h.apply(null,arguments)}function f(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function g(o,l){function d(){}d.prototype=l.prototype,o.Z=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Ob=function(m,v,P){for(var O=Array(arguments.length-2),$=2;$<arguments.length;$++)O[$-2]=arguments[$];return l.prototype[v].apply(m,O)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function R(o){let l=o.length;if(l>0){let d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function k(o,l){for(let m=1;m<arguments.length;m++){let v=arguments[m];var d=typeof v;if(d=d!="object"?d:v?Array.isArray(v)?"array":d:"null",d=="array"||d=="object"&&typeof v.length=="number"){d=o.length||0;let P=v.length||0;o.length=d+P;for(let O=0;O<P;O++)o[d+O]=v[O]}else o.push(v)}}class x{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function D(o){a.setTimeout(()=>{throw o},0)}function U(){var o=T;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class z{constructor(){this.h=this.g=null}add(l,d){let m=j.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var j=new x(()=>new Z,o=>o.reset());class Z{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Y,J=!1,T=new z,p=()=>{let o=Promise.resolve(void 0);Y=()=>{o.then(w)}};function w(){for(var o;o=U();){try{o.h.call(o.g)}catch(d){D(d)}var l=j;l.j(o),l.h<100&&(l.h++,o.next=l.g,l.g=o)}J=!1}function E(){this.u=this.u,this.C=this.C}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var S=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let d=()=>{};a.addEventListener("test",d,l),a.removeEventListener("test",d,l)}catch{}return o})();function _(o){return/^[\s\xa0]*$/.test(o)}function kt(o,l){I.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,l)}g(kt,I),kt.prototype.init=function(o,l){let d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget,l||(d=="mouseover"?l=o.fromElement:d=="mouseout"&&(l=o.toElement)),this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&kt.Z.h.call(this)},kt.prototype.h=function(){kt.Z.h.call(this);let o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Ee="closure_listenable_"+(Math.random()*1e6|0),Rg=0;function Pg(o,l,d,m,v){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=v,this.key=++Rg,this.da=this.fa=!1}function Ws(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Hs(o,l,d){for(let m in o)l.call(d,o[m],m,o)}function Vg(o,l){for(let d in o)l.call(void 0,o[d],d,o)}function Vl(o){let l={};for(let d in o)l[d]=o[d];return l}let Cl="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xl(o,l){let d,m;for(let v=1;v<arguments.length;v++){m=arguments[v];for(d in m)o[d]=m[d];for(let P=0;P<Cl.length;P++)d=Cl[P],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function Js(o){this.src=o,this.g={},this.h=0}Js.prototype.add=function(o,l,d,m,v){let P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);let O=Wo(o,l,m,v);return O>-1?(l=o[O],d||(l.fa=!1)):(l=new Pg(l,this.src,P,!!m,v),l.fa=d,o.push(l)),l};function Qo(o,l){let d=l.type;if(d in o.g){var m=o.g[d],v=Array.prototype.indexOf.call(m,l,void 0),P;(P=v>=0)&&Array.prototype.splice.call(m,v,1),P&&(Ws(l),o.g[d].length==0&&(delete o.g[d],o.h--))}}function Wo(o,l,d,m){for(let v=0;v<o.length;++v){let P=o[v];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==m)return v}return-1}var Ho="closure_lm_"+(Math.random()*1e6|0),Jo={};function Dl(o,l,d,m,v){if(m&&m.once)return kl(o,l,d,m,v);if(Array.isArray(l)){for(let P=0;P<l.length;P++)Dl(o,l[P],d,m,v);return null}return d=ta(d),o&&o[Ee]?o.J(l,d,u(m)?!!m.capture:!!m,v):Nl(o,l,d,!1,m,v)}function Nl(o,l,d,m,v,P){if(!l)throw Error("Invalid event type");let O=u(v)?!!v.capture:!!v,$=Yo(o);if($||(o[Ho]=$=new Js(o)),d=$.add(l,d,m,O,P),d.proxy)return d;if(m=Cg(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)S||(v=O),v===void 0&&(v=!1),o.addEventListener(l.toString(),m,v);else if(o.attachEvent)o.attachEvent(Ol(l.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Cg(){function o(d){return l.call(o.src,o.listener,d)}let l=xg;return o}function kl(o,l,d,m,v){if(Array.isArray(l)){for(let P=0;P<l.length;P++)kl(o,l[P],d,m,v);return null}return d=ta(d),o&&o[Ee]?o.K(l,d,u(m)?!!m.capture:!!m,v):Nl(o,l,d,!0,m,v)}function Ml(o,l,d,m,v){if(Array.isArray(l))for(var P=0;P<l.length;P++)Ml(o,l[P],d,m,v);else m=u(m)?!!m.capture:!!m,d=ta(d),o&&o[Ee]?(o=o.i,P=String(l).toString(),P in o.g&&(l=o.g[P],d=Wo(l,d,m,v),d>-1&&(Ws(l[d]),Array.prototype.splice.call(l,d,1),l.length==0&&(delete o.g[P],o.h--)))):o&&(o=Yo(o))&&(l=o.g[l.toString()],o=-1,l&&(o=Wo(l,d,m,v)),(d=o>-1?l[o]:null)&&Xo(d))}function Xo(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[Ee])Qo(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent(Ol(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=Yo(l))?(Qo(d,o),d.h==0&&(d.src=null,l[Ho]=null)):Ws(o)}}}function Ol(o){return o in Jo?Jo[o]:Jo[o]="on"+o}function xg(o,l){if(o.da)o=!0;else{l=new kt(l,this);let d=o.listener,m=o.ha||o.src;o.fa&&Xo(o),o=d.call(m,l)}return o}function Yo(o){return o=o[Ho],o instanceof Js?o:null}var Zo="__closure_events_fn_"+(Math.random()*1e9>>>0);function ta(o){return typeof o=="function"?o:(o[Zo]||(o[Zo]=function(l){return o.handleEvent(l)}),o[Zo])}function Rt(){E.call(this),this.i=new Js(this),this.M=this,this.G=null}g(Rt,E),Rt.prototype[Ee]=!0,Rt.prototype.removeEventListener=function(o,l,d,m){Ml(this,o,l,d,m)};function Dt(o,l){var d,m=o.G;if(m)for(d=[];m;m=m.G)d.push(m);if(o=o.M,m=l.type||l,typeof l=="string")l=new I(l,o);else if(l instanceof I)l.target=l.target||o;else{var v=l;l=new I(m,o),xl(l,v)}v=!0;let P,O;if(d)for(O=d.length-1;O>=0;O--)P=l.g=d[O],v=Xs(P,m,!0,l)&&v;if(P=l.g=o,v=Xs(P,m,!0,l)&&v,v=Xs(P,m,!1,l)&&v,d)for(O=0;O<d.length;O++)P=l.g=d[O],v=Xs(P,m,!1,l)&&v}Rt.prototype.N=function(){if(Rt.Z.N.call(this),this.i){var o=this.i;for(let l in o.g){let d=o.g[l];for(let m=0;m<d.length;m++)Ws(d[m]);delete o.g[l],o.h--}}this.G=null},Rt.prototype.J=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},Rt.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};function Xs(o,l,d,m){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();let v=!0;for(let P=0;P<l.length;++P){let O=l[P];if(O&&!O.da&&O.capture==d){let $=O.listener,vt=O.ha||O.src;O.fa&&Qo(o.i,O),v=$.call(vt,m)!==!1&&v}}return v&&!m.defaultPrevented}function Dg(o,l){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:a.setTimeout(o,l||0)}function Fl(o){o.g=Dg(()=>{o.g=null,o.i&&(o.i=!1,Fl(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class Ng extends E{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Fl(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Cr(o){E.call(this),this.h=o,this.g={}}g(Cr,E);var Ll=[];function ql(o){Hs(o.g,function(l,d){this.g.hasOwnProperty(d)&&Xo(l)},o),o.g={}}Cr.prototype.N=function(){Cr.Z.N.call(this),ql(this)},Cr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ea=a.JSON.stringify,kg=a.JSON.parse,Mg=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Ul(){}function Bl(){}var xr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function na(){I.call(this,"d")}g(na,I);function ra(){I.call(this,"c")}g(ra,I);var tn={},jl=null;function Ys(){return jl=jl||new Rt}tn.Ia="serverreachability";function Gl(o){I.call(this,tn.Ia,o)}g(Gl,I);function Dr(o){let l=Ys();Dt(l,new Gl(l))}tn.STAT_EVENT="statevent";function zl(o,l){I.call(this,tn.STAT_EVENT,o),this.stat=l}g(zl,I);function Nt(o){let l=Ys();Dt(l,new zl(l,o))}tn.Ja="timingevent";function Kl(o,l){I.call(this,tn.Ja,o),this.size=l}g(Kl,I);function Nr(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},l)}function kr(){this.g=!0}kr.prototype.ua=function(){this.g=!1};function Og(o,l,d,m,v,P){o.info(function(){if(o.g)if(P){var O="",$=P.split("&");for(let rt=0;rt<$.length;rt++){var vt=$[rt].split("=");if(vt.length>1){let St=vt[0];vt=vt[1];let Xt=St.split("_");O=Xt.length>=2&&Xt[1]=="type"?O+(St+"="+vt+"&"):O+(St+"=redacted&")}}}else O=null;else O=P;return"XMLHTTP REQ ("+m+") [attempt "+v+"]: "+l+`
`+d+`
`+O})}function Fg(o,l,d,m,v,P,O){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+v+"]: "+l+`
`+d+`
`+P+" "+O})}function Nn(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+qg(o,d)+(m?" "+m:"")})}function Lg(o,l){o.info(function(){return"TIMEOUT: "+l})}kr.prototype.info=function(){};function qg(o,l){if(!o.g)return l;if(!l)return null;try{let P=JSON.parse(l);if(P){for(o=0;o<P.length;o++)if(Array.isArray(P[o])){var d=P[o];if(!(d.length<2)){var m=d[1];if(Array.isArray(m)&&!(m.length<1)){var v=m[0];if(v!="noop"&&v!="stop"&&v!="close")for(let O=1;O<m.length;O++)m[O]=""}}}}return ea(P)}catch{return l}}var Zs={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},$l={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ql;function sa(){}g(sa,Ul),sa.prototype.g=function(){return new XMLHttpRequest},Ql=new sa;function Mr(o){return encodeURIComponent(String(o))}function Ug(o){var l=1;o=o.split(":");let d=[];for(;l>0&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function ve(o,l,d,m){this.j=o,this.i=l,this.l=d,this.S=m||1,this.V=new Cr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Wl}function Wl(){this.i=null,this.g="",this.h=!1}var Hl={},ia={};function oa(o,l,d){o.M=1,o.A=ei(Jt(l)),o.u=d,o.R=!0,Jl(o,null)}function Jl(o,l){o.F=Date.now(),ti(o),o.B=Jt(o.A);var d=o.B,m=o.S;Array.isArray(m)||(m=[String(m)]),ch(d.i,"t",m),o.C=0,d=o.j.L,o.h=new Wl,o.g=Rh(o.j,d?l:null,!o.u),o.P>0&&(o.O=new Ng(h(o.Y,o,o.g),o.P)),l=o.V,d=o.g,m=o.ba;var v="readystatechange";Array.isArray(v)||(v&&(Ll[0]=v.toString()),v=Ll);for(let P=0;P<v.length;P++){let O=Dl(d,v[P],m||l.handleEvent,!1,l.h||l);if(!O)break;l.g[O.key]=O}l=o.J?Vl(o.J):{},o.u?(o.v||(o.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,l)):(o.v="GET",o.g.ea(o.B,o.v,null,l)),Dr(),Og(o.i,o.v,o.B,o.l,o.S,o.u)}ve.prototype.ba=function(o){o=o.target;let l=this.O;l&&be(o)==3?l.j():this.Y(o)},ve.prototype.Y=function(o){try{if(o==this.g)t:{let $=be(this.g),vt=this.g.ya(),rt=this.g.ca();if(!($<3)&&($!=3||this.g&&(this.h.h||this.g.la()||ph(this.g)))){this.K||$!=4||vt==7||(vt==8||rt<=0?Dr(3):Dr(2)),aa(this);var l=this.g.ca();this.X=l;var d=Bg(this);if(this.o=l==200,Fg(this.i,this.v,this.B,this.l,this.S,$,l),this.o){if(this.U&&!this.L){e:{if(this.g){var m,v=this.g;if((m=v.g?v.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(m)){var P=m;break e}}P=null}if(o=P)Nn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ua(this,o);else{this.o=!1,this.m=3,Nt(12),en(this),Or(this);break t}}if(this.R){o=!0;let St;for(;!this.K&&this.C<d.length;)if(St=jg(this,d),St==ia){$==4&&(this.m=4,Nt(14),o=!1),Nn(this.i,this.l,null,"[Incomplete Response]");break}else if(St==Hl){this.m=4,Nt(15),Nn(this.i,this.l,d,"[Invalid Chunk]"),o=!1;break}else Nn(this.i,this.l,St,null),ua(this,St);if(Xl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$!=4||d.length!=0||this.h.h||(this.m=1,Nt(16),o=!1),this.o=this.o&&o,!o)Nn(this.i,this.l,d,"[Invalid Chunked Response]"),en(this),Or(this);else if(d.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),ga(O),O.P=!0,Nt(11))}}else Nn(this.i,this.l,d,null),ua(this,d);$==4&&en(this),this.o&&!this.K&&($==4?vh(this.j,this):(this.o=!1,ti(this)))}else np(this.g),l==400&&d.indexOf("Unknown SID")>0?(this.m=3,Nt(12)):(this.m=0,Nt(13)),en(this),Or(this)}}}catch{}finally{}};function Bg(o){if(!Xl(o))return o.g.la();let l=ph(o.g);if(l==="")return"";let d="",m=l.length,v=be(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return en(o),Or(o),"";o.h.i=new a.TextDecoder}for(let P=0;P<m;P++)o.h.h=!0,d+=o.h.i.decode(l[P],{stream:!(v&&P==m-1)});return l.length=0,o.h.g+=d,o.C=0,o.h.g}function Xl(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function jg(o,l){var d=o.C,m=l.indexOf(`
`,d);return m==-1?ia:(d=Number(l.substring(d,m)),isNaN(d)?Hl:(m+=1,m+d>l.length?ia:(l=l.slice(m,m+d),o.C=m+d,l)))}ve.prototype.cancel=function(){this.K=!0,en(this)};function ti(o){o.T=Date.now()+o.H,Yl(o,o.H)}function Yl(o,l){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Nr(h(o.aa,o),l)}function aa(o){o.D&&(a.clearTimeout(o.D),o.D=null)}ve.prototype.aa=function(){this.D=null;let o=Date.now();o-this.T>=0?(Lg(this.i,this.B),this.M!=2&&(Dr(),Nt(17)),en(this),this.m=2,Or(this)):Yl(this,this.T-o)};function Or(o){o.j.I==0||o.K||vh(o.j,o)}function en(o){aa(o);var l=o.O;l&&typeof l.dispose=="function"&&l.dispose(),o.O=null,ql(o.V),o.g&&(l=o.g,o.g=null,l.abort(),l.dispose())}function ua(o,l){try{var d=o.j;if(d.I!=0&&(d.g==o||ca(d.h,o))){if(!o.L&&ca(d.h,o)&&d.I==3){try{var m=d.Ba.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var v=m;if(v[0]==0){t:if(!d.v){if(d.g)if(d.g.F+3e3<o.F)ai(d),ii(d);else break t;ma(d),Nt(18)}}else d.xa=v[1],0<d.xa-d.K&&v[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=Nr(h(d.Va,d),6e3));eh(d.h)<=1&&d.ta&&(d.ta=void 0)}else rn(d,11)}else if((o.L||d.g==o)&&ai(d),!_(l))for(v=d.Ba.g.parse(l),l=0;l<v.length;l++){let rt=v[l],St=rt[0];if(!(St<=d.K))if(d.K=St,rt=rt[1],d.I==2)if(rt[0]=="c"){d.M=rt[1],d.ba=rt[2];let Xt=rt[3];Xt!=null&&(d.ka=Xt,d.j.info("VER="+d.ka));let sn=rt[4];sn!=null&&(d.za=sn,d.j.info("SVER="+d.za));let Re=rt[5];Re!=null&&typeof Re=="number"&&Re>0&&(m=1.5*Re,d.O=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let Pe=o.g;if(Pe){let ci=Pe.g?Pe.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ci){var P=m.h;P.g||ci.indexOf("spdy")==-1&&ci.indexOf("quic")==-1&&ci.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(la(P,P.h),P.h=null))}if(m.G){let pa=Pe.g?Pe.g.getResponseHeader("X-HTTP-Session-Id"):null;pa&&(m.wa=pa,st(m.J,m.G,pa))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-o.F,d.j.info("Handshake RTT: "+d.T+"ms")),m=d;var O=o;if(m.na=bh(m,m.L?m.ba:null,m.W),O.L){nh(m.h,O);var $=O,vt=m.O;vt&&($.H=vt),$.D&&(aa($),ti($)),m.g=O}else Ih(m);d.i.length>0&&oi(d)}else rt[0]!="stop"&&rt[0]!="close"||rn(d,7);else d.I==3&&(rt[0]=="stop"||rt[0]=="close"?rt[0]=="stop"?rn(d,7):fa(d):rt[0]!="noop"&&d.l&&d.l.qa(rt),d.A=0)}}Dr(4)}catch{}}var Gg=class{constructor(o,l){this.g=o,this.map=l}};function Zl(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function th(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function eh(o){return o.h?1:o.g?o.g.size:0}function ca(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function la(o,l){o.g?o.g.add(l):o.h=l}function nh(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}Zl.prototype.cancel=function(){if(this.i=rh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function rh(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let d of o.g.values())l=l.concat(d.G);return l}return R(o.i)}var sh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function zg(o,l){if(o){o=o.split("&");for(let d=0;d<o.length;d++){let m=o[d].indexOf("="),v,P=null;m>=0?(v=o[d].substring(0,m),P=o[d].substring(m+1)):v=o[d],l(v,P?decodeURIComponent(P.replace(/\+/g," ")):"")}}}function Ae(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;o instanceof Ae?(this.l=o.l,Fr(this,o.j),this.o=o.o,this.g=o.g,Lr(this,o.u),this.h=o.h,ha(this,lh(o.i)),this.m=o.m):o&&(l=String(o).match(sh))?(this.l=!1,Fr(this,l[1]||"",!0),this.o=qr(l[2]||""),this.g=qr(l[3]||"",!0),Lr(this,l[4]),this.h=qr(l[5]||"",!0),ha(this,l[6]||"",!0),this.m=qr(l[7]||"")):(this.l=!1,this.i=new Br(null,this.l))}Ae.prototype.toString=function(){let o=[];var l=this.j;l&&o.push(Ur(l,ih,!0),":");var d=this.g;return(d||l=="file")&&(o.push("//"),(l=this.o)&&o.push(Ur(l,ih,!0),"@"),o.push(Mr(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&o.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Ur(d,d.charAt(0)=="/"?Qg:$g,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Ur(d,Hg)),o.join("")},Ae.prototype.resolve=function(o){let l=Jt(this),d=!!o.j;d?Fr(l,o.j):d=!!o.o,d?l.o=o.o:d=!!o.g,d?l.g=o.g:d=o.u!=null;var m=o.h;if(d)Lr(l,o.u);else if(d=!!o.h){if(m.charAt(0)!="/")if(this.g&&!this.h)m="/"+m;else{var v=l.h.lastIndexOf("/");v!=-1&&(m=l.h.slice(0,v+1)+m)}if(v=m,v==".."||v==".")m="";else if(v.indexOf("./")!=-1||v.indexOf("/.")!=-1){m=v.lastIndexOf("/",0)==0,v=v.split("/");let P=[];for(let O=0;O<v.length;){let $=v[O++];$=="."?m&&O==v.length&&P.push(""):$==".."?((P.length>1||P.length==1&&P[0]!="")&&P.pop(),m&&O==v.length&&P.push("")):(P.push($),m=!0)}m=P.join("/")}else m=v}return d?l.h=m:d=o.i.toString()!=="",d?ha(l,lh(o.i)):d=!!o.m,d&&(l.m=o.m),l};function Jt(o){return new Ae(o)}function Fr(o,l,d){o.j=d?qr(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Lr(o,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);o.u=l}else o.u=null}function ha(o,l,d){l instanceof Br?(o.i=l,Jg(o.i,o.l)):(d||(l=Ur(l,Wg)),o.i=new Br(l,o.l))}function st(o,l,d){o.i.set(l,d)}function ei(o){return st(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function qr(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Ur(o,l,d){return typeof o=="string"?(o=encodeURI(o).replace(l,Kg),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Kg(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var ih=/[#\/\?@]/g,$g=/[#\?:]/g,Qg=/[#\?]/g,Wg=/[#\?@]/g,Hg=/#/g;function Br(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function nn(o){o.g||(o.g=new Map,o.h=0,o.i&&zg(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}r=Br.prototype,r.add=function(o,l){nn(this),this.i=null,o=kn(this,o);let d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this};function oh(o,l){nn(o),l=kn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function ah(o,l){return nn(o),l=kn(o,l),o.g.has(l)}r.forEach=function(o,l){nn(this),this.g.forEach(function(d,m){d.forEach(function(v){o.call(l,v,m,this)},this)},this)};function uh(o,l){nn(o);let d=[];if(typeof l=="string")ah(o,l)&&(d=d.concat(o.g.get(kn(o,l))));else for(o=Array.from(o.g.values()),l=0;l<o.length;l++)d=d.concat(o[l]);return d}r.set=function(o,l){return nn(this),this.i=null,o=kn(this,o),ah(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=uh(this,o),o.length>0?String(o[0]):l):l};function ch(o,l,d){oh(o,l),d.length>0&&(o.i=null,o.g.set(kn(o,l),R(d)),o.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(let m=0;m<l.length;m++){var d=l[m];let v=Mr(d);d=uh(this,d);for(let P=0;P<d.length;P++){let O=v;d[P]!==""&&(O+="="+Mr(d[P])),o.push(O)}}return this.i=o.join("&")};function lh(o){let l=new Br;return l.i=o.i,o.g&&(l.g=new Map(o.g),l.h=o.h),l}function kn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Jg(o,l){l&&!o.j&&(nn(o),o.i=null,o.g.forEach(function(d,m){let v=m.toLowerCase();m!=v&&(oh(this,m),ch(this,v,d))},o)),o.j=l}function Xg(o,l){let d=new kr;if(a.Image){let m=new Image;m.onload=f(Se,d,"TestLoadImage: loaded",!0,l,m),m.onerror=f(Se,d,"TestLoadImage: error",!1,l,m),m.onabort=f(Se,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=f(Se,d,"TestLoadImage: timeout",!1,l,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}function Yg(o,l){let d=new kr,m=new AbortController,v=setTimeout(()=>{m.abort(),Se(d,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(v),P.ok?Se(d,"TestPingServer: ok",!0,l):Se(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(v),Se(d,"TestPingServer: error",!1,l)})}function Se(o,l,d,m,v){try{v&&(v.onload=null,v.onerror=null,v.onabort=null,v.ontimeout=null),m(d)}catch{}}function Zg(){this.g=new Mg}function ni(o){this.i=o.Sb||null,this.h=o.ab||!1}g(ni,Ul),ni.prototype.g=function(){return new ri(this.i,this.h)};function ri(o,l){Rt.call(this),this.H=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(ri,Rt),r=ri.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=l,this.readyState=1,Gr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(l.body=o),(this.H||a).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,jr(this)),this.readyState=0},r.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Gr(this)),this.g&&(this.readyState=3,Gr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;hh(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function hh(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}r.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?jr(this):Gr(this),this.readyState==3&&hh(this)}},r.Oa=function(o){this.g&&(this.response=this.responseText=o,jr(this))},r.Na=function(o){this.g&&(this.response=o,jr(this))},r.ga=function(){this.g&&jr(this)};function jr(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Gr(o)}r.setRequestHeader=function(o,l){this.A.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=l.next();return o.join(`\r
`)};function Gr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(ri.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function dh(o){let l="";return Hs(o,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function da(o,l,d){t:{for(m in d){var m=!1;break t}m=!0}m||(d=dh(d),typeof o=="string"?d!=null&&Mr(d):st(o,l,d))}function lt(o){Rt.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(lt,Rt);var tp=/^https?$/i,ep=["POST","PUT"];r=lt.prototype,r.Fa=function(o){this.H=o},r.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ql.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){fh(this,P);return}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var v in m)d.set(v,m[v]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())d.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),v=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(ep,l,void 0)>=0)||m||v||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,O]of d)this.g.setRequestHeader(P,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(P){fh(this,P)}};function fh(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.o=5,mh(o),si(o)}function mh(o){o.A||(o.A=!0,Dt(o,"complete"),Dt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Dt(this,"complete"),Dt(this,"abort"),si(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),si(this,!0)),lt.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?gh(this):this.Xa())},r.Xa=function(){gh(this)};function gh(o){if(o.h&&typeof i<"u"){if(o.v&&be(o)==4)setTimeout(o.Ca.bind(o),0);else if(Dt(o,"readystatechange"),be(o)==4){o.h=!1;try{let P=o.ca();t:switch(P){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var d;if(!(d=l)){var m;if(m=P===0){let O=String(o.D).match(sh)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),m=!tp.test(O?O.toLowerCase():"")}d=m}if(d)Dt(o,"complete"),Dt(o,"success");else{o.o=6;try{var v=be(o)>2?o.g.statusText:""}catch{v=""}o.l=v+" ["+o.ca()+"]",mh(o)}}finally{si(o)}}}}function si(o,l){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);let d=o.g;o.g=null,l||Dt(o,"ready");try{d.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function be(o){return o.g?o.g.readyState:0}r.ca=function(){try{return be(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),kg(l)}};function ph(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function np(o){let l={};o=(o.g&&be(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(_(o[m]))continue;var d=Ug(o[m]);let v=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let P=l[v]||[];l[v]=P,P.push(d)}Vg(l,function(m){return m.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function zr(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function yh(o){this.za=0,this.i=[],this.j=new kr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=zr("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=zr("baseRetryDelayMs",5e3,o),this.Za=zr("retryDelaySeedMs",1e4,o),this.Ta=zr("forwardChannelMaxRetries",2,o),this.va=zr("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new Zl(o&&o.concurrentRequestLimit),this.Ba=new Zg,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=yh.prototype,r.ka=8,r.I=1,r.connect=function(o,l,d,m){Nt(0),this.W=o,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.J=bh(this,null,this.W),oi(this)};function fa(o){if(_h(o),o.I==3){var l=o.V++,d=Jt(o.J);if(st(d,"SID",o.M),st(d,"RID",l),st(d,"TYPE","terminate"),Kr(o,d),l=new ve(o,o.j,l),l.M=2,l.A=ei(Jt(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(l.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=l.A,d=!0),d||(l.g=Rh(l.j,null),l.g.ea(l.A)),l.F=Date.now(),ti(l)}Sh(o)}function ii(o){o.g&&(ga(o),o.g.cancel(),o.g=null)}function _h(o){ii(o),o.v&&(a.clearTimeout(o.v),o.v=null),ai(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function oi(o){if(!th(o.h)&&!o.m){o.m=!0;var l=o.Ea;Y||p(),J||(Y(),J=!0),T.add(l,o),o.D=0}}function rp(o,l){return eh(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=l.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Nr(h(o.Ea,o,l),Ah(o,o.D)),o.D++,!0)}r.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;let v=new ve(this,this.j,o),P=this.o;if(this.U&&(P?(P=Vl(P),xl(P,this.U)):P=this.U),this.u!==null||this.R||(v.J=P,P=null),this.S)t:{for(var l=0,d=0;d<this.i.length;d++){e:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(l+=m,l>4096){l=d;break t}if(l===4096||d===this.i.length-1){l=d+1;break t}}l=1e3}else l=1e3;l=Th(this,v,l),d=Jt(this.J),st(d,"RID",o),st(d,"CVER",22),this.G&&st(d,"X-HTTP-Session-Id",this.G),Kr(this,d),P&&(this.R?l="headers="+Mr(dh(P))+"&"+l:this.u&&da(d,this.u,P)),la(this.h,v),this.Ra&&st(d,"TYPE","init"),this.S?(st(d,"$req",l),st(d,"SID","null"),v.U=!0,oa(v,d,null)):oa(v,d,l),this.I=2}}else this.I==3&&(o?wh(this,o):this.i.length==0||th(this.h)||wh(this))};function wh(o,l){var d;l?d=l.l:d=o.V++;let m=Jt(o.J);st(m,"SID",o.M),st(m,"RID",d),st(m,"AID",o.K),Kr(o,m),o.u&&o.o&&da(m,o.u,o.o),d=new ve(o,o.j,d,o.D+1),o.u===null&&(d.J=o.o),l&&(o.i=l.G.concat(o.i)),l=Th(o,d,1e3),d.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),la(o.h,d),oa(d,m,l)}function Kr(o,l){o.H&&Hs(o.H,function(d,m){st(l,m,d)}),o.l&&Hs({},function(d,m){st(l,m,d)})}function Th(o,l,d){d=Math.min(o.i.length,d);let m=o.l?h(o.l.Ka,o.l,o):null;t:{var v=o.i;let $=-1;for(;;){let vt=["count="+d];$==-1?d>0?($=v[0].g,vt.push("ofs="+$)):$=0:vt.push("ofs="+$);let rt=!0;for(let St=0;St<d;St++){var P=v[St].g;let Xt=v[St].map;if(P-=$,P<0)$=Math.max(0,v[St].g-100),rt=!1;else try{P="req"+P+"_"||"";try{var O=Xt instanceof Map?Xt:Object.entries(Xt);for(let[sn,Re]of O){let Pe=Re;u(Re)&&(Pe=ea(Re)),vt.push(P+sn+"="+encodeURIComponent(Pe))}}catch(sn){throw vt.push(P+"type="+encodeURIComponent("_badmap")),sn}}catch{m&&m(Xt)}}if(rt){O=vt.join("&");break t}}O=void 0}return o=o.i.splice(0,d),l.G=o,O}function Ih(o){if(!o.g&&!o.v){o.Y=1;var l=o.Da;Y||p(),J||(Y(),J=!0),T.add(l,o),o.A=0}}function ma(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Nr(h(o.Da,o),Ah(o,o.A)),o.A++,!0)}r.Da=function(){if(this.v=null,Eh(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Nr(h(this.Wa,this),o)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Nt(10),ii(this),Eh(this))};function ga(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function Eh(o){o.g=new ve(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var l=Jt(o.na);st(l,"RID","rpc"),st(l,"SID",o.M),st(l,"AID",o.K),st(l,"CI",o.F?"0":"1"),!o.F&&o.ia&&st(l,"TO",o.ia),st(l,"TYPE","xmlhttp"),Kr(o,l),o.u&&o.o&&da(l,o.u,o.o),o.O&&(o.g.H=o.O);var d=o.g;o=o.ba,d.M=1,d.A=ei(Jt(l)),d.u=null,d.R=!0,Jl(d,o)}r.Va=function(){this.C!=null&&(this.C=null,ii(this),ma(this),Nt(19))};function ai(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function vh(o,l){var d=null;if(o.g==l){ai(o),ga(o),o.g=null;var m=2}else if(ca(o.h,l))d=l.G,nh(o.h,l),m=1;else return;if(o.I!=0){if(l.o)if(m==1){d=l.u?l.u.length:0,l=Date.now()-l.F;var v=o.D;m=Ys(),Dt(m,new Kl(m,d)),oi(o)}else Ih(o);else if(v=l.m,v==3||v==0&&l.X>0||!(m==1&&rp(o,l)||m==2&&ma(o)))switch(d&&d.length>0&&(l=o.h,l.i=l.i.concat(d)),v){case 1:rn(o,5);break;case 4:rn(o,10);break;case 3:rn(o,6);break;default:rn(o,2)}}}function Ah(o,l){let d=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(d*=2),d*l}function rn(o,l){if(o.j.info("Error code "+l),l==2){var d=h(o.bb,o),m=o.Ua;let v=!m;m=new Ae(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Fr(m,"https"),ei(m),v?Xg(m.toString(),d):Yg(m.toString(),d)}else Nt(2);o.I=0,o.l&&o.l.pa(l),Sh(o),_h(o)}r.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Nt(2)):(this.j.info("Failed to ping google.com"),Nt(1))};function Sh(o){if(o.I=0,o.ja=[],o.l){let l=rh(o.h);(l.length!=0||o.i.length!=0)&&(k(o.ja,l),k(o.ja,o.i),o.h.i.length=0,R(o.i),o.i.length=0),o.l.oa()}}function bh(o,l,d){var m=d instanceof Ae?Jt(d):new Ae(d);if(m.g!="")l&&(m.g=l+"."+m.g),Lr(m,m.u);else{var v=a.location;m=v.protocol,l=l?l+"."+v.hostname:v.hostname,v=+v.port;let P=new Ae(null);m&&Fr(P,m),l&&(P.g=l),v&&Lr(P,v),d&&(P.h=d),m=P}return d=o.G,l=o.wa,d&&l&&st(m,d,l),st(m,"VER",o.ka),Kr(o,m),m}function Rh(o,l,d){if(l&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Aa&&!o.ma?new lt(new ni({ab:d})):new lt(o.ma),l.Fa(o.L),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ph(){}r=Ph.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function ui(){}ui.prototype.g=function(o,l){return new Ft(o,l)};function Ft(o,l){Rt.call(this),this.g=new yh(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(o?o["X-WebChannel-Client-Profile"]=l.sa:o={"X-WebChannel-Client-Profile":l.sa}),this.g.U=o,(o=l&&l.Qb)&&!_(o)&&(this.g.u=o),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!_(l)&&(this.g.G=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new Mn(this)}g(Ft,Rt),Ft.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ft.prototype.close=function(){fa(this.g)},Ft.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.v&&(d={},d.__data__=ea(o),o=d);l.i.push(new Gg(l.Ya++,o)),l.I==3&&oi(l)},Ft.prototype.N=function(){this.g.l=null,delete this.j,fa(this.g),delete this.g,Ft.Z.N.call(this)};function Vh(o){na.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){t:{for(let d in l){o=d;break t}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}g(Vh,na);function Ch(){ra.call(this),this.status=1}g(Ch,ra);function Mn(o){this.g=o}g(Mn,Ph),Mn.prototype.ra=function(){Dt(this.g,"a")},Mn.prototype.qa=function(o){Dt(this.g,new Vh(o))},Mn.prototype.pa=function(o){Dt(this.g,new Ch)},Mn.prototype.oa=function(){Dt(this.g,"b")},ui.prototype.createWebChannel=ui.prototype.g,Ft.prototype.send=Ft.prototype.o,Ft.prototype.open=Ft.prototype.m,Ft.prototype.close=Ft.prototype.close,Va=le.createWebChannelTransport=function(){return new ui},Pa=le.getStatEventTarget=function(){return Ys()},Ra=le.Event=tn,fi=le.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Zs.NO_ERROR=0,Zs.TIMEOUT=8,Zs.HTTP_ERROR=6,Qr=le.ErrorCode=Zs,$l.COMPLETE="complete",ba=le.EventType=$l,Bl.EventType=xr,xr.OPEN="a",xr.CLOSE="b",xr.ERROR="c",xr.MESSAGE="d",Rt.prototype.listen=Rt.prototype.J,Fn=le.WebChannel=Bl,up=le.FetchXmlHttpFactory=ni,lt.prototype.listenOnce=lt.prototype.K,lt.prototype.getLastError=lt.prototype.Ha,lt.prototype.getLastErrorCode=lt.prototype.ya,lt.prototype.getStatus=lt.prototype.ca,lt.prototype.getResponseJson=lt.prototype.La,lt.prototype.getResponseText=lt.prototype.la,lt.prototype.send=lt.prototype.ea,lt.prototype.setWithCredentials=lt.prototype.Fa,Sa=le.XhrIo=lt}).apply(typeof di<"u"?di:typeof self<"u"?self:typeof window<"u"?window:{})});function zn(){return Le.logLevel}function M_(r){Le.setLogLevel(r)}function N(r,...t){if(Le.logLevel<=Yt.DEBUG){let e=t.map(Wc);Le.debug(`Firestore (${Er}): ${r}`,...e)}}function dt(r,...t){if(Le.logLevel<=Yt.ERROR){let e=t.map(Wc);Le.error(`Firestore (${Er}): ${r}`,...e)}}function zt(r,...t){if(Le.logLevel<=Yt.WARN){let e=t.map(Wc);Le.warn(`Firestore (${Er}): ${r}`,...e)}}function Wc(r){if(typeof r=="string")return r;try{return(function(e){return JSON.stringify(e)})(r)}catch{return r}}function L(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,mf(r,n,e)}function mf(r,t,e){let n=`FIRESTORE (${Er}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw dt(n),new Error(n)}function q(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||mf(t,s,n)}function O_(r,t){r||L(57014,t)}function M(r,t){return r}function cp(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}function G(r,t){return r<t?-1:r>t?1:0}function za(r,t){let e=Math.min(r.length,t.length);for(let n=0;n<e;n++){let s=r.charAt(n),i=t.charAt(n);if(s!==i)return Ca(s)===Ca(i)?G(s,i):Ca(s)?1:-1}return G(r.length,t.length)}function Ca(r){let t=r.charCodeAt(0);return t>=lp&&t<=hp}function Zn(r,t,e){return r.length===t.length&&r.every((n,s)=>e(n,t[s]))}function gf(r){return r+"\0"}function Hc(r,t,e){if(!e)throw new C(A.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function fp(r,t,e,n){if(t===!0&&n===!0)throw new C(A.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Xh(r){if(!F.isDocumentKey(r))throw new C(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Yh(r){if(F.isDocumentKey(r))throw new C(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function pf(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Vo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=(function(n){return n.constructor?n.constructor.name:null})(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L(12329,{type:typeof r})}function Q(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new C(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Vo(r);throw new C(A.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function yf(r,t){if(t<=0)throw new C(A.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function wt(r,t){let e={typeString:r};return t&&(e.value=t),e}function Vn(r,t){if(!pf(r))throw new C(A.INVALID_ARGUMENT,"JSON must be an object");let e;for(let n in t)if(t[n]){let s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}let a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new C(A.INVALID_ARGUMENT,e);return!0}function $a(r){return r.fields.find(t=>t.kind===2)}function an(r){return r.fields.filter(t=>t.kind!==2)}function mp(r,t){let e=G(r.collectionGroup,t.collectionGroup);if(e!==0)return e;for(let n=0;n<Math.min(r.fields.length,t.fields.length);++n)if(e=gp(r.fields[n],t.fields[n]),e!==0)return e;return G(r.fields.length,t.fields.length)}function gp(r,t){let e=It.comparator(r.fieldPath,t.fieldPath);return e!==0?e:G(r.kind,t.kind)}function _f(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=B.fromTimestamp(n===1e9?new ut(e+1,0):new ut(e,n));return new Kt(s,F.empty(),t)}function wf(r){return new Kt(r.readTime,r.key,tr)}function Jc(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=F.comparator(r.documentKey,t.documentKey),e!==0?e:G(r.largestBatchId,t.largestBatchId))}function He(r){return V(this,null,function*(){if(r.code!==A.FAILED_PRECONDITION||r.message!==Tf)throw r;N("LocalStore","Unexpectedly lost primary lease")})}function If(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Je(r){return r.name==="IndexedDbTransactionError"}function cn(r){return new b((t,e)=>{r.onsuccess=n=>{let s=n.target.result;t(s)},r.onerror=n=>{let s=Xc(n.target.error);e(s)}})}function Xc(r){let t=Ue.M($r());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ed||(ed=!0,setTimeout(()=>{throw n},0)),n}}return r}function Bs(r){return r==null}function ls(r){return r===0&&1/r==-1/0}function Ef(r){return typeof r=="number"&&Number.isInteger(r)&&!ls(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Ct(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=nd(t)),t=pp(r.get(e),t);return nd(t)}function pp(r,t){let e=t,n=r.length;for(let s=0;s<n;s++){let i=r.charAt(s);switch(i){case"\0":e+="";break;case Di:e+="";break;default:e+=i}}return e}function nd(r){return r+Di+""}function te(r){let t=r.length;if(q(t>=2,64408,{path:r}),t===2)return q(r.charAt(0)===Di&&r.charAt(1)==="",56145,{path:r}),W.emptyPath();let e=t-2,n=[],s="";for(let i=0;i<t;){let a=r.indexOf(Di,i);switch((a<0||a>e)&&L(50515,{path:r}),r.charAt(a+1)){case"":let u=r.substring(i,a),c;s.length===0?c=u:(s+=u,c=s,s=""),n.push(c);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:L(61167,{path:r})}i=a+2}return new W(n)}function Ti(r,t){return[r,Ct(t)]}function vf(r,t,e){return[r,Ct(t),e]}function At(r,t){let e=M(r);return Ue.O(e.le,t)}function id(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Xe(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Nf(r,t){let e=[];for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.push(t(r[n],n,r));return e}function kf(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function qn(r){return r.hasNext()?r.getNext():void 0}function L_(){return typeof atob<"u"}function ge(r){if(q(!!r,39018),typeof r=="string"){let t=0,e=jp.exec(r);if(q(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:at(r.seconds),nanos:at(r.nanos)}}function at(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function pe(r){return typeof r=="string"?mt.fromBase64String(r):mt.fromUint8Array(r)}function No(r){return(r?.mapValue?.fields||{})[Of]?.stringValue===Mf}function ko(r){let t=r.mapValue.fields[Ff];return No(t)?ko(t):t}function gs(r){let t=ge(r.mapValue.fields[Lf].timestampValue);return new ut(t.seconds,t.nanos)}function Be(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?No(r)?4:Uf(r)?9007199254740991:Mo(r)?10:11:L(28295,{value:r})}function oe(r,t){if(r===t)return!0;let e=Be(r);if(e!==Be(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return gs(r).isEqual(gs(t));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let a=ge(s.timestampValue),u=ge(i.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(r,t);case 5:return r.stringValue===t.stringValue;case 6:return(function(s,i){return pe(s.bytesValue).isEqual(pe(i.bytesValue))})(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return(function(s,i){return at(s.geoPointValue.latitude)===at(i.geoPointValue.latitude)&&at(s.geoPointValue.longitude)===at(i.geoPointValue.longitude)})(r,t);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return at(s.integerValue)===at(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let a=at(s.doubleValue),u=at(i.doubleValue);return a===u?ls(a)===ls(u):isNaN(a)&&isNaN(u)}return!1})(r,t);case 9:return Zn(r.arrayValue.values||[],t.arrayValue.values||[],oe);case 10:case 11:return(function(s,i){let a=s.mapValue.fields||{},u=i.mapValue.fields||{};if(id(a)!==id(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!oe(a[c],u[c])))return!1;return!0})(r,t);default:return L(52216,{left:r})}}function ys(r,t){return(r.values||[]).find(e=>oe(e,t))!==void 0}function je(r,t){if(r===t)return 0;let e=Be(r),n=Be(t);if(e!==n)return G(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return G(r.booleanValue,t.booleanValue);case 2:return(function(i,a){let u=at(i.integerValue||i.doubleValue),c=at(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1})(r,t);case 3:return od(r.timestampValue,t.timestampValue);case 4:return od(gs(r),gs(t));case 5:return za(r.stringValue,t.stringValue);case 6:return(function(i,a){let u=pe(i),c=pe(a);return u.compareTo(c)})(r.bytesValue,t.bytesValue);case 7:return(function(i,a){let u=i.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){let f=G(u[h],c[h]);if(f!==0)return f}return G(u.length,c.length)})(r.referenceValue,t.referenceValue);case 8:return(function(i,a){let u=G(at(i.latitude),at(a.latitude));return u!==0?u:G(at(i.longitude),at(a.longitude))})(r.geoPointValue,t.geoPointValue);case 9:return ad(r.arrayValue,t.arrayValue);case 10:return(function(i,a){let u=i.fields||{},c=a.fields||{},h=u[ar]?.arrayValue,f=c[ar]?.arrayValue,g=G(h?.values?.length||0,f?.values?.length||0);return g!==0?g:ad(h,f)})(r.mapValue,t.mapValue);case 11:return(function(i,a){if(i===ke.mapValue&&a===ke.mapValue)return 0;if(i===ke.mapValue)return 1;if(a===ke.mapValue)return-1;let u=i.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){let y=za(c[g],f[g]);if(y!==0)return y;let R=je(u[c[g]],h[f[g]]);if(R!==0)return R}return G(c.length,f.length)})(r.mapValue,t.mapValue);default:throw L(23264,{he:e})}}function od(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return G(r,t);let e=ge(r),n=ge(t),s=G(e.seconds,n.seconds);return s!==0?s:G(e.nanos,n.nanos)}function ad(r,t){let e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){let i=je(e[s],n[s]);if(i)return i}return G(e.length,n.length)}function ur(r){return eu(r)}function eu(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(e){let n=ge(e);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(e){return pe(e).toBase64()})(r.bytesValue):"referenceValue"in r?(function(e){return F.fromName(e).toString()})(r.referenceValue):"geoPointValue"in r?(function(e){return`geo(${e.latitude},${e.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(e){let n="[",s=!0;for(let i of e.values||[])s?s=!1:n+=",",n+=eu(i);return n+"]"})(r.arrayValue):"mapValue"in r?(function(e){let n=Object.keys(e.fields||{}).sort(),s="{",i=!0;for(let a of n)i?i=!1:s+=",",s+=`${a}:${eu(e.fields[a])}`;return s+"}"})(r.mapValue):L(61005,{value:r})}function vi(r){switch(Be(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=ko(r);return t?16+vi(t):16;case 5:return 2*r.stringValue.length;case 6:return pe(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce((s,i)=>s+vi(i),0)})(r.arrayValue);case 10:case 11:return(function(n){let s=0;return Xe(n.fields,(i,a)=>{s+=i.length+vi(a)}),s})(r.mapValue);default:throw L(13486,{value:r})}}function yn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function nu(r){return!!r&&"integerValue"in r}function _s(r){return!!r&&"arrayValue"in r}function ud(r){return!!r&&"nullValue"in r}function cd(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ai(r){return!!r&&"mapValue"in r}function Mo(r){return(r?.mapValue?.fields||{})[nl]?.stringValue===rl}function rs(r){if(r.geoPointValue)return{geoPointValue:Gt({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Gt({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return Xe(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=rs(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=rs(r.arrayValue.values[e]);return t}return Gt({},r)}function Uf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===qf}function Gp(r){return"nullValue"in r?Ei:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?yn(or.empty(),F.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Mo(r)?Bf:{mapValue:{}}:L(35942,{value:r})}function zp(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?yn(or.empty(),F.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Bf:"mapValue"in r?Mo(r)?{mapValue:{}}:ke:L(61959,{value:r})}function ld(r,t){let e=je(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function hd(r,t){let e=je(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}function jf(r){let t=[];return Xe(r.fields,(e,n)=>{let s=new It([e]);if(Ai(n)){let i=jf(n.mapValue).fields;if(i.length===0)t.push(s);else for(let a of i)t.push(s.child(a))}else t.push(s)}),new Ut(t)}function dd(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){let i=t[s],a=r.position[s];if(i.field.isKeyField()?n=F.comparator(F.fromName(a.referenceValue),e.key):n=je(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function fd(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!oe(r.position[e],t.position[e]))return!1;return!0}function Kp(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}function cr(r){return r.op==="and"}function ru(r){return r.op==="or"}function sl(r){return Gf(r)&&cr(r)}function Gf(r){for(let t of r.filters)if(t instanceof tt)return!1;return!0}function su(r){if(r instanceof H)return r.field.canonicalString()+r.op.toString()+ur(r.value);if(sl(r))return r.filters.map(t=>su(t)).join(",");{let t=r.filters.map(e=>su(e)).join(",");return`${r.op}(${t})`}}function zf(r,t){return r instanceof H?(function(n,s){return s instanceof H&&n.op===s.op&&n.field.isEqual(s.field)&&oe(n.value,s.value)})(r,t):r instanceof tt?(function(n,s){return s instanceof tt&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((i,a,u)=>i&&zf(a,s.filters[u]),!0):!1})(r,t):void L(19439)}function Kf(r,t){let e=r.filters.concat(t);return tt.create(e,r.op)}function $f(r){return r instanceof H?(function(e){return`${e.field.canonicalString()} ${e.op} ${ur(e.value)}`})(r):r instanceof tt?(function(e){return e.op.toString()+" {"+e.getFilters().map($f).join(" ,")+"}"})(r):"Filter"}function Qf(r,t){return(t.arrayValue?.values||[]).map(e=>F.fromName(e.referenceValue))}function du(r,t=null,e=[],n=[],s=null,i=null,a=null){return new hu(r,t,e,n,s,i,a)}function wn(r){let t=M(r);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>su(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>(function(i){return i.field.canonicalString()+i.dir})(n)).join(","),Bs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>ur(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>ur(n)).join(",")),t.Te=e}return t.Te}function Gs(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Kp(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!zf(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!fd(r.startAt,t.startAt)&&fd(r.endAt,t.endAt)}function qi(r){return F.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ui(r,t){return r.filters.filter(e=>e instanceof H&&e.field.isEqual(t))}function md(r,t,e){let n=Ei,s=!0;for(let i of Ui(r,t)){let a=Ei,u=!0;switch(i.op){case"<":case"<=":a=Gp(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,u=!1;break;case"!=":case"not-in":a=Ei}ld({value:n,inclusive:s},{value:a,inclusive:u})<0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];ld({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function gd(r,t,e){let n=ke,s=!0;for(let i of Ui(r,t)){let a=ke,u=!0;switch(i.op){case">=":case">":a=zp(i.value),u=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,u=!1;break;case"!=":case"not-in":a=ke}hd({value:n,inclusive:s},{value:a,inclusive:u})>0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];hd({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function Wf(r,t,e,n,s,i,a,u){return new Qt(r,t,e,n,s,i,a,u)}function vr(r){return new Qt(r)}function pd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function il(r){return r.collectionGroup!==null}function Hn(r){let t=M(r);if(t.Ie===null){t.Ie=[];let e=new Set;for(let i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new nt(It.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new _n(i,n))}),e.has(It.keyField().canonicalString())||t.Ie.push(new _n(It.keyField(),n))}return t.Ie}function xt(r){let t=M(r);return t.Ee||(t.Ee=Jf(t,Hn(r))),t.Ee}function Hf(r){let t=M(r);return t.de||(t.de=Jf(t,r.explicitOrderBy)),t.de}function Jf(r,t){if(r.limitType==="F")return du(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new _n(s.field,i)});let e=r.endAt?new ae(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new ae(r.startAt.position,r.startAt.inclusive):null;return du(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function fu(r,t){let e=r.filters.concat([t]);return new Qt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Bi(r,t,e){return new Qt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function zs(r,t){return Gs(xt(r),xt(t))&&r.limitType===t.limitType}function Xf(r){return`${wn(xt(r))}|lt:${r.limitType}`}function Kn(r){return`Query(target=${(function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>$f(s)).join(", ")}]`),Bs(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>ur(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>ur(s)).join(",")),`Target(${n})`})(xt(r))}; limitType=${r.limitType})`}function Ks(r,t){return t.isFoundDocument()&&(function(n,s){let i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):F.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)})(r,t)&&(function(n,s){for(let i of Hn(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(r,t)&&(function(n,s){for(let i of n.filters)if(!i.matches(s))return!1;return!0})(r,t)&&(function(n,s){return!(n.startAt&&!(function(a,u,c){let h=dd(a,u,c);return a.inclusive?h<=0:h<0})(n.startAt,Hn(n),s)||n.endAt&&!(function(a,u,c){let h=dd(a,u,c);return a.inclusive?h>=0:h>0})(n.endAt,Hn(n),s))})(r,t)}function Yf(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Zf(r){return(t,e)=>{let n=!1;for(let s of Hn(r)){let i=$p(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function $p(r,t,e){let n=r.field.isKeyField()?F.comparator(t.key,e.key):(function(i,a,u){let c=a.data.field(i),h=u.data.field(i);return c!==null&&h!==null?je(c,h):L(42886)})(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L(19790,{direction:r.dir})}}function Ot(){return Qp}function Yr(...r){let t=tm;for(let e of r)t=t.insert(e.key,e);return t}function em(r){let t=tm;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function ee(){return ss()}function nm(){return ss()}function ss(){return new Wt(r=>r.toString(),(r,t)=>r.isEqual(t))}function K(...r){let t=Hp;for(let e of r)t=t.add(e);return t}function ol(){return Jp}function al(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ls(t)?"-0":t}}function rm(r){return{integerValue:""+r}}function sm(r,t){return Ef(t)?rm(t):al(r,t)}function Xp(r,t,e){return r instanceof Ge?(function(s,i){let a={fields:{[Of]:{stringValue:Mf},[Lf]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&No(i)&&(i=ko(i)),i&&(a.fields[Ff]=i),{mapValue:a}})(e,t):r instanceof ye?om(r,t):r instanceof _e?am(r,t):(function(s,i){let a=im(s,i),u=yd(a)+yd(s.Ae);return nu(a)&&nu(s.Ae)?rm(u):al(s.serializer,u)})(r,t)}function Yp(r,t,e){return r instanceof ye?om(r,t):r instanceof _e?am(r,t):e}function im(r,t){return r instanceof ze?(function(n){return nu(n)||(function(i){return!!i&&"doubleValue"in i})(n)})(t)?t:{integerValue:0}:null}function om(r,t){let e=um(t);for(let n of r.elements)e.some(s=>oe(s,n))||e.push(n);return{arrayValue:{values:e}}}function am(r,t){let e=um(t);for(let n of r.elements)e=e.filter(s=>!oe(s,n));return{arrayValue:{values:e}}}function yd(r){return at(r.integerValue||r.doubleValue)}function um(r){return _s(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function Zp(r,t){return r.field.isEqual(t.field)&&(function(n,s){return n instanceof ye&&s instanceof ye||n instanceof _e&&s instanceof _e?Zn(n.elements,s.elements,oe):n instanceof ze&&s instanceof ze?oe(n.Ae,s.Ae):n instanceof Ge&&s instanceof Ge})(r.transform,t.transform)}function Si(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}function cm(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new $e(r.key,ht.none()):new Ke(r.key,r.data,ht.none());{let e=r.data,n=Vt.empty(),s=new nt(It.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new Ht(r.key,n,new Ut(s.toArray()),ht.none())}}function ty(r,t,e){r instanceof Ke?(function(s,i,a){let u=s.value.clone(),c=wd(s.fieldTransforms,i,a.transformResults);u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(r,t,e):r instanceof Ht?(function(s,i,a){if(!Si(s.precondition,i))return void i.convertToUnknownDocument(a.version);let u=wd(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(lm(s)),c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(r,t,e):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function is(r,t,e,n){return r instanceof Ke?(function(i,a,u,c){if(!Si(i.precondition,a))return u;let h=i.value.clone(),f=Td(i.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(r,t,e,n):r instanceof Ht?(function(i,a,u,c){if(!Si(i.precondition,a))return u;let h=Td(i.fieldTransforms,c,a),f=a.data;return f.setAll(lm(i)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))})(r,t,e,n):(function(i,a,u){return Si(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(r,t,e)}function ey(r,t){let e=null;for(let n of r.fieldTransforms){let s=t.data.field(n.field),i=im(n.transform,s||null);i!=null&&(e===null&&(e=Vt.empty()),e.set(n.field,i))}return e||null}function _d(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Zn(n,s,(i,a)=>Zp(i,a))})(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}function lm(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function wd(r,t,e){let n=new Map;q(r.length===e.length,32656,{Re:e.length,Ve:r.length});for(let s=0;s<e.length;s++){let i=r[s],a=i.transform,u=t.data.field(i.field);n.set(i.field,Yp(a,u,e[s]))}return n}function Td(r,t,e){let n=new Map;for(let s of r){let i=s.transform,a=e.data.field(s.field);n.set(s.field,Xp(i,a,t))}return n}function hm(r){switch(r){case A.OK:return L(64938);case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return L(15467,{code:r})}}function dm(r){if(r===void 0)return dt("GRPC error has no .code"),A.UNKNOWN;switch(r){case pt.OK:return A.OK;case pt.CANCELLED:return A.CANCELLED;case pt.UNKNOWN:return A.UNKNOWN;case pt.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case pt.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case pt.INTERNAL:return A.INTERNAL;case pt.UNAVAILABLE:return A.UNAVAILABLE;case pt.UNAUTHENTICATED:return A.UNAUTHENTICATED;case pt.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case pt.NOT_FOUND:return A.NOT_FOUND;case pt.ALREADY_EXISTS:return A.ALREADY_EXISTS;case pt.PERMISSION_DENIED:return A.PERMISSION_DENIED;case pt.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case pt.ABORTED:return A.ABORTED;case pt.OUT_OF_RANGE:return A.OUT_OF_RANGE;case pt.UNIMPLEMENTED:return A.UNIMPLEMENTED;case pt.DATA_LOSS:return A.DATA_LOSS;default:return L(39323,{code:r})}}function fm(){return new TextEncoder}function Id(r){let t=fm().encode(r),e=new Aa;return e.update(t),new Uint8Array(e.digest())}function Ed(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new ce([e,n],0),new ce([s,i],0)]}function mi(){return new ot(F.comparator)}function vd(){return new ot(F.comparator)}function Iu(r,t){return r.useProto3Json||Bs(t)?t:{value:t}}function dr(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function mm(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function oy(r,t){return dr(r,t.toTimestamp())}function ft(r){return q(!!r,49232),B.fromTimestamp((function(e){let n=ge(e);return new ut(n.seconds,n.nanos)})(r))}function ul(r,t){return Eu(r,t).canonicalString()}function Eu(r,t){let e=(function(s){return new W(["projects",s.projectId,"databases",s.database])})(r).child("documents");return t===void 0?e:e.child(t)}function gm(r){let t=W.fromString(r);return q(Am(t),10190,{key:t.toString()}),t}function As(r,t){return ul(r.databaseId,t.path)}function se(r,t){let e=gm(t);if(e.get(1)!==r.databaseId.projectId)throw new C(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new C(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new F(_m(e))}function pm(r,t){return ul(r.databaseId,t)}function ym(r){let t=gm(r);return t.length===4?W.emptyPath():_m(t)}function vu(r){return new W(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function _m(r){return q(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function Ad(r,t,e){return{name:As(r,t),fields:e.value.mapValue.fields}}function Oo(r,t,e){let n=se(r,t.name),s=ft(t.updateTime),i=t.createTime?ft(t.createTime):B.min(),a=new Vt({mapValue:{fields:t.fields}}),u=Et.newFoundDocument(n,s,i,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function ay(r,t){return"found"in t?(function(n,s){q(!!s.found,43571),s.found.name,s.found.updateTime;let i=se(n,s.found.name),a=ft(s.found.updateTime),u=s.found.createTime?ft(s.found.createTime):B.min(),c=new Vt({mapValue:{fields:s.found.fields}});return Et.newFoundDocument(i,a,u,c)})(r,t):"missing"in t?(function(n,s){q(!!s.missing,3894),q(!!s.readTime,22933);let i=se(n,s.missing),a=ft(s.readTime);return Et.newNoDocument(i,a)})(r,t):L(7234,{result:t})}function uy(r,t){let e;if("targetChange"in t){t.targetChange;let n=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:L(39313,{state:h})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=(function(h,f){return h.useProto3Json?(q(f===void 0||typeof f=="string",58123),mt.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),mt.fromUint8Array(f||new Uint8Array))})(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&(function(h){let f=h.code===void 0?A.UNKNOWN:dm(h.code);return new C(f,h.message||"")})(a);e=new zi(n,s,i,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let s=se(r,n.document.name),i=ft(n.document.updateTime),a=n.document.createTime?ft(n.document.createTime):B.min(),u=new Vt({mapValue:{fields:n.document.fields}}),c=Et.newFoundDocument(s,i,a,u),h=n.targetIds||[],f=n.removedTargetIds||[];e=new Jn(h,f,c.key,c)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let s=se(r,n.document),i=n.readTime?ft(n.readTime):B.min(),a=Et.newNoDocument(s,i),u=n.removedTargetIds||[];e=new Jn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let s=se(r,n.document),i=n.removedTargetIds||[];e=new Jn([],i,s,null)}else{if(!("filter"in t))return L(11601,{Rt:t});{t.filter;let n=t.filter;n.targetId;let{count:s=0,unchangedNames:i}=n,a=new pu(s,i),u=n.targetId;e=new Gi(u,a)}}return e}function Ss(r,t){let e;if(t instanceof Ke)e={update:Ad(r,t.key,t.value)};else if(t instanceof $e)e={delete:As(r,t.key)};else if(t instanceof Ht)e={update:Ad(r,t.key,t.data),updateMask:my(t.fieldMask)};else{if(!(t instanceof ws))return L(16599,{Vt:t.type});e={verify:As(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>(function(i,a){let u=a.transform;if(u instanceof Ge)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ye)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof _e)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof ze)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw L(20930,{transform:a.transform})})(0,n))),t.precondition.isNone||(e.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:oy(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:L(27497)})(r,t.precondition)),e}function Au(r,t){let e=t.currentDocument?(function(i){return i.updateTime!==void 0?ht.updateTime(ft(i.updateTime)):i.exists!==void 0?ht.exists(i.exists):ht.none()})(t.currentDocument):ht.none(),n=t.updateTransforms?t.updateTransforms.map(s=>(function(a,u){let c=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),c=new Ge;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new ye(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new _e(f)}else"increment"in u?c=new ze(a,u.increment):L(16584,{proto:u});let h=It.fromServerFormat(u.fieldPath);return new Tn(h,c)})(r,s)):[];if(t.update){t.update.name;let s=se(r,t.update.name),i=new Vt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=(function(c){let h=c.fieldPaths||[];return new Ut(h.map(f=>It.fromServerFormat(f)))})(t.updateMask);return new Ht(s,i,a,e,n)}return new Ke(s,i,e,n)}if(t.delete){let s=se(r,t.delete);return new $e(s,e)}if(t.verify){let s=se(r,t.verify);return new ws(s,e)}return L(1463,{proto:t})}function cy(r,t){return r&&r.length>0?(q(t!==void 0,14353),r.map(e=>(function(s,i){let a=s.updateTime?ft(s.updateTime):ft(i);return a.isEqual(B.min())&&(a=ft(i)),new mu(a,s.transformResults||[])})(e,t))):[]}function wm(r,t){return{documents:[pm(r,t.path)]}}function Fo(r,t){let e={structuredQuery:{}},n=t.path,s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=pm(r,s);let i=(function(h){if(h.length!==0)return vm(tt.create(h,"and"))})(t.filters);i&&(e.structuredQuery.where=i);let a=(function(h){if(h.length!==0)return h.map(f=>(function(y){return{field:De(y.field),direction:hy(y.dir)}})(f))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=Iu(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(t.endAt)),{ft:e,parent:s}}function Tm(r,t,e,n){let{ft:s,parent:i}=Fo(r,t),a={},u=[],c=0;return e.forEach(h=>{let f=n?h.alias:"aggregate_"+c++;a[f]=h.alias,h.aggregateType==="count"?u.push({alias:f,count:{}}):h.aggregateType==="avg"?u.push({alias:f,avg:{field:De(h.fieldPath)}}):h.aggregateType==="sum"&&u.push({alias:f,sum:{field:De(h.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:u,structuredQuery:s.structuredQuery},parent:s.parent},gt:a,parent:i}}function Im(r){let t=ym(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,s=null;if(n>0){q(n===1,65062);let f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let i=[];e.where&&(i=(function(g){let y=Em(g);return y instanceof tt&&sl(y)?y.getFilters():[y]})(e.where));let a=[];e.orderBy&&(a=(function(g){return g.map(y=>(function(k){return new _n($n(k.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(y))})(e.orderBy));let u=null;e.limit&&(u=(function(g){let y;return y=typeof g=="object"?g.value:g,Bs(y)?null:y})(e.limit));let c=null;e.startAt&&(c=(function(g){let y=!!g.before,R=g.values||[];return new ae(R,y)})(e.startAt));let h=null;return e.endAt&&(h=(function(g){let y=!g.before,R=g.values||[];return new ae(R,y)})(e.endAt)),Wf(t,s,a,i,u,"F",c,h)}function ly(r,t){let e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Em(r){return r.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=$n(e.unaryFilter.field);return H.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=$n(e.unaryFilter.field);return H.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=$n(e.unaryFilter.field);return H.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=$n(e.unaryFilter.field);return H.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(r):r.fieldFilter!==void 0?(function(e){return H.create($n(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(e){return tt.create(e.compositeFilter.filters.map(n=>Em(n)),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(e.compositeFilter.op))})(r):L(30097,{filter:r})}function hy(r){return ry[r]}function dy(r){return sy[r]}function fy(r){return iy[r]}function De(r){return{fieldPath:r.canonicalString()}}function $n(r){return It.fromServerFormat(r.fieldPath)}function vm(r){return r instanceof H?(function(e){if(e.op==="=="){if(cd(e.value))return{unaryFilter:{field:De(e.field),op:"IS_NAN"}};if(ud(e.value))return{unaryFilter:{field:De(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(cd(e.value))return{unaryFilter:{field:De(e.field),op:"IS_NOT_NAN"}};if(ud(e.value))return{unaryFilter:{field:De(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:De(e.field),op:dy(e.op),value:e.value}}})(r):r instanceof tt?(function(e){let n=e.getFilters().map(s=>vm(s));return n.length===1?n[0]:{compositeFilter:{op:fy(e.op),filters:n}}})(r):L(54877,{filter:r})}function my(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Am(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}function gy(r,t){let e;if(t.document)e=Oo(r.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=F.fromSegments(t.noDocument.path),s=En(t.noDocument.readTime);e=Et.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L(56709);{let n=F.fromSegments(t.unknownDocument.path),s=En(t.unknownDocument.version);e=Et.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime((function(s){let i=new ut(s[0],s[1]);return B.fromTimestamp(i)})(t.readTime)),e}function Sd(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Qi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=(function(i,a){return{name:As(i,a.key),fields:a.data.value.mapValue.fields,updateTime:dr(i,a.version.toTimestamp()),createTime:dr(i,a.createTime.toTimestamp())}})(r.yt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:In(t.version)};else{if(!t.isUnknownDocument())return L(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:In(t.version)}}return n}function Qi(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function In(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function En(r){let t=new ut(r.seconds,r.nanoseconds);return B.fromTimestamp(t)}function ln(r,t){let e=(t.baseMutations||[]).map(i=>Au(r.yt,i));for(let i=0;i<t.mutations.length-1;++i){let a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){let u=t.mutations[i+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}let n=t.mutations.map(i=>Au(r.yt,i)),s=ut.fromMillis(t.localWriteTimeMs);return new Ts(t.batchId,s,e,n)}function Zr(r){let t=En(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?En(r.lastLimboFreeSnapshotVersion):B.min(),n;return n=(function(i){return i.documents!==void 0})(r.query)?(function(i){let a=i.documents.length;return q(a===1,1966,{count:a}),xt(vr(ym(i.documents[0])))})(r.query):(function(i){return xt(Im(i))})(r.query),new fr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,mt.fromBase64String(r.resumeToken))}function Sm(r,t){let e=In(t.snapshotVersion),n=In(t.lastLimboFreeSnapshotVersion),s;s=qi(t.target)?wm(r.yt,t.target):Fo(r.yt,t.target).ft;let i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:wn(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Lo(r){let t=Im({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Bi(t,t.limit,"L"):t}function xa(r,t){return new Is(t.largestBatchId,Au(r.yt,t.overlayMutation))}function bd(r,t){let e=t.path.lastSegment();return[r,Ct(t.path.popLast()),e]}function Rd(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:In(n.readTime),documentKey:Ct(n.documentKey.path),largestBatchId:n.largestBatchId}}function Pd(r){return At(r,Co)}function Vd(r){return At(r,xo)}function Wr(r){return At(r,Do)}function py(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function Cd(r){let t=64-(function(n){let s=0;for(let i=0;i<8;++i){let a=py(255&n[i]);if(s+=a,a!==8)break}return s})(r);return Math.ceil(t/8)}function Ve(r,t){let e=r.Tn-t.Tn;return e!==0?e:(e=xd(r.En,t.En),e!==0?e:(e=xd(r.dn,t.dn),e!==0?e:F.comparator(r.In,t.In)))}function xd(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function bi(r){return Ia()?(function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n})(r):r}function Dd(r){return typeof r!="string"?r:(function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(r)}function bm(r){if(q(r instanceof H||r instanceof tt,20012),r instanceof H){if(r instanceof Li){let e=r.value.arrayValue?.values?.map(n=>H.create(r.field,"==",n))||[];return tt.create(e,"or")}return r}let t=r.filters.map(e=>bm(e));return tt.create(t,r.op)}function yy(r){if(r.getFilters().length===0)return[];let t=Du(bm(r));return q(Rm(t),7391),Cu(t)||xu(t)?[t]:t.getFilters()}function Cu(r){return r instanceof H}function xu(r){return r instanceof tt&&sl(r)}function Rm(r){return Cu(r)||xu(r)||(function(e){if(e instanceof tt&&ru(e)){for(let n of e.getFilters())if(!Cu(n)&&!xu(n))return!1;return!0}return!1})(r)}function Du(r){if(q(r instanceof H||r instanceof tt,34018),r instanceof H)return r;if(r.filters.length===1)return Du(r.filters[0]);let t=r.filters.map(n=>Du(n)),e=tt.create(t,r.op);return e=Ji(e),Rm(e)?e:(q(e instanceof tt,64498),q(cr(e),40251),q(e.filters.length>1,57927),e.filters.reduce((n,s)=>cl(n,s)))}function cl(r,t){let e;return q(r instanceof H||r instanceof tt,38388),q(t instanceof H||t instanceof tt,25473),e=r instanceof H?t instanceof H?(function(s,i){return tt.create([s,i],"and")})(r,t):Nd(r,t):t instanceof H?Nd(t,r):(function(s,i){if(q(s.filters.length>0&&i.filters.length>0,48005),cr(s)&&cr(i))return Kf(s,i.getFilters());let a=ru(s)?s:i,u=ru(s)?i:s,c=a.filters.map(h=>cl(h,u));return tt.create(c,"or")})(r,t),Ji(e)}function Nd(r,t){if(cr(t))return Kf(t,r.getFilters());{let e=t.filters.map(n=>cl(r,n));return tt.create(e,"or")}}function Ji(r){if(q(r instanceof H||r instanceof tt,11850),r instanceof H)return r;let t=r.getFilters();if(t.length===1)return Ji(t[0]);if(Gf(r))return r;let e=t.map(s=>Ji(s)),n=[];return e.forEach(s=>{s instanceof H?n.push(s):s instanceof tt&&(s.op===r.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:tt.create(n,r.op)}function Md(r){return At(r,fs)}function Bn(r){return At(r,ns)}function Hr(r){return At(r,Zc)}function jn(r){return At(r,es)}function Od(r){q(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let s=r[n].indexState.offset;Jc(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new Kt(t.readTime,t.documentKey,e)}function Vm(r,t,e){let n=r.store($t),s=r.store(nr),i=[],a=IDBKeyRange.only(e.batchId),u=0,c=n.ee({range:a},(f,g,y)=>(u++,y.delete()));i.push(c.next(()=>{q(u===1,47070,{batchId:e.batchId})}));let h=[];for(let f of e.mutations){let g=vf(t,f.key.path,e.batchId);i.push(s.delete(g)),h.push(f.key)}return b.waitFor(i).next(()=>h)}function Xi(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L(14731);t=r.noDocument}return JSON.stringify(t).length}function Cm(r,t,e){let n=Ti(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n),a=!1;return Qn(r).ee({range:i,X:!0},(u,c,h)=>{let[f,g,y]=u;f===t&&g===s&&(a=!0),h.done()}).next(()=>a)}function Ce(r){return At(r,$t)}function Qn(r){return At(r,nr)}function xm(r){return At(r,hs)}function Gn(r){return At(r,rr)}function Ld(r){return At(r,pn)}function Ne(r){return At(r,sr)}function Ud([r,t],[e,n]){let s=G(r,e);return s===0?G(t,n):s}function Nm(r,t){return new Fu(r,t)}function pi(r,t){return Ne(r).put((function(n,s){return{targetId:0,path:Ct(n.path),sequenceNumber:s}})(t,r.currentSequenceNumber))}function km(r){return new qu(r)}function Bd(r){return At(r,ds)}function on(r){return At(r,Ni)}function Jr(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function jd(r,t){let e=t.documentKey.path.toArray();return[r,Qi(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Gd(r,t){let e=r.path.toArray(),n=t.path.toArray(),s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=G(e[i],n[i]),s)return s;return s=G(e.length,n.length),s||(s=G(e[e.length-2],n[n.length-2]),s||G(e[e.length-1],n[n.length-1]))}function zd(r){r.createObjectStore(sr,{keyPath:vp}).createIndex(Yc,Ap,{unique:!0}),r.createObjectStore(rr,{keyPath:"targetId"}).createIndex(Sf,Ep,{unique:!0}),r.createObjectStore(pn)}function Xr(r){return At(r,js)}function yi(r){return At(r,ir)}function ll(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}function Om(r,t,e,n){return new tc(r,t,e,n)}function Fm(r,t){return V(this,null,function*(){let e=M(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(i=>{let a=[],u=[],c=K();for(let h of s){a.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}for(let h of i){u.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}return e.localDocuments.getDocuments(n,c).next(h=>({Ls:h,removedBatchIds:a,addedBatchIds:u}))})})})}function wy(r,t){let e=M(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=t.batch.keys(),i=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,c,h,f){let g=h.batch,y=g.keys(),R=b.resolve();return y.forEach(k=>{R=R.next(()=>f.getEntry(c,k)).next(x=>{let D=h.docVersions.get(k);q(D!==null,48541),x.version.compareTo(D)<0&&(g.applyToRemoteDocument(x,h),x.isValidDocument()&&(x.setReadTime(h.commitVersion),f.addEntry(x)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(c,g))})(e,n,t,i).next(()=>i.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(u){let c=K();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c})(t))).next(()=>e.localDocuments.getDocuments(n,s))})}function Lm(r){let t=M(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function Ty(r,t){let e=M(r),n=t.snapshotVersion,s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;let u=[];t.targetChanges.forEach((f,g)=>{let y=s.get(g);if(!y)return;u.push(e.Pi.removeMatchingKeys(i,f.removedDocuments,g).next(()=>e.Pi.addMatchingKeys(i,f.addedDocuments,g)));let R=y.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(g)!==null?R=R.withResumeToken(mt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),s=s.insert(g,R),(function(x,D,U){return x.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=_y?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0})(y,R,f)&&u.push(e.Pi.updateTargetData(i,R))});let c=Ot(),h=K();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(i,f))}),u.push(qm(i,a,t.documentUpdates).next(f=>{c=f.ks,h=f.qs})),!n.isEqual(B.min())){let f=e.Pi.getLastRemoteSnapshotVersion(i).next(g=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(f)}return b.waitFor(u).next(()=>a.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,c,h)).next(()=>c)}).then(i=>(e.Ms=s,i))}function qm(r,t,e){let n=K(),s=K();return e.forEach(i=>n=n.add(i)),t.getEntries(r,n).next(i=>{let a=Ot();return e.forEach((u,c)=>{let h=i.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(u)),c.isNoDocument()&&c.version.isEqual(B.min())?(t.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c),a=a.insert(u,c)):N(hl,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{ks:a,qs:s}})}function Iy(r,t){let e=M(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=Oe),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function gr(r,t){let e=M(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return e.Pi.getTargetData(n,t).next(i=>i?(s=i,b.resolve(s)):e.Pi.allocateTargetId(n).next(a=>(s=new fr(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=e.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n})}function pr(r,t,e){return V(this,null,function*(){let n=M(r),s=n.Ms.get(t),i=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",i,a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Je(a))throw a;N(hl,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ms=n.Ms.remove(t),n.xs.delete(s.target)})}function io(r,t,e){let n=M(r),s=B.min(),i=K();return n.persistence.runTransaction("Execute query","readwrite",a=>(function(c,h,f){let g=M(c),y=g.xs.get(f);return y!==void 0?b.resolve(g.Ms.get(y)):g.Pi.getTargetData(h,f)})(n,a,xt(t)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,u.targetId).next(c=>{i=c})}).next(()=>n.Fs.getDocumentsMatchingQuery(a,t,e?s:B.min(),e?i:K())).next(u=>(jm(n,Yf(t),u),{documents:u,Qs:i})))}function Um(r,t){let e=M(r),n=M(e.Pi),s=e.Ms.get(t);return s?Promise.resolve(s.target):e.persistence.runTransaction("Get target data","readonly",i=>n.At(i,t).next(a=>a?a.target:null))}function Bm(r,t){let e=M(r),n=e.Os.get(t)||B.min();return e.persistence.runTransaction("Get new document changes","readonly",s=>e.Ns.getAllFromCollectionGroup(s,t,_f(n,tr),Number.MAX_SAFE_INTEGER)).then(s=>(jm(e,t,s),s))}function jm(r,t,e){let n=r.Os.get(t)||B.min();e.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.Os.set(t,n)}function Ey(r,t,e,n){return V(this,null,function*(){let s=M(r),i=K(),a=Ot();for(let h of e){let f=t.$s(h.metadata.name);h.document&&(i=i.add(f));let g=t.Us(h);g.setReadTime(t.Ks(h.metadata.readTime)),a=a.insert(f,g)}let u=s.Ns.newChangeBuffer({trackRemovals:!0}),c=yield gr(s,(function(f){return xt(vr(W.fromString(`__bundle__/docs/${f}`)))})(n));return s.persistence.runTransaction("Apply bundle documents","readwrite",h=>qm(h,u,a).next(f=>(u.apply(h),f)).next(f=>s.Pi.removeMatchingKeysForTargetId(h,c.targetId).next(()=>s.Pi.addMatchingKeys(h,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(h,f.ks,f.qs)).next(()=>f.ks)))})}function vy(n,s){return V(this,arguments,function*(r,t,e=K()){let i=yield gr(r,xt(Lo(t.bundledQuery))),a=M(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let c=ft(t.readTime);if(i.snapshotVersion.compareTo(c)>=0)return a.Ii.saveNamedQuery(u,t);let h=i.withResumeToken(mt.EMPTY_BYTE_STRING,c);return a.Ms=a.Ms.insert(h.targetId,h),a.Pi.updateTargetData(u,h).next(()=>a.Pi.removeMatchingKeysForTargetId(u,i.targetId)).next(()=>a.Pi.addMatchingKeys(u,e,i.targetId)).next(()=>a.Ii.saveNamedQuery(u,t))})})}function Kd(r,t){return`${Gm}_${r}_${t}`}function $d(r,t,e){let n=`${zm}_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function Ma(r,t){return`${Km}_${r}_${t}`}function rc(){return _i===null?_i=(function(){return 268435456+Math.round(2147483648*Math.random())})():_i++,"0x"+_i.toString(16)}function $m(){return typeof window<"u"?window:null}function Ri(){return typeof document<"u"?document:null}function Cn(r){return new Tu(r,!0)}function $s(r){return V(this,null,function*(){if(Ye(r))for(let t of r.da)yield t(!0)})}function Ar(r){return V(this,null,function*(){for(let t of r.da)yield t(!1)})}function qo(r,t){let e=M(r);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),ml(e)?fl(e):br(e).O_()&&dl(e,t))}function yr(r,t){let e=M(r),n=br(e);e.Ia.delete(t),n.O_()&&Qm(e,t),e.Ia.size===0&&(n.O_()?n.L_():Ye(e)&&e.Ra.set("Unknown"))}function dl(r,t){if(r.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}br(r).Y_(t)}function Qm(r,t){r.Va.Ue(t),br(r).Z_(t)}function fl(r){r.Va=new wu({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),At:t=>r.Ia.get(t)||null,ht:()=>r.datastore.serializer.databaseId}),br(r).start(),r.Ra.ua()}function ml(r){return Ye(r)&&!br(r).x_()&&r.Ia.size>0}function Ye(r){return M(r).Ea.size===0}function Wm(r){r.Va=void 0}function Sy(r){return V(this,null,function*(){r.Ra.set("Online")})}function by(r){return V(this,null,function*(){r.Ia.forEach((t,e)=>{dl(r,t)})})}function Ry(r,t){return V(this,null,function*(){Wm(r),ml(r)?(r.Ra.ha(t),fl(r)):r.Ra.set("Unknown")})}function Py(r,t,e){return V(this,null,function*(){if(r.Ra.set("Online"),t instanceof zi&&t.state===2&&t.cause)try{yield(function(s,i){return V(this,null,function*(){let a=i.cause;for(let u of i.targetIds)s.Ia.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.Va.removeTarget(u))})})(r,t)}catch(n){N(vn,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield ho(r,n)}else if(t instanceof Jn?r.Va.Ze(t):t instanceof Gi?r.Va.st(t):r.Va.tt(t),!e.isEqual(B.min()))try{let n=yield Lm(r.localStore);e.compareTo(n)>=0&&(yield(function(i,a){let u=i.Va.Tt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let f=i.Ia.get(h);f&&i.Ia.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{let f=i.Ia.get(c);if(!f)return;i.Ia.set(c,f.withResumeToken(mt.EMPTY_BYTE_STRING,f.snapshotVersion)),Qm(i,c);let g=new fr(f.target,c,h,f.sequenceNumber);dl(i,g)}),i.remoteSyncer.applyRemoteEvent(u)})(r,e))}catch(n){N(vn,"Failed to raise snapshot:",n),yield ho(r,n)}})}function ho(r,t,e){return V(this,null,function*(){if(!Je(t))throw t;r.Ea.add(1),yield Ar(r),r.Ra.set("Offline"),e||(e=()=>Lm(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(null,null,function*(){N(vn,"Retrying IndexedDB access"),yield e(),r.Ea.delete(1),yield $s(r)}))})}function Hm(r,t){return t().catch(e=>ho(r,e,t))}function Sr(r){return V(this,null,function*(){let t=M(r),e=Qe(t),n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Oe;for(;Vy(t);)try{let s=yield Iy(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,Cy(t,s)}catch(s){yield ho(t,s)}Jm(t)&&Xm(t)})}function Vy(r){return Ye(r)&&r.Ta.length<10}function Cy(r,t){r.Ta.push(t);let e=Qe(r);e.O_()&&e.X_&&e.ea(t.mutations)}function Jm(r){return Ye(r)&&!Qe(r).x_()&&r.Ta.length>0}function Xm(r){Qe(r).start()}function xy(r){return V(this,null,function*(){Qe(r).ra()})}function Dy(r){return V(this,null,function*(){let t=Qe(r);for(let e of r.Ta)t.ea(e.mutations)})}function Ny(r,t,e){return V(this,null,function*(){let n=r.Ta.shift(),s=gu.from(n,t,e);yield Hm(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield Sr(r)})}function ky(r,t){return V(this,null,function*(){t&&Qe(r).X_&&(yield(function(n,s){return V(this,null,function*(){if((function(a){return hm(a)&&a!==A.ABORTED})(s.code)){let i=n.Ta.shift();Qe(n).B_(),yield Hm(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield Sr(n)}})})(r,t)),Jm(r)&&Xm(r)})}function Hd(r,t){return V(this,null,function*(){let e=M(r);e.asyncQueue.verifyOperationInProgress(),N(vn,"RemoteStore received new credentials");let n=Ye(e);e.Ea.add(3),yield Ar(e),n&&e.Ra.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),yield $s(e)})}function fc(r,t){return V(this,null,function*(){let e=M(r);t?(e.Ea.delete(2),yield $s(e)):t||(e.Ea.add(2),yield Ar(e),e.Ra.set("Unknown"))})}function br(r){return r.ma||(r.ma=(function(e,n,s){let i=M(e);return i.sa(),new ac(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Xo:Sy.bind(null,r),t_:by.bind(null,r),r_:Ry.bind(null,r),H_:Py.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.ma.B_(),ml(r)?fl(r):r.Ra.set("Unknown")):(yield r.ma.stop(),Wm(r))}))),r.ma}function Qe(r){return r.fa||(r.fa=(function(e,n,s){let i=M(e);return i.sa(),new uc(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:xy.bind(null,r),r_:ky.bind(null,r),ta:Dy.bind(null,r),na:Ny.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.fa.B_(),yield Sr(r)):(yield r.fa.stop(),r.Ta.length>0&&(N(vn,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}function Rr(r,t){if(dt("AsyncQueue",`${t}: ${r}`),Je(r))return new C(A.UNAVAILABLE,`${t}: ${r}`);throw r}function Jd(){return new Wt(r=>Xf(r),zs)}function gl(r,t){return V(this,null,function*(){let e=M(r),n=3,s=t.query,i=e.queries.get(s);i?!i.ba()&&t.Da()&&(n=2):(i=new gc,n=t.Da()?0:1);try{switch(n){case 0:i.wa=yield e.onListen(s,!0);break;case 1:i.wa=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(a){let u=Rr(a,`Initialization of query '${Kn(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&yl(e)})}function pl(r,t){return V(this,null,function*(){let e=M(r),n=t.query,s=3,i=e.queries.get(n);if(i){let a=i.Sa.indexOf(t);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=t.Da()?0:1:!i.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function My(r,t){let e=M(r),n=!1;for(let s of t){let i=s.query,a=e.queries.get(i);if(a){for(let u of a.Sa)u.Fa(s)&&(n=!0);a.wa=s}}n&&yl(e)}function Oy(r,t,e){let n=M(r),s=n.queries.get(t);if(s)for(let i of s.Sa)i.onError(e);n.queries.delete(t)}function yl(r){r.Ca.forEach(t=>{t.next()})}function Ym(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}function Fy(r,t,e=!0){return V(this,null,function*(){let n=Uo(r),s,i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=yield Zm(n,t,e,!0),s})}function Ly(r,t){return V(this,null,function*(){let e=Uo(r);yield Zm(e,t,!0,!1)})}function Zm(r,t,e,n){return V(this,null,function*(){let s=yield gr(r.localStore,xt(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e),u;return n&&(u=yield _l(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&qo(r.remoteStore,s),u})}function _l(r,t,e,n,s){return V(this,null,function*(){r.pu=(g,y,R)=>(function(x,D,U,z){return V(this,null,function*(){let j=D.view.ru(U);j.Cs&&(j=yield io(x.localStore,D.query,!1).then(({documents:T})=>D.view.ru(T,j)));let Z=z&&z.targetChanges.get(D.targetId),Y=z&&z.targetMismatches.get(D.targetId)!=null,J=D.view.applyChanges(j,x.isPrimaryClient,Z,Y);return Ic(x,D.targetId,J.au),J.snapshot})})(r,g,y,R);let i=yield io(r.localStore,t,!0),a=new _o(t,i.Qs),u=a.ru(i.documents),c=vs.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),h=a.applyChanges(u,r.isPrimaryClient,c);Ic(r,e,h.au);let f=new _c(t,e,a);return r.Tu.set(t,f),r.Iu.has(e)?r.Iu.get(e).push(t):r.Iu.set(e,[t]),h.snapshot})}function qy(r,t,e){return V(this,null,function*(){let n=M(r),s=n.Tu.get(t),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter(a=>!zs(a,t))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield pr(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),e&&yr(n.remoteStore,s.targetId),_r(n,s.targetId)}).catch(He))):(_r(n,s.targetId),yield pr(n.localStore,s.targetId,!0))})}function Uy(r,t){return V(this,null,function*(){let e=M(r),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),yr(e.remoteStore,n.targetId))})}function By(r,t,e){return V(this,null,function*(){let n=El(r);try{let s=yield(function(a,u){let c=M(a),h=ut.now(),f=u.reduce((R,k)=>R.add(k.key),K()),g,y;return c.persistence.runTransaction("Locally write mutations","readwrite",R=>{let k=Ot(),x=K();return c.Ns.getEntries(R,f).next(D=>{k=D,k.forEach((U,z)=>{z.isValidDocument()||(x=x.add(U))})}).next(()=>c.localDocuments.getOverlayedDocuments(R,k)).next(D=>{g=D;let U=[];for(let z of u){let j=ey(z,g.get(z.key).overlayedDocument);j!=null&&U.push(new Ht(z.key,j,jf(j.value.mapValue),ht.exists(!0)))}return c.mutationQueue.addMutationBatch(R,h,U,u)}).next(D=>{y=D;let U=D.applyToLocalDocumentSet(g,x);return c.documentOverlayCache.saveOverlays(R,D.batchId,U)})}).then(()=>({batchId:y.batchId,changes:em(g)}))})(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),(function(a,u,c){let h=a.Vu[a.currentUser.toKey()];h||(h=new ot(G)),h=h.insert(u,c),a.Vu[a.currentUser.toKey()]=h})(n,s.batchId,e),yield Ie(n,s.changes),yield Sr(n.remoteStore)}catch(s){let i=Rr(s,"Failed to persist write");e.reject(i)}})}function tg(r,t){return V(this,null,function*(){let e=M(r);try{let n=yield Ty(e.localStore,t);t.targetChanges.forEach((s,i)=>{let a=e.Au.get(i);a&&(q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?q(a.hu,14607):s.removedDocuments.size>0&&(q(a.hu,42227),a.hu=!1))}),yield Ie(e,n,t)}catch(n){yield He(n)}})}function Yd(r,t,e){let n=M(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let s=[];n.Tu.forEach((i,a)=>{let u=a.view.va(t);u.snapshot&&s.push(u.snapshot)}),(function(a,u){let c=M(a);c.onlineState=u;let h=!1;c.queries.forEach((f,g)=>{for(let y of g.Sa)y.va(u)&&(h=!0)}),h&&yl(c)})(n.eventManager,t),s.length&&n.Pu.H_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function jy(r,t,e){return V(this,null,function*(){let n=M(r);n.sharedClientState.updateQueryState(t,"rejected",e);let s=n.Au.get(t),i=s&&s.key;if(i){let a=new ot(F.comparator);a=a.insert(i,Et.newNoDocument(i,B.min()));let u=K().add(i),c=new Es(B.min(),new Map,new ot(G),a,u);yield tg(n,c),n.du=n.du.remove(i),n.Au.delete(t),Il(n)}else yield pr(n.localStore,t,!1).then(()=>_r(n,t,e)).catch(He)})}function Gy(r,t){return V(this,null,function*(){let e=M(r),n=t.batch.batchId;try{let s=yield wy(e.localStore,t);Tl(e,n,null),wl(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield Ie(e,s)}catch(s){yield He(s)}})}function zy(r,t,e){return V(this,null,function*(){let n=M(r);try{let s=yield(function(a,u){let c=M(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(q(g!==null,37113),f=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})})(n.localStore,t);Tl(n,t,e),wl(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield Ie(n,s)}catch(s){yield He(s)}})}function Ky(r,t){return V(this,null,function*(){let e=M(r);Ye(e.remoteStore)||N(Ze,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield(function(a){let u=M(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))})(e.localStore);if(n===Oe)return void t.resolve();let s=e.mu.get(n)||[];s.push(t),e.mu.set(n,s)}catch(n){let s=Rr(n,"Initialization of waitForPendingWrites() operation failed");t.reject(s)}})}function wl(r,t){(r.mu.get(t)||[]).forEach(e=>{e.resolve()}),r.mu.delete(t)}function Tl(r,t,e){let n=M(r),s=n.Vu[n.currentUser.toKey()];if(s){let i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Vu[n.currentUser.toKey()]=s}}function _r(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Iu.get(t))r.Tu.delete(n),e&&r.Pu.yu(n,e);r.Iu.delete(t),r.isPrimaryClient&&r.Ru.jr(t).forEach(n=>{r.Ru.containsKey(n)||eg(r,n)})}function eg(r,t){r.Eu.delete(t.path.canonicalString());let e=r.du.get(t);e!==null&&(yr(r.remoteStore,e),r.du=r.du.remove(t),r.Au.delete(e),Il(r))}function Ic(r,t,e){for(let n of e)n instanceof po?(r.Ru.addReference(n.key,t),$y(r,n)):n instanceof yo?(N(Ze,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,t),r.Ru.containsKey(n.key)||eg(r,n.key)):L(19791,{wu:n})}function $y(r,t){let e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Eu.has(n)||(N(Ze,"New document in limbo: "+e),r.Eu.add(n),Il(r))}function Il(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let t=r.Eu.values().next().value;r.Eu.delete(t);let e=new F(W.fromString(t)),n=r.fu.next();r.Au.set(n,new wc(e)),r.du=r.du.insert(e,n),qo(r.remoteStore,new fr(xt(vr(e.path)),n,"TargetPurposeLimboResolution",qt.ce))}}function Ie(r,t,e){return V(this,null,function*(){let n=M(r),s=[],i=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach((u,c)=>{a.push(n.pu(c,t,e).then(h=>{if((h||e)&&n.isPrimaryClient){let f=h?!h.fromCache:e?.targetChanges.get(c.targetId)?.current;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){s.push(h);let f=Yu.As(c.targetId,h);i.push(f)}}))}),yield Promise.all(a),n.Pu.H_(s),yield(function(c,h){return V(this,null,function*(){let f=M(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>b.forEach(h,y=>b.forEach(y.Es,R=>f.persistence.referenceDelegate.addReference(g,y.targetId,R)).next(()=>b.forEach(y.ds,R=>f.persistence.referenceDelegate.removeReference(g,y.targetId,R)))))}catch(g){if(!Je(g))throw g;N(hl,"Failed to update sequence numbers: "+g)}for(let g of h){let y=g.targetId;if(!g.fromCache){let R=f.Ms.get(y),k=R.snapshotVersion,x=R.withLastLimboFreeSnapshotVersion(k);f.Ms=f.Ms.insert(y,x)}}})})(n.localStore,i))})}function Qy(r,t){return V(this,null,function*(){let e=M(r);if(!e.currentUser.isEqual(t)){N(Ze,"User change. New user:",t.toKey());let n=yield Fm(e.localStore,t);e.currentUser=t,(function(i,a){i.mu.forEach(u=>{u.forEach(c=>{c.reject(new C(A.CANCELLED,a))})}),i.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield Ie(e,n.Ls)}})}function Wy(r,t){let e=M(r),n=e.Au.get(t);if(n&&n.hu)return K().add(n.key);{let s=K(),i=e.Iu.get(t);if(!i)return s;for(let a of i){let u=e.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function Hy(r,t){return V(this,null,function*(){let e=M(r),n=yield io(e.localStore,t.query,!0),s=t.view.cu(n);return e.isPrimaryClient&&Ic(e,t.targetId,s.au),s})}function Jy(r,t){return V(this,null,function*(){let e=M(r);return Bm(e.localStore,t).then(n=>Ie(e,n))})}function Xy(r,t,e,n){return V(this,null,function*(){let s=M(r),i=yield(function(u,c){let h=M(u),f=M(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.er(g,c).next(y=>y?h.localDocuments.getDocuments(g,y):b.resolve(null)))})(s.localStore,t);i!==null?(e==="pending"?yield Sr(s.remoteStore):e==="acknowledged"||e==="rejected"?(Tl(s,t,n||null),wl(s,t),(function(u,c){M(M(u).mutationQueue).ir(c)})(s.localStore,t)):L(6720,"Unknown batchState",{Su:e}),yield Ie(s,i)):N(Ze,"Cannot apply mutation batch with id: "+t)})}function Yy(r,t){return V(this,null,function*(){let e=M(r);if(Uo(e),El(e),t===!0&&e.gu!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),s=yield Zd(e,n.toArray());e.gu=!0,yield fc(e.remoteStore,!0);for(let i of s)qo(e.remoteStore,i)}else if(t===!1&&e.gu!==!1){let n=[],s=Promise.resolve();e.Iu.forEach((i,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):s=s.then(()=>(_r(e,a),pr(e.localStore,a,!0))),yr(e.remoteStore,a)}),yield s,yield Zd(e,n),(function(a){let u=M(a);u.Au.forEach((c,h)=>{yr(u.remoteStore,h)}),u.Ru.Jr(),u.Au=new Map,u.du=new ot(F.comparator)})(e),e.gu=!1,yield fc(e.remoteStore,!1)}})}function Zd(r,t,e){return V(this,null,function*(){let n=M(r),s=[],i=[];for(let a of t){let u,c=n.Iu.get(a);if(c&&c.length!==0){u=yield gr(n.localStore,xt(c[0]));for(let h of c){let f=n.Tu.get(h),g=yield Hy(n,f);g.snapshot&&i.push(g.snapshot)}}else{let h=yield Um(n.localStore,a);u=yield gr(n.localStore,h),yield _l(n,ng(h),a,!1,u.resumeToken)}s.push(u)}return n.Pu.H_(i),s})}function ng(r){return Wf(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Zy(r){return(function(e){return M(M(e).persistence).Ts()})(M(r).localStore)}function t_(r,t,e,n){return V(this,null,function*(){let s=M(r);if(s.gu)return void N(Ze,"Ignoring unexpected query state notification.");let i=s.Iu.get(t);if(i&&i.length>0)switch(e){case"current":case"not-current":{let a=yield Bm(s.localStore,Yf(i[0])),u=Es.createSynthesizedRemoteEventForCurrentChange(t,e==="current",mt.EMPTY_BYTE_STRING);yield Ie(s,a,u);break}case"rejected":yield pr(s.localStore,t,!0),_r(s,t,n);break;default:L(64155,e)}})}function e_(r,t,e){return V(this,null,function*(){let n=Uo(r);if(n.gu){for(let s of t){if(n.Iu.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){N(Ze,"Adding an already active target "+s);continue}let i=yield Um(n.localStore,s),a=yield gr(n.localStore,i);yield _l(n,ng(i),a.targetId,!1,a.resumeToken),qo(n.remoteStore,a)}for(let s of e)n.Iu.has(s)&&(yield pr(n.localStore,s,!1).then(()=>{yr(n.remoteStore,s),_r(n,s)}).catch(He))}})}function Uo(r){let t=M(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=tg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Wy.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=jy.bind(null,t),t.Pu.H_=My.bind(null,t.eventManager),t.Pu.yu=Oy.bind(null,t.eventManager),t}function El(r){let t=M(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Gy.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=zy.bind(null,t),t}function n_(r,t,e){let n=M(r);(function(i,a,u){return V(this,null,function*(){try{let c=yield a.getMetadata();if(yield(function(R,k){let x=M(R),D=ft(k.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",U=>x.Ii.getBundleMetadata(U,k.id)).then(U=>!!U&&U.createTime.compareTo(D)>=0)})(i.localStore,c))return yield a.close(),u._completeWith((function(R){return{taskState:"Success",documentsLoaded:R.totalDocuments,bytesLoaded:R.totalBytes,totalDocuments:R.totalDocuments,totalBytes:R.totalBytes}})(c)),Promise.resolve(new Set);u._updateProgress(Ym(c));let h=new Ns(c,a.serializer),f=yield a.bu();for(;f;){let y=yield h.Ga(f);y&&u._updateProgress(y),f=yield a.bu()}let g=yield h.ja(i.localStore);return yield Ie(i,g.Ha,void 0),yield(function(R,k){let x=M(R);return x.persistence.runTransaction("Save bundle","readwrite",D=>x.Ii.saveBundleMetadata(D,k))})(i.localStore,c),u._completeWith(g.progress),Promise.resolve(g.Ja)}catch(c){return zt(Ze,`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,t,e).then(s=>{n.sharedClientState.notifyBundleLoaded(s)})}function tf(r,t=10240){let e=0;return{read(){return V(this,null,function*(){if(e<r.byteLength){let s={value:r.slice(e,e+t),done:!1};return e+=t,s}return{done:!0}})},cancel(){return V(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function Fa(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),N(We,"Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(s=>V(null,null,function*(){n.isEqual(s)||(yield Fm(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function ef(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield vl(r);N(We,"Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Hd(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Hd(t.remoteStore,s)),r._onlineComponents=t})}function vl(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N(We,"Using user provided OfflineComponentProvider");try{yield Fa(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===A.FAILED_PRECONDITION||s.code===A.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;zt("Error using user provided cache. Falling back to memory cache: "+e),yield Fa(r,new Bo)}}else N(We,"Using default OfflineComponentProvider"),yield Fa(r,new ks(void 0));return r._offlineComponents})}function jo(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(N(We,"Using user provided OnlineComponentProvider"),yield ef(r,r._uninitializedComponentsProvider._online)):(N(We,"Using default OnlineComponentProvider"),yield ef(r,new Pr))),r._onlineComponents})}function rg(r){return vl(r).then(t=>t.persistence)}function Vr(r){return vl(r).then(t=>t.localStore)}function sg(r){return jo(r).then(t=>t.remoteStore)}function Al(r){return jo(r).then(t=>t.syncEngine)}function ig(r){return jo(r).then(t=>t.datastore)}function Tr(r){return V(this,null,function*(){let t=yield jo(r),e=t.eventManager;return e.onListen=Fy.bind(null,t.syncEngine),e.onUnlisten=qy.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Ly.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Uy.bind(null,t.syncEngine),e})}function r_(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){let t=yield rg(r),e=yield sg(r);return t.setNetworkEnabled(!0),(function(s){let i=M(s);return i.Ea.delete(0),$s(i)})(e)}))}function s_(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){let t=yield rg(r),e=yield sg(r);return t.setNetworkEnabled(!1),(function(s){return V(this,null,function*(){let i=M(s);i.Ea.add(0),yield Ar(i),i.Ra.set("Offline")})})(e)}))}function i_(r,t){let e=new Tt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return(function(s,i,a){return V(this,null,function*(){try{let u=yield(function(h,f){let g=M(h);return g.persistence.runTransaction("read document","readonly",y=>g.localDocuments.getDocument(y,f))})(s,i);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new C(A.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=Rr(u,`Failed to get document '${i} from cache`);a.reject(c)}})})(yield Vr(r),t,e)})),e.promise}function og(r,t,e={}){let n=new Tt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return(function(i,a,u,c,h){let f=new wr({next:y=>{f.Nu(),a.enqueueAndForget(()=>pl(i,g));let R=y.docs.has(u);!R&&y.fromCache?h.reject(new C(A.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&y.fromCache&&c&&c.source==="server"?h.reject(new C(A.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new Ds(vr(u.path),f,{includeMetadataChanges:!0,qa:!0});return gl(i,g)})(yield Tr(r),r.asyncQueue,t,e,n)})),n.promise}function o_(r,t){let e=new Tt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return(function(s,i,a){return V(this,null,function*(){try{let u=yield io(s,i,!0),c=new _o(i,u.Qs),h=c.ru(u.documents),f=c.applyChanges(h,!1);a.resolve(f.snapshot)}catch(u){let c=Rr(u,`Failed to execute query '${i} against cache`);a.reject(c)}})})(yield Vr(r),t,e)})),e.promise}function ag(r,t,e={}){let n=new Tt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return(function(i,a,u,c,h){let f=new wr({next:y=>{f.Nu(),a.enqueueAndForget(()=>pl(i,g)),y.fromCache&&c.source==="server"?h.reject(new C(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new Ds(u,f,{includeMetadataChanges:!0,qa:!0});return gl(i,g)})(yield Tr(r),r.asyncQueue,t,e,n)})),n.promise}function a_(r,t,e){let n=new Tt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){try{let s=yield ig(r);n.resolve((function(a,u,c){return V(this,null,function*(){let h=M(a),{request:f,gt:g,parent:y}=Tm(h.serializer,Hf(u),c);h.connection.$o||delete f.parent;let R=(yield h.Ho("RunAggregationQuery",h.serializer.databaseId,y,f,1)).filter(x=>!!x.result);q(R.length===1,64727);let k=R[0].result?.aggregateFields;return Object.keys(k).reduce((x,D)=>(x[g[D]]=k[D],x),{})})})(s,t,e))}catch(s){n.reject(s)}})),n.promise}function u_(r,t){let e=new wr(t);return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return(function(s,i){M(s).Ca.add(i),i.next()})(yield Tr(r),e)})),()=>{e.Nu(),r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return(function(s,i){M(s).Ca.delete(i)})(yield Tr(r),e)}))}}function c_(r,t,e,n){let s=(function(a,u){let c;return c=typeof a=="string"?fm().encode(a):a,(function(f,g){return new Ec(f,g)})((function(f,g){if(f instanceof Uint8Array)return tf(f,g);if(f instanceof ArrayBuffer)return tf(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(c),u)})(e,Cn(t));r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){n_(yield Al(r),s,n)}))}function l_(r,t){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return(function(n,s){let i=M(n);return i.persistence.runTransaction("Get named query","readonly",a=>i.Ii.getNamedQuery(a,s))})(yield Vr(r),t)}))}function ug(r,t){return(function(n,s){return new vc(n,s)})(r,t)}function h_(r,t){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return(function(n,s){return V(this,null,function*(){let i=M(n),a=i.indexManager,u=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>a.getFieldIndexes(c).next(h=>(function(g,y,R,k,x){g=[...g],y=[...y],g.sort(R),y.sort(R);let D=g.length,U=y.length,z=0,j=0;for(;z<U&&j<D;){let Z=R(g[j],y[z]);Z<0?x(g[j++]):Z>0?k(y[z++]):(z++,j++)}for(;z<U;)k(y[z++]);for(;j<D;)x(g[j++])})(h,s,mp,f=>{u.push(a.addFieldIndex(c,f))},f=>{u.push(a.deleteFieldIndex(c,f))})).next(()=>b.waitFor(u)))})})(yield Vr(r),t)}))}function d_(r,t){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return(function(n,s){M(n).Fs.Vs=s})(yield Vr(r),t)}))}function f_(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return(function(e){let n=M(e),s=n.indexManager;return n.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))})(yield Vr(r))}))}function cg(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}function m_(r,t,e,n={}){r=Q(r,Sn);let s=hi(t),i=r._getSettings(),a=ya(Gt({},i),{emulatorOptions:r._getEmulatorOptions()}),u=`${t}:${e}`;s&&(wa(`https://${u}`),kh("Firestore",!0)),i.host!==lg&&i.host!==u&&zt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let c=ya(Gt({},i),{host:u,ssl:s,emulatorOptions:n});if(!On(c,a)&&(r._setSettings(c),n.mockUserToken)){let h,f;if(typeof n.mockUserToken=="string")h=n.mockUserToken,f=_t.MOCK_USER;else{h=Nh(n.mockUserToken,r._app?.options.projectId);let g=n.mockUserToken.sub||n.mockUserToken.user_id;if(!g)throw new C(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new _t(g)}r._authCredentials=new qa(new Pi(h,f))}}function q_(r,t,...e){if(r=gt(r),Hc("collection","path",t),r instanceof Sn){let n=W.fromString(t,...e);return Yh(n),new ie(r,null,n)}{if(!(r instanceof it||r instanceof ie))throw new C(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(W.fromString(t,...e));return Yh(n),new ie(r.firestore,null,n)}}function U_(r,t){if(r=Q(r,Sn),Hc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new C(A.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new bt(r,null,(function(n){return new Qt(W.emptyPath(),n)})(t))}function g_(r,t,...e){if(r=gt(r),arguments.length===1&&(t=cs.newId()),Hc("doc","path",t),r instanceof Sn){let n=W.fromString(t,...e);return Xh(n),new it(r,null,new F(n))}{if(!(r instanceof it||r instanceof ie))throw new C(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(W.fromString(t,...e));return Xh(n),new it(r.firestore,r instanceof ie?r.converter:null,new F(n))}}function B_(r,t){return r=gt(r),t=gt(t),(r instanceof it||r instanceof ie)&&(t instanceof it||t instanceof ie)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function hg(r,t){return r=gt(r),t=gt(t),r instanceof bt&&t instanceof bt&&r.firestore===t.firestore&&zs(r._query,t._query)&&r.converter===t.converter}function of(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function Xn(r){return(function(e,n){if(typeof e!="object"||e===null)return!1;let s=e;for(let i of n)if(i in s&&typeof s[i]=="function")return!0;return!1})(r,["next","error","complete"])}function G_(r,t,e){e||(e=ps);let n=Ea(r,"firestore");if(n.isInitialized(e)){let s=n.getImmediate({identifier:e}),i=n.getOptions(e);if(On(i,t))return s;throw new C(A.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new C(A.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Dm)throw new C(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&hi(t.host)&&wa(t.host),n.initialize({options:t,instanceIdentifier:e})}function z_(r,t){let e=typeof r=="object"?r:Gh(),n=typeof r=="string"?r:t||ps,s=Ea(e,"firestore").getImmediate({identifier:n});if(!s._initialized){let i=Dh("firestore");i&&m_(s,...i)}return s}function ct(r){if(r._terminated)throw new C(A.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||dg(r),r._firestoreClient}function dg(r){let t=r._freezeSettings(),e=(function(s,i,a,u){return new tu(s,i,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,cg(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(r._databaseId,r._app?.options.appId||"",r._persistenceKey,t);r._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),r._firestoreClient=new bc(r._authCredentials,r._appCheckCredentials,r._queue,e,r._componentsProvider&&(function(s){let i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(r._componentsProvider))}function K_(r,t){zt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return fg(r,Pr.provider,{build:n=>new Ms(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function $_(r){return V(this,null,function*(){zt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();fg(r,Pr.provider,{build:e=>new wo(e,t.cacheSizeBytes)})})}function fg(r,t,e){if((r=Q(r,et))._firestoreClient||r._terminated)throw new C(A.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new C(A.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},dg(r)}function Q_(r){if(r._initialized&&!r._terminated)throw new C(A.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new Tt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>V(null,null,function*(){try{yield(function(n){return V(this,null,function*(){if(!Ue.v())return Promise.resolve();let s=n+Mm;yield Ue.delete(s)})})(ll(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function W_(r){return(function(e){let n=new Tt;return e.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Ky(yield Al(e),n)})),n.promise})(ct(r=Q(r,et)))}function H_(r){return r_(ct(r=Q(r,et)))}function J_(r){return s_(ct(r=Q(r,et)))}function X_(r){return Uh(r.app,"firestore",r._databaseId.database),r._delete()}function af(r,t){let e=ct(r=Q(r,et)),n=new Rc;return c_(e,r._databaseId,t,n),n}function p_(r,t){return l_(ct(r=Q(r,et)),t).then(e=>e?new bt(r,null,e.query):null)}function Y_(){return new we(Ka)}function mg(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ac:r})}}function xn(r){let t=r._freezeSettings(),e=Cn(r._databaseId);return new Cc(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Go(r,t,e,n,s,i={}){let a=r.Cc(i.merge||i.mergeFields?2:0,t,e,s);Rl("Data must be an object, but it was:",a,n);let u=yg(n,a),c,h;if(i.merge)c=new Ut(a.fieldMask),h=a.fieldTransforms;else if(i.mergeFields){let f=[];for(let g of i.mergeFields){let y=Fs(t,g,e);if(!a.contains(y))throw new C(A.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);wg(f,y)||f.push(y)}c=new Ut(f),h=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=a.fieldTransforms;return new Vc(new Vt(u),c,h)}function gg(r,t,e){return new vo({Ac:3,Dc:t.settings.Dc,methodName:r._methodName,fc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}function Sl(r,t,e,n){let s=r.Cc(1,t,e);Rl("Data must be an object, but it was:",s,n);let i=[],a=Vt.empty();Xe(n,(c,h)=>{let f=zo(t,c,e);h=gt(h);let g=s.yc(f);if(h instanceof Os)i.push(f);else{let y=Dn(h,g);y!=null&&(i.push(f),a.set(f,y))}});let u=new Ut(i);return new Eo(a,u,s.fieldTransforms)}function bl(r,t,e,n,s,i){let a=r.Cc(1,t,e),u=[Fs(t,n,e)],c=[s];if(i.length%2!=0)throw new C(A.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<i.length;y+=2)u.push(Fs(t,i[y])),c.push(i[y+1]);let h=[],f=Vt.empty();for(let y=u.length-1;y>=0;--y)if(!wg(h,u[y])){let R=u[y],k=c[y];k=gt(k);let x=a.yc(R);if(k instanceof Os)h.push(R);else{let D=Dn(k,x);D!=null&&(h.push(R),f.set(R,D))}}let g=new Ut(h);return new Eo(f,g,a.fieldTransforms)}function pg(r,t,e,n=!1){return Dn(e,r.Cc(n?4:3,t))}function Dn(r,t){if(_g(r=gt(r)))return Rl("Unsupported field value:",t,r),yg(r,t);if(r instanceof Te)return(function(n,s){if(!mg(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);let i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(n,s){let i=[],a=0;for(let u of n){let c=Dn(u,s.wc(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}})(r,t)}return(function(n,s){if((n=gt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return sm(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let i=ut.fromDate(n);return{timestampValue:dr(s.serializer,i)}}if(n instanceof ut){let i=new ut(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:dr(s.serializer,i)}}if(n instanceof Fe)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof fe)return{bytesValue:mm(s.serializer,n._byteString)};if(n instanceof it){let i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ul(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof me)return(function(a,u){return{mapValue:{fields:{[nl]:{stringValue:rl},[ar]:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw u.Sc("VectorValues must only contain numeric values.");return al(u.serializer,h)})}}}}}})(n,s);throw s.Sc(`Unsupported field value: ${Vo(n)}`)})(r,t)}function yg(r,t){let e={};return kf(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Xe(r,(n,s)=>{let i=Dn(s,t.mc(n));i!=null&&(e[n]=i)}),{mapValue:{fields:e}}}function _g(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ut||r instanceof Fe||r instanceof fe||r instanceof it||r instanceof Te||r instanceof me)}function Rl(r,t,e){if(!_g(e)||!pf(e)){let n=Vo(e);throw n==="an object"?t.Sc(r+" a custom object"):t.Sc(r+" "+n)}}function Fs(r,t,e){if((t=gt(t))instanceof we)return t._internalPath;if(typeof t=="string")return zo(r,t);throw Ao("Field path arguments must be of type string or ",r,!1,void 0,e)}function zo(r,t,e){if(t.search(__)>=0)throw Ao(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new we(...t.split("."))._internalPath}catch{throw Ao(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Ao(r,t,e,n,s){let i=n&&!n.isEmpty(),a=s!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${n}`),a&&(c+=` in document ${s}`),c+=")"),new C(A.INVALID_ARGUMENT,u+r+c)}function wg(r,t){return r.some(e=>e.isEqual(t))}function Ko(r,t){return typeof t=="string"?zo(r,t):t instanceof we?t._internalPath:t._delegate._internalPath}function Tg(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new C(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Z_(r,t,...e){let n=[];t instanceof Ls&&n.push(t),n=n.concat(e),(function(i){let a=i.filter(c=>c instanceof Ir).length,u=i.filter(c=>c instanceof qs).length;if(a>1||a>0&&u>0)throw new C(A.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(let s of n)r=s._apply(r);return r}function tw(r,t,e){let n=t,s=Ko("where",r);return qs._create(s,n,e)}function ew(...r){return r.forEach(t=>vg("or",t)),Ir._create("or",r)}function nw(...r){return r.forEach(t=>vg("and",t)),Ir._create("and",r)}function rw(r,t="asc"){let e=t,n=Ko("orderBy",r);return Oc._create(n,e)}function sw(r){return yf("limit",r),So._create("limit",r,"F")}function iw(r){return yf("limitToLast",r),So._create("limitToLast",r,"L")}function ow(...r){return bo._create("startAt",r,!0)}function aw(...r){return bo._create("startAfter",r,!1)}function uw(...r){return Ro._create("endBefore",r,!1)}function cw(...r){return Ro._create("endAt",r,!0)}function Ig(r,t,e,n){if(e[0]=gt(e[0]),e[0]instanceof Rn)return(function(i,a,u,c,h){if(!c)throw new C(A.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of Hn(i))if(g.field.isKeyField())f.push(yn(a,c.key));else{let y=c.data.field(g.field);if(No(y))throw new C(A.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(y===null){let R=g.field.canonicalString();throw new C(A.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(y)}return new ae(f,h)})(r._query,r.firestore._databaseId,t,e[0]._document,n);{let s=xn(r.firestore);return(function(a,u,c,h,f,g){let y=a.explicitOrderBy;if(f.length>y.length)throw new C(A.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let R=[];for(let k=0;k<f.length;k++){let x=f[k];if(y[k].field.isKeyField()){if(typeof x!="string")throw new C(A.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof x}`);if(!il(a)&&x.indexOf("/")!==-1)throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${x}' contains a slash.`);let D=a.path.child(W.fromString(x));if(!F.isDocumentKey(D))throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let U=new F(D);R.push(yn(u,U))}else{let D=pg(c,h,x);R.push(D)}}return new ae(R,g)})(r._query,r.firestore._databaseId,s,t,e,n)}}function uf(r,t,e){if(typeof(e=gt(e))=="string"){if(e==="")throw new C(A.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!il(t)&&e.indexOf("/")!==-1)throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(W.fromString(e));if(!F.isDocumentKey(n))throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return yn(r,new F(n))}if(e instanceof it)return yn(r,e._key);throw new C(A.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vo(e)}.`)}function cf(r,t){if(!Array.isArray(r)||r.length===0)throw new C(A.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Eg(r,t){let e=(function(s,i){for(let a of s)for(let u of a.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null})(r.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new C(A.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new C(A.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function vg(r,t){if(!(t instanceof qs||t instanceof Ir))throw new C(A.INVALID_ARGUMENT,`Function ${r}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function $o(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}function lw(r){return new bn("sum",Fs("sum",r))}function hw(r){return new bn("avg",Fs("average",r))}function w_(){return new bn("count")}function dw(r,t){return r instanceof bn&&t instanceof bn&&r.aggregateType===t.aggregateType&&r._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function fw(r,t){return hg(r.query,t.query)&&On(r.data(),t.data())}function mw(r,t,e){if(Vn(t,Bt._jsonSchema)){if(t.bundle===Ag)throw new C(A.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let n=Cn(r._databaseId),s=ug(t.bundle,n),i=s.Wu(),a=new Ns(s.getMetadata(),n);for(let f of i)a.Ga(f);let u=a.documents;if(u.length!==1)throw new C(A.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${u.length} documents.`);let c=Oo(n,u[0].document),h=new F(W.fromString(t.bundleName));return new Bt(r,new Us(r),h,c,new ne(!1,!1),e||null)}}function gw(r,t,e){if(Vn(t,jt._jsonSchema)){if(t.bundle===Ag)throw new C(A.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let n=Cn(r._databaseId),s=ug(t.bundle,n),i=s.Wu(),a=new Ns(s.getMetadata(),n);for(let y of i)a.Ga(y);if(a.queries.length!==1)throw new C(A.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${a.queries.length} queries.`);let u=Lo(a.queries[0].bundledQuery),c=a.documents,h=new xs;c.map(y=>{let R=Oo(n,y.document);h=h.add(R)});let f=An.fromInitialDocuments(u,h,K(),!1,!1),g=new bt(r,e||null,u);return new jt(r,new Us(r),g,f)}}function T_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:r})}}function pw(r,t){return r instanceof Bt&&t instanceof Bt?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof jt&&t instanceof jt&&r._firestore===t._firestore&&hg(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function yw(r){r=Q(r,it);let t=Q(r.firestore,et);return og(ct(t),r._key).then(e=>Pl(t,r,e))}function _w(r){r=Q(r,it);let t=Q(r.firestore,et),e=ct(t),n=new ue(t);return i_(e,r._key).then(s=>new Bt(t,n,r._key,s,new ne(s!==null&&s.hasLocalMutations,!0),r.converter))}function ww(r){r=Q(r,it);let t=Q(r.firestore,et);return og(ct(t),r._key,{source:"server"}).then(e=>Pl(t,r,e))}function Tw(r){r=Q(r,bt);let t=Q(r.firestore,et),e=ct(t),n=new ue(t);return Tg(r._query),ag(e,r._query).then(s=>new jt(t,n,r,s))}function Iw(r){r=Q(r,bt);let t=Q(r.firestore,et),e=ct(t),n=new ue(t);return o_(e,r._query).then(s=>new jt(t,n,r,s))}function Ew(r){r=Q(r,bt);let t=Q(r.firestore,et),e=ct(t),n=new ue(t);return ag(e,r._query,{source:"server"}).then(s=>new jt(t,n,r,s))}function vw(r,t,e){r=Q(r,it);let n=Q(r.firestore,et),s=$o(r.converter,t,e);return Qs(n,[Go(xn(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,ht.none())])}function Aw(r,t,e,...n){r=Q(r,it);let s=Q(r.firestore,et),i=xn(s),a;return a=typeof(t=gt(t))=="string"||t instanceof we?bl(i,"updateDoc",r._key,t,e,n):Sl(i,"updateDoc",r._key,t),Qs(s,[a.toMutation(r._key,ht.exists(!0))])}function Sw(r){return Qs(Q(r.firestore,et),[new $e(r._key,ht.none())])}function bw(r,t){let e=Q(r.firestore,et),n=g_(r),s=$o(r.converter,t);return Qs(e,[Go(xn(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,ht.exists(!1))]).then(()=>n)}function lf(r,...t){r=gt(r);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||Xn(t[n])||(e=t[n++]);let s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Xn(t[n])){let c=t[n];t[n]=c.next?.bind(c),t[n+1]=c.error?.bind(c),t[n+2]=c.complete?.bind(c)}let i,a,u;if(r instanceof it)a=Q(r.firestore,et),u=vr(r._key.path),i={next:c=>{t[n]&&t[n](Pl(a,r,c))},error:t[n+1],complete:t[n+2]};else{let c=Q(r,bt);a=Q(c.firestore,et),u=c._query;let h=new ue(a);i={next:f=>{t[n]&&t[n](new jt(a,h,c,f))},error:t[n+1],complete:t[n+2]},Tg(r._query)}return(function(h,f,g,y){let R=new wr(y),k=new Ds(f,R,g);return h.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return gl(yield Tr(h),k)})),()=>{R.Nu(),h.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return pl(yield Tr(h),k)}))}})(ct(a),u,s,i)}function Rw(r,t,...e){let n=gt(r),s=(function(c){let h={bundle:"",bundleName:"",bundleSource:""},f=["bundle","bundleName","bundleSource"];for(let g of f){if(!(g in c)){h.error=`snapshotJson missing required field: ${g}`;break}let y=c[g];if(typeof y!="string"){h.error=`snapshotJson field '${g}' must be a string.`;break}if(y.length===0){h.error=`snapshotJson field '${g}' cannot be an empty string.`;break}g==="bundle"?h.bundle=y:g==="bundleName"?h.bundleName=y:g==="bundleSource"&&(h.bundleSource=y)}return h})(t);if(s.error)throw new C(A.INVALID_ARGUMENT,s.error);let i,a=0;if(typeof e[a]!="object"||Xn(e[a])||(i=e[a++]),s.bundleSource==="QuerySnapshot"){let u=null;if(typeof e[a]=="object"&&Xn(e[a])){let c=e[a++];u={next:c.next,error:c.error,complete:c.complete}}else u={next:e[a++],error:e[a++],complete:e[a++]};return(function(h,f,g,y,R){let k,x=!1;return af(h,f.bundle).then(()=>p_(h,f.bundleName)).then(U=>{U&&!x&&(R&&U.withConverter(R),k=lf(U,g||{},y))}).catch(U=>(y.error&&y.error(U),()=>{})),()=>{x||(x=!0,k&&k())}})(n,s,i,u,e[a])}if(s.bundleSource==="DocumentSnapshot"){let u=null;if(typeof e[a]=="object"&&Xn(e[a])){let c=e[a++];u={next:c.next,error:c.error,complete:c.complete}}else u={next:e[a++],error:e[a++],complete:e[a++]};return(function(h,f,g,y,R){let k,x=!1;return af(h,f.bundle).then(()=>{if(!x){let U=new it(h,R||null,F.fromPath(f.bundleName));k=lf(U,g||{},y)}}).catch(U=>(y.error&&y.error(U),()=>{})),()=>{x||(x=!0,k&&k())}})(n,s,i,u,e[a])}throw new C(A.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function Pw(r,t){return u_(ct(r=Q(r,et)),Xn(t)?t:{next:t})}function Qs(r,t){return(function(n,s){let i=new Tt;return n.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return By(yield Al(n),s,i)})),i.promise})(ct(r),t)}function Pl(r,t,e){let n=e.docs.get(t._key),s=new ue(r);return new Bt(r,s,t._key,n,new ne(e.hasPendingWrites,e.fromCache),t.converter)}function Vw(r){return I_(r,{count:w_()})}function I_(r,t){let e=Q(r.firestore,et),n=ct(e),s=Nf(t,(i,a)=>new ji(a,i.aggregateType,i._internalFieldPath));return a_(n,r._query,s).then(i=>(function(u,c,h){let f=new ue(u);return new Pc(c,f,h)})(e,r,i))}function Cw(){return new qc}function xw(r){return new Uc(r?.cacheSizeBytes)}function Dw(r){return new Fc(r)}function Nw(r){return new Lc(r)}function E_(r){return new Bc(r?.forceOwnership)}function kw(){return new jc}function Me(r,t){if((r=gt(r)).firestore!==t)throw new C(A.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function Mw(r,t,e){r=Q(r,et);let n=Gt(Gt({},v_),e);return(function(i){if(i.maxAttempts<1)throw new C(A.INVALID_ARGUMENT,"Max attempts must be at least 1")})(n),(function(i,a,u){let c=new Tt;return i.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){let h=yield ig(i);new Sc(i.asyncQueue,h,u,a,c).ju()})),c.promise})(ct(r),s=>t(new Kc(r,s)),n)}function Ow(){return new Os("deleteField")}function Fw(){return new xc("serverTimestamp")}function Lw(...r){return new Dc("arrayUnion",r)}function qw(...r){return new Nc("arrayRemove",r)}function Uw(r){return new kc("increment",r)}function Bw(r){return new me(r)}function jw(r){return ct(r=Q(r,et)),new Gc(r,t=>Qs(r,t))}function Gw(r,t){let e=ct(r=Q(r,et));if(!e._uninitializedComponentsProvider||e._uninitializedComponentsProvider._offline.kind==="memory")return zt("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=(function(i){let a=typeof i=="string"?(function(h){try{return JSON.parse(h)}catch(f){throw new C(A.INVALID_ARGUMENT,"Failed to parse JSON: "+f?.message)}})(i):i,u=[];if(Array.isArray(a.indexes))for(let c of a.indexes){let h=hf(c,"collectionGroup"),f=[];if(Array.isArray(c.fields))for(let g of c.fields){let y=zo("setIndexConfiguration",hf(g,"fieldPath"));g.arrayConfig==="CONTAINS"?f.push(new de(y,2)):g.order==="ASCENDING"?f.push(new de(y,0)):g.order==="DESCENDING"&&f.push(new de(y,1))}u.push(new qe(qe.UNKNOWN_ID,h,f,er.empty()))}return u})(t);return h_(e,n)}function hf(r,t){if(typeof r[t]!="string")throw new C(A.INVALID_ARGUMENT,"Missing string value for: "+t);return r[t]}function zw(r){r=Q(r,et);let t=df.get(r);if(t)return t;if(ct(r)._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let n=new $c(r);return df.set(r,n),n}function Kw(r){Sg(r,!0)}function $w(r){Sg(r,!1)}function Qw(r){f_(ct(r._firestore)).then(t=>N("deleting all persistent cache indexes succeeded")).catch(t=>zt("deleting all persistent cache indexes failed",t))}function Sg(r,t){d_(ct(r._firestore),t).then(e=>N(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>zt(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}function Ww(r){let t=ct(Q(r.firestore,et)),e=t._onlineComponents?.datastore.serializer;return e===void 0?null:Fo(e,xt(r._query)).ft}function Hw(r,t){let e=Nf(t,(i,a)=>new ji(a,i.aggregateType,i._internalFieldPath)),n=ct(Q(r.firestore,et)),s=n._onlineComponents?.datastore.serializer;return s===void 0?null:Tm(s,Hf(r._query),e,!0).request}var Wh,Hh,_t,Er,Le,A,C,Tt,Pi,La,qa,Ua,Ba,ja,us,Ga,Jh,cs,lp,hp,Ka,Vi,W,dp,It,F,Zh,td,ut,B,tr,qe,de,er,Kt,Tf,Ci,b,Lt,xi,Ue,Qa,gn,Wa,ed,ts,Ha,Ja,qt,Oe,Di,un,js,Ln,hs,yp,$t,rd,fn,sd,_p,nr,Ni,wp,Ii,Tp,Af,Ip,ds,Xa,rr,Sf,Ep,sr,vp,Yc,Ap,ki,pn,fs,Sp,ir,bp,Co,Rp,xo,Pp,Zc,Vp,Ya,Cp,es,xp,bf,Dp,ns,Np,Rf,kp,Do,Mp,Za,Op,Pf,Fp,tl,Lp,Vf,qp,Cf,xf,el,Up,Df,Bp,ms,ot,Wn,re,nt,Mi,Ut,Oi,mt,jp,Mf,Of,Ff,Lf,tu,ps,or,nl,qf,ke,rl,ar,Ei,Bf,Vt,Et,ae,_n,Fi,H,tt,iu,ou,au,uu,Li,cu,lu,hu,Qt,Wt,Qp,tm,Wp,Hp,Jp,lr,Ge,ye,_e,ze,Tn,mu,ht,hr,Ke,Ht,$e,ws,Ts,gu,Is,ji,pu,pt,X,yu,ny,_u,mn,Es,vs,Jn,Gi,zi,Ki,wu,ry,sy,iy,Tu,fr,$i,Su,Wi,bu,he,Un,Ru,Pu,Vu,hn,dn,Hi,Nu,bs,kd,gi,ku,Fd,Pm,Mt,Yi,mr,Mu,qd,Dm,Ou,Zi,Fu,Lu,to,qu,Uu,Bu,eo,ju,Gu,zu,Rs,yt,Ku,$u,Qu,Wu,Ps,Hu,no,ro,Ju,xe,Da,Na,ka,Mm,Xu,Yu,Zu,so,hl,_y,tc,Gm,zm,Km,Zt,oo,os,ao,ec,Vs,as,uo,nc,Qd,co,_i,Oa,Ay,sc,ic,Pt,oc,Cs,Wd,lo,ac,uc,cc,lc,hc,vn,dc,mc,xs,fo,An,gc,pc,yc,Xd,Ds,mo,go,Ns,po,yo,_o,Ze,_c,wc,Tc,Bo,ks,Ms,wo,Pr,wr,Ec,vc,Ac,Sc,We,bc,nf,lg,rf,To,Sn,bt,it,ie,sf,Io,Rc,j_,et,bn,Pc,fe,we,Te,Fe,me,y_,Vc,Eo,vo,Cc,Os,xc,Dc,Nc,kc,__,Rn,Mc,Ls,Pn,qs,Ir,Oc,So,bo,Ro,Po,Us,Ag,ne,Bt,Yn,jt,ue,Fc,Lc,qc,Uc,Bc,jc,v_,Gc,zc,Kc,$c,df,ff,Qc,wi,bg=li(()=>{"use strict";ap();ip();op();sp();$h();Qh();Wh="@firebase/firestore",Hh="4.9.2";_t=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};_t.UNAUTHENTICATED=new _t(null),_t.GOOGLE_CREDENTIALS=new _t("google-credentials-uid"),_t.FIRST_PARTY=new _t("first-party-uid"),_t.MOCK_USER=new _t("mock-user");Er="12.3.0";Le=new Lh("@firebase/firestore");A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},C=class extends Oh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};Tt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};Pi=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},La=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(_t.UNAUTHENTICATED))}shutdown(){}},qa=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ua=class{constructor(t){this.t=t,this.currentUser=_t.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){q(this.o===void 0,42304);let n=this.i,s=c=>this.i!==n?(n=this.i,e(c)):Promise.resolve(),i=new Tt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Tt,t.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let c=i;t.enqueueRetryable(()=>V(this,null,function*(){yield c.promise,yield s(this.currentUser)}))},u=c=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Tt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string",31837,{l:n}),new Pi(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string",2055,{h:t}),new _t(t)}},Ba=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=_t.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},ja=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Ba(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(_t.FIRST_PARTY))}shutdown(){}invalidateToken(){}},us=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ga=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Bh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){q(this.o===void 0,3512);let n=i=>{i.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let a=i.token!==this.m;return this.m=i.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>n(i))};let s=i=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.V.getImmediate({optional:!0});i?s(i):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new us(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new us(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}},Jh=class{getToken(){return Promise.resolve(new us(""))}invalidateToken(){}start(t,e){}shutdown(){}};cs=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let s=cp(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}};lp=55296,hp=57343;Ka="__name__",Vi=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&L(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let s=0;s<n;s++){let i=r.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return G(t.length,e.length)}static compareSegments(t,e){let n=r.isNumericId(t),s=r.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?r.extractNumericId(t).compare(r.extractNumericId(e)):za(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ce.fromString(t.substring(4,t.length-2))}},W=class r extends Vi{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new C(A.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(s=>s.length>0))}return new r(e)}static emptyPath(){return new r([])}},dp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,It=class r extends Vi{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return dp.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ka}static keyField(){return new r([Ka])}static fromServerFormat(t){let e=[],n="",s=0,i=()=>{if(n.length===0)throw new C(A.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;s<t.length;){let u=t[s];if(u==="\\"){if(s+1===t.length)throw new C(A.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new C(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=c,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(n+=u,s++):(i(),s++)}if(i(),a)throw new C(A.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};F=class r{constructor(t){this.path=t}static fromPath(t){return new r(W.fromString(t))}static fromName(t){return new r(W.fromString(t).popFirst(5))}static empty(){return new r(W.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&W.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return W.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new W(t.slice()))}};Zh=-62135596800,td=1e6,ut=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*td);return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Zh)throw new C(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/td}_compareTo(t){return this.seconds===t.seconds?G(this.nanoseconds,t.nanoseconds):G(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Vn(t,r._jsonSchema))return new r(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-Zh;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ut._jsonSchemaVersion="firestore/timestamp/1.0",ut._jsonSchema={type:wt("string",ut._jsonSchemaVersion),seconds:wt("number"),nanoseconds:wt("number")};B=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new ut(0,0))}static max(){return new r(new ut(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};tr=-1,qe=class{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}};qe.UNKNOWN_ID=-1;de=class{constructor(t,e){this.fieldPath=t,this.kind=e}};er=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Kt.min())}};Kt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(B.min(),F.empty(),tr)}static max(){return new r(B.max(),F.empty(),tr)}};Tf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ci=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};b=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let s=0,i=0,a=!1;t.forEach(u=>{++s,u.next(()=>{++i,a&&i===s&&e()},c=>n(c))}),a=!0,i===s&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(s=>s?r.resolve(s):n());return e}static forEach(t,e){let n=[];return t.forEach((s,i)=>{n.push(e.call(this,s,i))}),this.waitFor(n)}static mapArray(t,e){return new r((n,s)=>{let i=t.length,a=new Array(i),u=0;for(let c=0;c<i;c++){let h=c;e(t[h]).next(f=>{a[h]=f,++u,u===i&&n(a)},f=>s(f))}})}static doWhile(t,e){return new r((n,s)=>{let i=()=>{t()===!0?e().next(()=>{i()},s):n()};i()})}};Lt="SimpleDb",xi=class r{static open(t,e,n,s){try{return new r(e,t.transaction(s,n))}catch(i){throw new gn(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new Tt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new gn(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{let s=Xc(n.target.error);this.S.reject(new gn(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(N(Lt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Wa(e)}},Ue=class r{static delete(t){return N(Lt,"Removing database:",t),cn(xh().indexedDB.deleteDatabase(t)).toPromise()}static v(){if(!Mh())return!1;if(r.F())return!0;let t=$r(),e=r.M(t),n=0<e&&e<10,s=If(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(t,e){return t.store(e)}static M(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.N=n,this.B=null,r.M($r())===12.2&&dt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}L(t){return V(this,null,function*(){return this.db||(N(Lt,"Opening database:",this.name),this.db=yield new Promise((e,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{let a=i.target.result;e(a)},s.onblocked=()=>{n(new gn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{let a=i.target.error;a.name==="VersionError"?n(new C(A.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new C(A.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new gn(t,a))},s.onupgradeneeded=i=>{N(Lt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);let a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next(()=>{N(Lt,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db})}$(t){this.q=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,s){return V(this,null,function*(){let i=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.L(t);let u=xi.open(this.db,t,i?"readonly":"readwrite",n),c=s(u).next(h=>(u.C(),h)).catch(h=>(u.abort(h),b.reject(h))).toPromise();return c.catch(()=>{}),yield u.D,c}catch(u){let c=u,h=c.name!=="FirebaseError"&&a<3;if(N(Lt,"Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};Qa=class{constructor(t){this.U=t,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(t){this.U=t}done(){this.K=!0}j(t){this.W=t}delete(){return cn(this.U.delete())}},gn=class extends C{constructor(t,e){super(A.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};Wa=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(N(Lt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(N(Lt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),cn(n)}add(t){return N(Lt,"ADD",this.store.name,t,t),cn(this.store.add(t))}get(t){return cn(this.store.get(t)).next(e=>(e===void 0&&(e=null),N(Lt,"GET",this.store.name,t,e),e))}delete(t){return N(Lt,"DELETE",this.store.name,t),cn(this.store.delete(t))}count(){return N(Lt,"COUNT",this.store.name),cn(this.store.count())}J(t,e){let n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let i=s.getAll(n.range);return new b((a,u)=>{i.onerror=c=>{u(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{let i=this.cursor(n),a=[];return this.H(i,(u,c)=>{a.push(c)}).next(()=>a)}}Y(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new b((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}})}Z(t,e){N(Lt,"DELETE ALL",this.store.name);let n=this.options(t,e);n.X=!1;let s=this.cursor(n);return this.H(s,(i,a,u)=>u.delete())}ee(t,e){let n;e?n=t:(n={},e=t);let s=this.cursor(n);return this.H(s,e)}te(t){let e=this.cursor({});return new b((n,s)=>{e.onerror=i=>{let a=Xc(i.target.error);s(a)},e.onsuccess=i=>{let a=i.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}H(t,e){let n=[];return new b((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void s();let c=new Qa(u),h=e(u.primaryKey,u.value,c);if(h instanceof b){let f=h.catch(g=>(c.done(),b.reject(g)));n.push(f)}c.isDone?s():c.G===null?u.continue():u.continue(c.G)}}).next(()=>b.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.X?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};ed=!1;ts="IndexBackfiller",Ha=class{constructor(t,e){this.asyncQueue=t,this.ne=e,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(t){N(ts,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>V(this,null,function*(){this.task=null;try{let e=yield this.ne.ie();N(ts,`Documents written: ${e}`)}catch(e){Je(e)?N(ts,"Ignoring IndexedDB error during index backfill: ",e):yield He(e)}yield this.re(6e4)}))}},Ja=class{constructor(t,e){this.localStore=t,this.persistence=e}ie(t=50){return V(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.se(e,t))})}se(t,e){let n=new Set,s=e,i=!0;return b.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return N(ts,`Processing collection: ${a}`),this.oe(t,a,s).next(u=>{s-=u,n.add(a)});i=!1})).next(()=>e-s)}oe(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next(i=>{let a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this._e(s,i)).next(u=>(N(ts,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}_e(t,e){let n=t;return e.changes.forEach((s,i)=>{let a=wf(i);Jc(a,n)>0&&(n=a)}),new Kt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};qt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>n.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}r.ce=-1;return r})(),Oe=-1;Di="";un="remoteDocuments",js="owner",Ln="owner",hs="mutationQueues",yp="userId",$t="mutations",rd="batchId",fn="userMutationsIndex",sd=["userId","batchId"];_p={},nr="documentMutations",Ni="remoteDocumentsV14",wp=["prefixPath","collectionGroup","readTime","documentId"],Ii="documentKeyIndex",Tp=["prefixPath","collectionGroup","documentId"],Af="collectionGroupIndex",Ip=["collectionGroup","readTime","prefixPath","documentId"],ds="remoteDocumentGlobal",Xa="remoteDocumentGlobalKey",rr="targets",Sf="queryTargetsIndex",Ep=["canonicalId","targetId"],sr="targetDocuments",vp=["targetId","path"],Yc="documentTargetsIndex",Ap=["path","targetId"],ki="targetGlobalKey",pn="targetGlobal",fs="collectionParents",Sp=["collectionId","parent"],ir="clientMetadata",bp="clientId",Co="bundles",Rp="bundleId",xo="namedQueries",Pp="name",Zc="indexConfiguration",Vp="indexId",Ya="collectionGroupIndex",Cp="collectionGroup",es="indexState",xp=["indexId","uid"],bf="sequenceNumberIndex",Dp=["uid","sequenceNumber"],ns="indexEntries",Np=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Rf="documentKeyIndex",kp=["indexId","uid","orderedDocumentKey"],Do="documentOverlays",Mp=["userId","collectionPath","documentId"],Za="collectionPathOverlayIndex",Op=["userId","collectionPath","largestBatchId"],Pf="collectionGroupOverlayIndex",Fp=["userId","collectionGroup","largestBatchId"],tl="globals",Lp="name",Vf=[hs,$t,nr,un,rr,js,pn,sr,ir,ds,fs,Co,xo],qp=[...Vf,Do],Cf=[hs,$t,nr,Ni,rr,js,pn,sr,ir,ds,fs,Co,xo,Do],xf=Cf,el=[...xf,Zc,es,ns],Up=el,Df=[...el,tl],Bp=Df;ms=class extends Ci{constructor(t,e){super(),this.le=t,this.currentSequenceNumber=e}};ot=class r{constructor(t,e){this.comparator=t,this.root=e||re.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,re.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,re.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Wn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Wn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Wn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Wn(this.root,t,this.comparator,!0)}},Wn=class{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},re=class r{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??r.RED,this.left=s??r.EMPTY,this.right=i??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new r(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this,i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return r.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw L(27949);return t+(this.isRed()?0:1)}};re.EMPTY=null,re.RED=!0,re.BLACK=!1;re.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new re(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};nt=class r{constructor(t){this.comparator=t,this.data=new ot(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Mi(this.data.getIterator())}getIteratorFrom(t){return new Mi(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Mi=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};Ut=class r{constructor(t){this.fields=t,t.sort(It.comparator)}static empty(){return new r([])}unionWith(t){let e=new nt(It.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Zn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};Oi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};mt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Oi("Invalid base64 string: "+i):i}})(t);return new r(e)}static fromUint8Array(t){let e=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return G(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};mt.EMPTY_BYTE_STRING=new mt("");jp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);Mf="server_timestamp",Of="__type__",Ff="__previous_value__",Lf="__local_write_time__";tu=class{constructor(t,e,n,s,i,a,u,c,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f}},ps="(default)",or=class r{constructor(t,e){this.projectId=t,this.database=e||ps}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===ps}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};nl="__type__",qf="__max__",ke={mapValue:{fields:{__type__:{stringValue:qf}}}},rl="__vector__",ar="value",Ei={nullValue:"NULL_VALUE"};Bf={mapValue:{fields:{[nl]:{stringValue:rl},[ar]:{arrayValue:{}}}}};Vt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ai(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=rs(e)}setAll(t){let e=It.emptyPath(),n={},s=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let c=this.getFieldsMap(e);this.applyChanges(c,n,s),n={},s=[],e=u.popLast()}a?n[u.lastSegment()]=rs(a):s.push(u.lastSegment())});let i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){let e=this.field(t.popLast());Ai(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return oe(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Ai(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Xe(e,(s,i)=>t[s]=i);for(let s of n)delete t[s]}clone(){return new r(rs(this.value))}};Et=class r{constructor(t,e,n,s,i,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,B.min(),B.min(),B.min(),Vt.empty(),0)}static newFoundDocument(t,e,n,s){return new r(t,1,e,B.min(),n,s,0)}static newNoDocument(t,e){return new r(t,2,e,B.min(),B.min(),Vt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,B.min(),B.min(),Vt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Vt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};ae=class{constructor(t,e){this.position=t,this.inclusive=e}};_n=class{constructor(t,e="asc"){this.field=t,this.dir=e}};Fi=class{},H=class r extends Fi{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new iu(t,e,n):e==="array-contains"?new uu(t,n):e==="in"?new Li(t,n):e==="not-in"?new cu(t,n):e==="array-contains-any"?new lu(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new ou(t,n):new au(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(je(e,this.value)):e!==null&&Be(this.value)===Be(e)&&this.matchesComparison(je(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},tt=class r extends Fi{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new r(t,e)}matches(t){return cr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};iu=class extends H{constructor(t,e,n){super(t,e,n),this.key=F.fromName(n.referenceValue)}matches(t){let e=F.comparator(t.key,this.key);return this.matchesComparison(e)}},ou=class extends H{constructor(t,e){super(t,"in",e),this.keys=Qf("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},au=class extends H{constructor(t,e){super(t,"not-in",e),this.keys=Qf("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};uu=class extends H{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return _s(e)&&ys(e.arrayValue,this.value)}},Li=class extends H{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&ys(this.value.arrayValue,e)}},cu=class extends H{constructor(t,e){super(t,"not-in",e)}matches(t){if(ys(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!ys(this.value.arrayValue,e)}},lu=class extends H{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!_s(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>ys(this.value.arrayValue,n))}};hu=class{constructor(t,e=null,n=[],s=[],i=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=u,this.Te=null}};Qt=class{constructor(t,e=null,n=[],s=[],i=null,a="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=u,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};Wt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Xe(this.inner,(e,n)=>{for(let[s,i]of n)t(s,i)})}isEmpty(){return kf(this.inner)}size(){return this.innerSize}};Qp=new ot(F.comparator);tm=new ot(F.comparator);Wp=new ot(F.comparator),Hp=new nt(F.comparator);Jp=new nt(G);lr=class{constructor(){this._=void 0}};Ge=class extends lr{},ye=class extends lr{constructor(t){super(),this.elements=t}};_e=class extends lr{constructor(t){super(),this.elements=t}};ze=class extends lr{constructor(t,e){super(),this.serializer=t,this.Ae=e}};Tn=class{constructor(t,e){this.field=t,this.transform=e}};mu=class{constructor(t,e){this.version=t,this.transformResults=e}},ht=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};hr=class{};Ke=class extends hr{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Ht=class extends hr{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};$e=class extends hr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ws=class extends hr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};Ts=class{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&ty(i,t,n[s])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=is(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=is(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=nm();return this.mutations.forEach(s=>{let i=t.get(s.key),a=i.overlayedDocument,u=this.applyToLocalView(a,i.mutatedFields);u=e.has(s.key)?null:u;let c=cm(a,u);c!==null&&n.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(B.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&Zn(this.mutations,t.mutations,(e,n)=>_d(e,n))&&Zn(this.baseMutations,t.baseMutations,(e,n)=>_d(e,n))}},gu=class r{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){q(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=(function(){return Wp})(),i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new r(t,e,n,s)}};Is=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};ji=class{constructor(t,e,n){this.alias=t,this.aggregateType=e,this.fieldPath=n}};pu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};(X=pt||(pt={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";yu=null;ny=new ce([4294967295,4294967295],0);_u=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new mn(`Invalid padding: ${e}`);if(n<0)throw new mn(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new mn(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new mn(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=ce.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(ce.fromNumber(n)));return s.compare(ny)===1&&(s=new ce([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;let e=Id(t),[n,s]=Ed(e);for(let i=0;i<this.hashCount;i++){let a=this.ye(n,s,i);if(!this.we(a))return!1}return!0}static create(t,e,n){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new r(i,s,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.ge===0)return;let e=Id(t),[n,s]=Ed(e);for(let i=0;i<this.hashCount;i++){let a=this.ye(n,s,i);this.Se(a)}}Se(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},mn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};Es=class r{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let s=new Map;return s.set(t,vs.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(B.min(),s,new ot(G),Ot(),K())}},vs=class r{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};Jn=class{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}},Gi=class{constructor(t,e){this.targetId=t,this.Ce=e}},zi=class{constructor(t,e,n=mt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}},Ki=class{constructor(){this.ve=0,this.Fe=vd(),this.Me=mt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=K(),e=K(),n=K();return this.Fe.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:L(38017,{changeType:i})}}),new vs(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=vd()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,q(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},wu=class{constructor(t){this.Ge=t,this.ze=new Map,this.je=Ot(),this.Je=mi(),this.He=mi(),this.Ye=new ot(G)}Ze(t){for(let e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(let e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{let n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:L(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((n,s)=>{this.rt(s)&&e(s)})}st(t){let e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){let i=s.target;if(qi(i))if(n===0){let a=new F(i.path);this.et(e,a,Et.newNoDocument(a,B.min()))}else q(n===1,20013,{expectedCount:n});else{let a=this._t(e);if(a!==n){let u=this.ut(t),c=u?this.ct(u,t,a):1;if(c!==0){this.it(e);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,h)}yu?.lt((function(f,g,y,R,k){let x={localCacheCount:f,existenceFilterCount:g.count,databaseId:y.database,projectId:y.projectId},D=g.unchangedNames;return D&&(x.bloomFilter={applied:k===0,hashCount:D?.hashCount??0,bitmapLength:D?.bits?.bitmap?.length??0,padding:D?.bits?.padding??0,mightContain:U=>R?.mightContain(U)??!1}),x})(a,t.Ce,this.Ge.ht(),u,c))}}}}ut(t){let e=t.Ce.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e,a,u;try{a=pe(n).toUint8Array()}catch(c){if(c instanceof Oi)return zt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new _u(a,s,i)}catch(c){return zt(c instanceof mn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.ge===0?null:u}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){let n=this.Ge.getRemoteKeysForTarget(e),s=0;return n.forEach(i=>{let a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(u)||(this.et(e,i,null),s++)}),s}Tt(t){let e=new Map;this.ze.forEach((i,a)=>{let u=this.ot(a);if(u){if(i.current&&qi(u.target)){let c=new F(u.target.path);this.It(c).has(a)||this.Et(a,c)||this.et(a,c,Et.newNoDocument(c,t))}i.Be&&(e.set(a,i.ke()),i.qe())}});let n=K();this.He.forEach((i,a)=>{let u=!0;a.forEachWhile(c=>{let h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(i))}),this.je.forEach((i,a)=>a.setReadTime(t));let s=new Es(t,e,this.Ye,this.je,n);return this.je=Ot(),this.Je=mi(),this.He=mi(),this.Ye=new ot(G),s}Xe(t,e){if(!this.rt(t))return;let n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;let s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){let e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Ki,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new nt(G),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new nt(G),this.Je=this.Je.insert(t,e)),e}rt(t){let e=this.ot(t)!==null;return e||N("WatchChangeAggregator","Detected inactive target",t),e}ot(t){let e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Ki),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}};ry={asc:"ASCENDING",desc:"DESCENDING"},sy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iy={and:"AND",or:"OR"},Tu=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};fr=class r{constructor(t,e,n,s,i=B.min(),a=B.min(),u=mt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};$i=class{constructor(t){this.yt=t}};Su=class{getBundleMetadata(t,e){return Pd(t).get(e).next(n=>{if(n)return(function(i){return{id:i.bundleId,createTime:En(i.createTime),version:i.version}})(n)})}saveBundleMetadata(t,e){return Pd(t).put((function(s){return{bundleId:s.id,createTime:In(ft(s.createTime)),version:s.version}})(e))}getNamedQuery(t,e){return Vd(t).get(e).next(n=>{if(n)return(function(i){return{name:i.name,query:Lo(i.bundledQuery),readTime:En(i.readTime)}})(n)})}saveNamedQuery(t,e){return Vd(t).put((function(s){return{name:s.name,readTime:In(ft(s.readTime)),bundledQuery:s.bundledQuery}})(e))}};Wi=class r{constructor(t,e){this.serializer=t,this.userId=e}static wt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return Wr(t).get(bd(this.userId,e)).next(n=>n?xa(this.serializer,n):null)}getOverlays(t,e){let n=ee();return b.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){let s=[];return n.forEach((i,a)=>{let u=new Is(e,a);s.push(this.St(t,u))}),b.waitFor(s)}removeOverlaysForBatchId(t,e,n){let s=new Set;e.forEach(a=>s.add(Ct(a.getCollectionPath())));let i=[];return s.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(Wr(t).Z(Za,u))}),b.waitFor(i)}getOverlaysForCollection(t,e,n){let s=ee(),i=Ct(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Wr(t).J(Za,a).next(u=>{for(let c of u){let h=xa(this.serializer,c);s.set(h.getKey(),h)}return s})}getOverlaysForCollectionGroup(t,e,n,s){let i=ee(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Wr(t).ee({index:Pf,range:u},(c,h,f)=>{let g=xa(this.serializer,h);i.size()<s||g.largestBatchId===a?(i.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>i)}St(t,e){return Wr(t).put((function(s,i,a){let[u,c,h]=bd(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ss(s.yt,a.mutation)}})(this.serializer,this.userId,e))}};bu=class{bt(t){return At(t,tl)}getSessionToken(t){return this.bt(t).get("sessionToken").next(e=>{let n=e?.value;return n?mt.fromUint8Array(n):mt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.bt(t).put({name:"sessionToken",value:e.toUint8Array()})}};he=class{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(at(t.integerValue));else if("doubleValue"in t){let n=at(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),ls(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),typeof n=="string"&&(n=ge(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(pe(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?Uf(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):Mo(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):L(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){let n=t.fields||{};this.Ft(e,55);for(let s of Object.keys(n))this.Ot(s,e),this.Ct(n[s],e)}kt(t,e){let n=t.fields||{};this.Ft(e,53);let s=ar,i=n[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(at(i)),this.Ot(s,e),this.Ct(n[s],e)}Qt(t,e){let n=t.values||[];this.Ft(e,50);for(let s of n)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),F.fromName(t).path.forEach(n=>{this.Ft(e,60),this.Ut(n,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}};he.Kt=new he;Un=255;Ru=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Gt(n.value),n=e.next();this.zt()}jt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Jt(n.value),n=e.next();this.Ht()}Yt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{let s=e.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{let s=e.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(t){let e=this.en(t),n=Cd(e);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}nn(t){let e=this.en(t),n=Cd(e);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}rn(){this.sn(Un),this.sn(255)}_n(){this.an(Un),this.an(255)}reset(){this.position=0}seed(t){this.tn(t.length),this.buffer.set(t,this.position),this.position+=t.length}un(){return this.buffer.slice(0,this.position)}en(t){let e=(function(i){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)})(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Gt(t){let e=255&t;e===0?(this.sn(0),this.sn(255)):e===Un?(this.sn(Un),this.sn(0)):this.sn(e)}Jt(t){let e=255&t;e===0?(this.an(0),this.an(255)):e===Un?(this.an(Un),this.an(0)):this.an(t)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(t){this.tn(1),this.buffer[this.position++]=t}an(t){this.tn(1),this.buffer[this.position++]=~t}tn(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},Pu=class{constructor(t){this.cn=t}Bt(t){this.cn.Wt(t)}xt(t){this.cn.Yt(t)}Mt(t){this.cn.Xt(t)}vt(){this.cn.rn()}},Vu=class{constructor(t){this.cn=t}Bt(t){this.cn.jt(t)}xt(t){this.cn.Zt(t)}Mt(t){this.cn.nn(t)}vt(){this.cn._n()}},hn=class{constructor(){this.cn=new Ru,this.ln=new Pu(this.cn),this.hn=new Vu(this.cn)}seed(t){this.cn.seed(t)}Pn(t){return t===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}};dn=class r{constructor(t,e,n,s){this.Tn=t,this.In=e,this.En=n,this.dn=s}An(){let t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new r(this.Tn,this.In,this.En,n)}Rn(t,e,n){return{indexId:this.Tn,uid:t,arrayValue:bi(this.En),directionalValue:bi(this.dn),orderedDocumentKey:bi(e),documentKey:n.path.toArray()}}Vn(t,e,n){let s=this.Rn(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}};Hi=class{constructor(t){this.mn=new nt((e,n)=>It.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.fn=t.orderBy,this.gn=[];for(let e of t.filters){let n=e;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(t){if(q(t.collectionGroup===this.collectionId,49279),this.pn)return!1;let e=$a(t);if(e!==void 0&&!this.wn(e))return!1;let n=an(t),s=new Set,i=0,a=0;for(;i<n.length&&this.wn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){let u=this.mn.getIterator().getNext();if(!s.has(u.field.canonicalString())){let c=n[i];if(!this.Sn(u,c)||!this.bn(this.fn[a++],c))return!1}++i}for(;i<n.length;++i){let u=n[i];if(a>=this.fn.length||!this.bn(this.fn[a++],u))return!1}return!0}Dn(){if(this.pn)return null;let t=new nt(It.comparator),e=[];for(let n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new de(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new de(n.field,0))}for(let n of this.fn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new de(n.field,n.dir==="asc"?0:1)));return new qe(qe.UNKNOWN_ID,this.collectionId,e,er.empty())}wn(t){for(let e of this.gn)if(this.Sn(e,t))return!0;return!1}Sn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}bn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};Nu=class{constructor(){this.Cn=new bs}addToCollectionParentIndex(t,e){return this.Cn.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(Kt.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(Kt.min())}updateCollectionGroup(t,e,n){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}},bs=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new nt(W.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new nt(W.comparator)).toArray()}};kd="IndexedDbIndexManager",gi=new Uint8Array(0),ku=class{constructor(t,e){this.databaseId=e,this.vn=new bs,this.Fn=new Wt(n=>wn(n),(n,s)=>Gs(n,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){let n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});let i={collectionId:n,parent:Ct(s)};return Md(t).put(i)}return b.resolve()}getCollectionParents(t,e){let n=[],s=IDBKeyRange.bound([e,""],[gf(e),""],!1,!0);return Md(t).J(s).next(i=>{for(let a of i){if(a.collectionId!==e)break;n.push(te(a.parent))}return n})}addFieldIndex(t,e){let n=Hr(t),s=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}})(e);delete s.indexId;let i=n.add(s);if(e.indexState){let a=jn(t);return i.next(u=>{a.put(Rd(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return i.next()}deleteFieldIndex(t,e){let n=Hr(t),s=jn(t),i=Bn(t);return n.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=Hr(t),n=Bn(t),s=jn(t);return e.Z().next(()=>n.Z()).next(()=>s.Z())}createTargetIndexes(t,e){return b.forEach(this.Mn(e),n=>this.getIndexType(t,n).next(s=>{if(s===0||s===1){let i=new Hi(n).Dn();if(i!=null)return this.addFieldIndex(t,i)}}))}getDocumentsMatchingTarget(t,e){let n=Bn(t),s=!0,i=new Map;return b.forEach(this.Mn(e),a=>this.xn(t,a).next(u=>{s&&(s=!!u),i.set(a,u)})).next(()=>{if(s){let a=K(),u=[];return b.forEach(i,(c,h)=>{N(kd,`Using index ${(function(j){return`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map(Z=>`${Z.fieldPath}:${Z.kind}`).join(",")}`})(c)} to execute ${wn(e)}`);let f=(function(j,Z){let Y=$a(Z);if(Y===void 0)return null;for(let J of Ui(j,Y.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null})(h,c),g=(function(j,Z){let Y=new Map;for(let J of an(Z))for(let T of Ui(j,J.fieldPath))switch(T.op){case"==":case"in":Y.set(J.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return Y.set(J.fieldPath.canonicalString(),T.value),Array.from(Y.values())}return null})(h,c),y=(function(j,Z){let Y=[],J=!0;for(let T of an(Z)){let p=T.kind===0?md(j,T.fieldPath,j.startAt):gd(j,T.fieldPath,j.startAt);Y.push(p.value),J&&(J=p.inclusive)}return new ae(Y,J)})(h,c),R=(function(j,Z){let Y=[],J=!0;for(let T of an(Z)){let p=T.kind===0?gd(j,T.fieldPath,j.endAt):md(j,T.fieldPath,j.endAt);Y.push(p.value),J&&(J=p.inclusive)}return new ae(Y,J)})(h,c),k=this.On(c,h,y),x=this.On(c,h,R),D=this.Nn(c,h,g),U=this.Bn(c.indexId,f,k,y.inclusive,x,R.inclusive,D);return b.forEach(U,z=>n.Y(z,e.limit).next(j=>{j.forEach(Z=>{let Y=F.fromSegments(Z.documentKey);a.has(Y)||(a=a.add(Y),u.push(Y))})}))}).next(()=>u)}return b.resolve(null)})}Mn(t){let e=this.Fn.get(t);return e||(t.filters.length===0?e=[t]:e=yy(tt.create(t.filters,"and")).map(n=>du(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Fn.set(t,e),e)}Bn(t,e,n,s,i,a,u){let c=(e!=null?e.length:1)*Math.max(n.length,i.length),h=c/(e!=null?e.length:1),f=[];for(let g=0;g<c;++g){let y=e?this.Ln(e[g/h]):gi,R=this.kn(t,y,n[g%h],s),k=this.qn(t,y,i[g%h],a),x=u.map(D=>this.kn(t,y,D,!0));f.push(...this.createRange(R,k,x))}return f}kn(t,e,n,s){let i=new dn(t,F.empty(),e,n);return s?i:i.An()}qn(t,e,n,s){let i=new dn(t,F.empty(),e,n);return s?i.An():i}xn(t,e){let n=new Hi(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(i=>{let a=null;for(let u of i)n.yn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,s=this.Mn(e);return b.forEach(s,i=>this.xn(t,i).next(a=>{a?n!==0&&a.fields.length<(function(c){let h=new nt(It.comparator),f=!1;for(let g of c.filters)for(let y of g.getFlattenedFilters())y.field.isKeyField()||(y.op==="array-contains"||y.op==="array-contains-any"?f=!0:h=h.add(y.field));for(let g of c.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)})(i)&&(n=1):n=0})).next(()=>(function(a){return a.limit!==null})(e)&&s.length>1&&n===2?1:n)}Qn(t,e){let n=new hn;for(let s of an(t)){let i=e.data.field(s.fieldPath);if(i==null)return null;let a=n.Pn(s.kind);he.Kt.Dt(i,a)}return n.un()}Ln(t){let e=new hn;return he.Kt.Dt(t,e.Pn(0)),e.un()}$n(t,e){let n=new hn;return he.Kt.Dt(yn(this.databaseId,e),n.Pn((function(i){let a=an(i);return a.length===0?0:a[a.length-1].kind})(t))),n.un()}Nn(t,e,n){if(n===null)return[];let s=[];s.push(new hn);let i=0;for(let a of an(t)){let u=n[i++];for(let c of s)if(this.Un(e,a.fieldPath)&&_s(u))s=this.Kn(s,a,u);else{let h=c.Pn(a.kind);he.Kt.Dt(u,h)}}return this.Wn(s)}On(t,e,n){return this.Nn(t,e,n.position)}Wn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].un();return e}Kn(t,e,n){let s=[...t],i=[];for(let a of n.arrayValue.values||[])for(let u of s){let c=new hn;c.seed(u.un()),he.Kt.Dt(a,c.Pn(e.kind)),i.push(c)}return i}Un(t,e){return!!t.filters.find(n=>n instanceof H&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=Hr(t),s=jn(t);return(e?n.J(Ya,IDBKeyRange.bound(e,e)):n.J()).next(i=>{let a=[];return b.forEach(i,u=>s.get([u.indexId,this.uid]).next(c=>{a.push((function(f,g){let y=g?new er(g.sequenceNumber,new Kt(En(g.readTime),new F(te(g.documentKey)),g.largestBatchId)):er.empty(),R=f.fields.map(([k,x])=>new de(It.fromServerFormat(k),x));return new qe(f.indexId,f.collectionGroup,R,y)})(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,s)=>{let i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:G(n.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let s=Hr(t),i=jn(t);return this.Gn(t).next(a=>s.J(Ya,IDBKeyRange.bound(e,e)).next(u=>b.forEach(u,c=>i.put(Rd(c.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return b.forEach(e,(s,i)=>{let a=n.get(s.collectionGroup);return(a?b.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next(u=>(n.set(s.collectionGroup,u),b.forEach(u,c=>this.zn(t,s,c).next(h=>{let f=this.jn(i,c);return h.isEqual(f)?b.resolve():this.Jn(t,i,c,h,f)}))))})}Hn(t,e,n,s){return Bn(t).put(s.Rn(this.uid,this.$n(n,e.key),e.key))}Yn(t,e,n,s){return Bn(t).delete(s.Vn(this.uid,this.$n(n,e.key),e.key))}zn(t,e,n){let s=Bn(t),i=new nt(Ve);return s.ee({index:Rf,range:IDBKeyRange.only([n.indexId,this.uid,bi(this.$n(n,e))])},(a,u)=>{i=i.add(new dn(n.indexId,e,Dd(u.arrayValue),Dd(u.directionalValue)))}).next(()=>i)}jn(t,e){let n=new nt(Ve),s=this.Qn(e,t);if(s==null)return n;let i=$a(e);if(i!=null){let a=t.data.field(i.fieldPath);if(_s(a))for(let u of a.arrayValue.values||[])n=n.add(new dn(e.indexId,t.key,this.Ln(u),s))}else n=n.add(new dn(e.indexId,t.key,gi,s));return n}Jn(t,e,n,s,i){N(kd,"Updating index entries for document '%s'",e.key);let a=[];return(function(c,h,f,g,y){let R=c.getIterator(),k=h.getIterator(),x=qn(R),D=qn(k);for(;x||D;){let U=!1,z=!1;if(x&&D){let j=f(x,D);j<0?z=!0:j>0&&(U=!0)}else x!=null?z=!0:U=!0;U?(g(D),D=qn(k)):z?(y(x),x=qn(R)):(x=qn(R),D=qn(k))}})(s,i,Ve,u=>{a.push(this.Hn(t,e,n,u))},u=>{a.push(this.Yn(t,e,n,u))}),b.waitFor(a)}Gn(t){let e=1;return jn(t).ee({index:bf,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,i)=>{i.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>Ve(a,u)).filter((a,u,c)=>!u||Ve(a,c[u-1])!==0);let s=[];s.push(t);for(let a of n){let u=Ve(a,t),c=Ve(a,e);if(u===0)s[0]=t.An();else if(u>0&&c<0)s.push(a),s.push(a.An());else if(c>0)break}s.push(e);let i=[];for(let a=0;a<s.length;a+=2){if(this.Zn(s[a],s[a+1]))return[];let u=s[a].Vn(this.uid,gi,F.empty()),c=s[a+1].Vn(this.uid,gi,F.empty());i.push(IDBKeyRange.bound(u,c))}return i}Zn(t,e){return Ve(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Od)}getMinOffset(t,e){return b.mapArray(this.Mn(e),n=>this.xn(t,n).next(s=>s||L(44426))).next(Od)}};Fd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pm=41943040,Mt=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};Mt.DEFAULT_COLLECTION_PERCENTILE=10,Mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mt.DEFAULT=new Mt(Pm,Mt.DEFAULT_COLLECTION_PERCENTILE,Mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mt.DISABLED=new Mt(-1,0,0);Yi=class r{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Xn={}}static wt(t,e,n,s){q(t.uid!=="",64387);let i=t.isAuthenticated()?t.uid:"";return new r(i,e,n,s)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ce(t).ee({index:fn,range:n},(s,i,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,s){let i=Qn(t),a=Ce(t);return a.add({}).next(u=>{q(typeof u=="number",49019);let c=new Ts(u,e,n,s),h=(function(R,k,x){let D=x.baseMutations.map(z=>Ss(R.yt,z)),U=x.mutations.map(z=>Ss(R.yt,z));return{userId:k,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:D,mutations:U}})(this.serializer,this.userId,c),f=[],g=new nt((y,R)=>G(y.canonicalString(),R.canonicalString()));for(let y of s){let R=vf(this.userId,y.key.path,u);g=g.add(y.key.path.popLast()),f.push(a.put(h)),f.push(i.put(R,_p))}return g.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(t,y))}),t.addOnCommittedListener(()=>{this.Xn[u]=c.keys()}),b.waitFor(f).next(()=>c)})}lookupMutationBatch(t,e){return Ce(t).get(e).next(n=>n?(q(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),ln(this.serializer,n)):null)}er(t,e){return this.Xn[e]?b.resolve(this.Xn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let s=n.keys();return this.Xn[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]),i=null;return Ce(t).ee({index:fn,range:s},(a,u,c)=>{u.userId===this.userId&&(q(u.batchId>=n,47524,{tr:n}),i=ln(this.serializer,u)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=Oe;return Ce(t).ee({index:fn,range:e,reverse:!0},(s,i,a)=>{n=i.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,Oe],[this.userId,Number.POSITIVE_INFINITY]);return Ce(t).J(fn,e).next(n=>n.map(s=>ln(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=Ti(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Qn(t).ee({range:s},(a,u,c)=>{let[h,f,g]=a,y=te(f);if(h===this.userId&&e.path.isEqual(y))return Ce(t).get(g).next(R=>{if(!R)throw L(61480,{nr:a,batchId:g});q(R.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:R.userId,batchId:g}),i.push(ln(this.serializer,R))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(G),s=[];return e.forEach(i=>{let a=Ti(this.userId,i.path),u=IDBKeyRange.lowerBound(a),c=Qn(t).ee({range:u},(h,f,g)=>{let[y,R,k]=h,x=te(R);y===this.userId&&i.path.isEqual(x)?n=n.add(k):g.done()});s.push(c)}),b.waitFor(s).next(()=>this.rr(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=Ti(this.userId,n),a=IDBKeyRange.lowerBound(i),u=new nt(G);return Qn(t).ee({range:a},(c,h,f)=>{let[g,y,R]=c,k=te(y);g===this.userId&&n.isPrefixOf(k)?k.length===s&&(u=u.add(R)):f.done()}).next(()=>this.rr(t,u))}rr(t,e){let n=[],s=[];return e.forEach(i=>{s.push(Ce(t).get(i).next(a=>{if(a===null)throw L(35274,{batchId:i});q(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(ln(this.serializer,a))}))}),b.waitFor(s).next(()=>n)}removeMutationBatch(t,e){return Vm(t.le,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.ir(e.batchId)}),b.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}ir(t){delete this.Xn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return b.resolve();let n=IDBKeyRange.lowerBound((function(a){return[a]})(this.userId)),s=[];return Qn(t).ee({range:n},(i,a,u)=>{if(i[0]===this.userId){let c=te(i[1]);s.push(c)}else u.done()}).next(()=>{q(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(t,e){return Cm(t,this.userId,e)}_r(t){return xm(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:Oe,lastStreamToken:""})}};mr=class r{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new r(0)}static cr(){return new r(-1)}};Mu=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.lr(t).next(e=>{let n=new mr(e.highestTargetId);return e.highestTargetId=n.next(),this.hr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.lr(t).next(e=>B.fromTimestamp(new ut(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.lr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.lr(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.hr(t,s)))}addTargetData(t,e){return this.Pr(t,e).next(()=>this.lr(t).next(n=>(n.targetCount+=1,this.Tr(e,n),this.hr(t,n))))}updateTargetData(t,e){return this.Pr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Gn(t).delete(e.targetId)).next(()=>this.lr(t)).next(n=>(q(n.targetCount>0,8065),n.targetCount-=1,this.hr(t,n)))}removeTargets(t,e,n){let s=0,i=[];return Gn(t).ee((a,u)=>{let c=Zr(u);c.sequenceNumber<=e&&n.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(t,c)))}).next(()=>b.waitFor(i)).next(()=>s)}forEachTarget(t,e){return Gn(t).ee((n,s)=>{let i=Zr(s);e(i)})}lr(t){return Ld(t).get(ki).next(e=>(q(e!==null,2888),e))}hr(t,e){return Ld(t).put(ki,e)}Pr(t,e){return Gn(t).put(Sm(this.serializer,e))}Tr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.lr(t).next(e=>e.targetCount)}getTargetData(t,e){let n=wn(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Gn(t).ee({range:s,index:Sf},(a,u,c)=>{let h=Zr(u);Gs(e,h.target)&&(i=h,c.done())}).next(()=>i)}addMatchingKeys(t,e,n){let s=[],i=Ne(t);return e.forEach(a=>{let u=Ct(a.path);s.push(i.put({targetId:n,path:u})),s.push(this.referenceDelegate.addReference(t,n,a))}),b.waitFor(s)}removeMatchingKeys(t,e,n){let s=Ne(t);return b.forEach(e,i=>{let a=Ct(i.path);return b.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])})}removeMatchingKeysForTargetId(t,e){let n=Ne(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),s=Ne(t),i=K();return s.ee({range:n,X:!0},(a,u,c)=>{let h=te(a[1]),f=new F(h);i=i.add(f)}).next(()=>i)}containsKey(t,e){let n=Ct(e.path),s=IDBKeyRange.bound([n],[gf(n)],!1,!0),i=0;return Ne(t).ee({index:Yc,X:!0,range:s},([a,u],c,h)=>{a!==0&&(i++,h.done())}).next(()=>i>0)}At(t,e){return Gn(t).get(e).next(n=>n?Zr(n):null)}};qd="LruGarbageCollector",Dm=1048576;Ou=class{constructor(t){this.Ir=t,this.buffer=new nt(Ud),this.Er=0}dr(){return++this.Er}Ar(t){let e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Ud(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},Zi=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){N(qd,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Je(e)?N(qd,"Ignoring IndexedDB error during garbage collection: ",e):yield He(e)}yield this.Vr(3e5)}))}},Fu=class{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return b.resolve(qt.ce);let n=new Ou(e);return this.mr.forEachTarget(t,s=>n.Ar(s.sequenceNumber)).next(()=>this.mr.pr(t,s=>n.Ar(s))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Fd)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fd):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,i,a,u,c,h,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(t,s))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(i=g,c=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(h=Date.now(),zn()<=Yt.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${i} targets in `+(c-u)+`ms
	Removed ${g} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:g})))}};Lu=class{constructor(t,e){this.db=t,this.garbageCollector=Nm(this,e)}gr(t){let e=this.wr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}wr(t){let e=0;return this.pr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}pr(t,e){return this.Sr(t,(n,s)=>e(s))}addReference(t,e,n){return pi(t,n)}removeReference(t,e,n){return pi(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return pi(t,e)}br(t,e){return(function(s,i){let a=!1;return xm(s).te(u=>Cm(s,u,i).next(c=>(c&&(a=!0),b.resolve(!c)))).next(()=>a)})(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],i=0;return this.Sr(t,(a,u)=>{if(u<=e){let c=this.br(t,a).next(h=>{if(!h)return i++,n.getEntry(t,a).next(()=>(n.removeEntry(a,B.min()),Ne(t).delete((function(g){return[0,Ct(g.path)]})(a))))});s.push(c)}}).next(()=>b.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return pi(t,e)}Sr(t,e){let n=Ne(t),s,i=qt.ce;return n.ee({index:Yc},([a,u],{path:c,sequenceNumber:h})=>{a===0?(i!==qt.ce&&e(new F(te(s)),i),i=h,s=c):i=qt.ce}).next(()=>{i!==qt.ce&&e(new F(te(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};to=class{constructor(){this.changes=new Wt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?b.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};qu=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return on(t).put(n)}removeEntry(t,e,n){return on(t).delete((function(i,a){let u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Qi(a),u[u.length-1]]})(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Dr(t,n)))}getEntry(t,e){let n=Et.newInvalidDocument(e);return on(t).ee({index:Ii,range:IDBKeyRange.only(Jr(e))},(s,i)=>{n=this.Cr(e,i)}).next(()=>n)}vr(t,e){let n={size:0,document:Et.newInvalidDocument(e)};return on(t).ee({index:Ii,range:IDBKeyRange.only(Jr(e))},(s,i)=>{n={document:this.Cr(e,i),size:Xi(i)}}).next(()=>n)}getEntries(t,e){let n=Ot();return this.Fr(t,e,(s,i)=>{let a=this.Cr(s,i);n=n.insert(s,a)}).next(()=>n)}Mr(t,e){let n=Ot(),s=new ot(F.comparator);return this.Fr(t,e,(i,a)=>{let u=this.Cr(i,a);n=n.insert(i,u),s=s.insert(i,Xi(a))}).next(()=>({documents:n,Or:s}))}Fr(t,e,n){if(e.isEmpty())return b.resolve();let s=new nt(Gd);e.forEach(c=>s=s.add(c));let i=IDBKeyRange.bound(Jr(s.first()),Jr(s.last())),a=s.getIterator(),u=a.getNext();return on(t).ee({index:Ii,range:i},(c,h,f)=>{let g=F.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Gd(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.j(Jr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,s,i){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),Qi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return on(t).J(IDBKeyRange.bound(u,c,!0)).next(h=>{i?.incrementDocumentReadCount(h.length);let f=Ot();for(let g of h){let y=this.Cr(F.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);y.isFoundDocument()&&(Ks(e,y)||s.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(t,e,n,s){let i=Ot(),a=jd(e,n),u=jd(e,Kt.max());return on(t).ee({index:Af,range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{let g=this.Cr(F.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);i=i.insert(g.key,g),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(t){return new Uu(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Bd(t).get(Xa).next(e=>(q(!!e,20021),e))}Dr(t,e){return Bd(t).put(Xa,e)}Cr(t,e){if(e){let n=gy(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(B.min())))return n}return Et.newInvalidDocument(t)}};Uu=class extends to{constructor(t,e){super(),this.Nr=t,this.trackRemovals=e,this.Br=new Wt(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(t){let e=[],n=0,s=new nt((i,a)=>G(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{let u=this.Br.get(i);if(e.push(this.Nr.removeEntry(t,i,u.readTime)),a.isValidDocument()){let c=Sd(this.Nr.serializer,a);s=s.add(i.path.popLast());let h=Xi(c);n+=h-u.size,e.push(this.Nr.addEntry(t,i,c))}else if(n-=u.size,this.trackRemovals){let c=Sd(this.Nr.serializer,a.convertToNoDocument(B.min()));e.push(this.Nr.addEntry(t,i,c))}}),s.forEach(i=>{e.push(this.Nr.indexManager.addToCollectionParentIndex(t,i))}),e.push(this.Nr.updateMetadata(t,n)),b.waitFor(e)}getFromCache(t,e){return this.Nr.vr(t,e).next(n=>(this.Br.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Nr.Mr(t,e).next(({documents:n,Or:s})=>(s.forEach((i,a)=>{this.Br.set(i,{size:a,readTime:n.get(i).readTime})}),n))}};Bu=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};eo=class{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(n!==null&&is(n.mutation,s,Ut.empty(),ut.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let s=ee();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(i=>{let a=Yr();return i.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=ee();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let s=[];return n.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,s){let i=Ot(),a=ss(),u=(function(){return ss()})();return e.forEach((c,h)=>{let f=n.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof Ht)?i=i.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),is(f.mutation,h,f.mutation.getFieldMask(),ut.now())):a.set(h.key,Ut.empty())}),this.recalculateAndSaveOverlays(t,i).next(c=>(c.forEach((h,f)=>a.set(h,f)),e.forEach((h,f)=>u.set(h,new Bu(f,a.get(h)??null))),u))}recalculateAndSaveOverlays(t,e){let n=ss(),s=new ot((a,u)=>a-u),i=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(c=>{let h=e.get(c);if(h===null)return;let f=n.get(c)||Ut.empty();f=u.applyToLocalView(h,f),n.set(c,f);let g=(s.get(u.batchId)||K()).add(c);s=s.insert(u.batchId,g)})}).next(()=>{let a=[],u=s.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),h=c.key,f=c.value,g=nm();f.forEach(y=>{if(!i.has(y)){let R=cm(e.get(y),n.get(y));R!==null&&g.set(y,R),i=i.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(t,h,g))}return b.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,s){return(function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):il(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(i=>{let a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):b.resolve(ee()),u=tr,c=i;return a.next(h=>b.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),i.get(f)?b.resolve():this.remoteDocumentCache.getEntry(t,f).next(y=>{c=c.insert(f,y)}))).next(()=>this.populateOverlays(t,h,i)).next(()=>this.computeViews(t,c,h,K())).next(f=>({batchId:u,changes:em(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new F(e)).next(n=>{let s=Yr();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){let i=e.collectionGroup,a=Yr();return this.indexManager.getCollectionParents(t,i).next(u=>b.forEach(u,c=>{let h=(function(g,y){return new Qt(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(e,c.child(i));return this.getDocumentsMatchingCollectionQuery(t,h,n,s).next(f=>{f.forEach((g,y)=>{a=a.insert(g,y)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s))).next(a=>{i.forEach((c,h)=>{let f=h.getKey();a.get(f)===null&&(a=a.insert(f,Et.newInvalidDocument(f)))});let u=Yr();return a.forEach((c,h)=>{let f=i.get(c);f!==void 0&&is(f.mutation,h,Ut.empty(),ut.now()),Ks(e,h)&&(u=u.insert(c,h))}),u})}};ju=class{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return b.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:ft(s.createTime)}})(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:Lo(s.bundledQuery),readTime:ft(s.readTime)}})(e)),b.resolve()}};Gu=class{constructor(){this.overlays=new ot(F.comparator),this.qr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){let n=ee();return b.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((s,i)=>{this.St(t,e,i)}),b.resolve()}removeOverlaysForBatchId(t,e,n){let s=this.qr.get(n);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(n)),b.resolve()}getOverlaysForCollection(t,e,n){let s=ee(),i=e.length+1,a=new F(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,h=c.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===i&&c.largestBatchId>n&&s.set(c.getKey(),c)}return b.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new ot((h,f)=>h-f),a=this.overlays.getIterator();for(;a.hasNext();){let h=a.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>n){let f=i.get(h.largestBatchId);f===null&&(f=ee(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let u=ee(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=s)););return b.resolve(u)}St(t,e,n){let s=this.overlays.get(n.key);if(s!==null){let a=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Is(e,n));let i=this.qr.get(e);i===void 0&&(i=K(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}};zu=class{constructor(){this.sessionToken=mt.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}};Rs=class{constructor(){this.Qr=new nt(yt.$r),this.Ur=new nt(yt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){let n=new yt(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Gr(new yt(t,e))}zr(t,e){t.forEach(n=>this.removeReference(n,e))}jr(t){let e=new F(new W([])),n=new yt(e,t),s=new yt(e,t+1),i=[];return this.Ur.forEachInRange([n,s],a=>{this.Gr(a),i.push(a.key)}),i}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){let e=new F(new W([])),n=new yt(e,t),s=new yt(e,t+1),i=K();return this.Ur.forEachInRange([n,s],a=>{i=i.add(a.key)}),i}containsKey(t){let e=new yt(t,0),n=this.Qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},yt=class{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return F.comparator(t.key,e.key)||G(t.Yr,e.Yr)}static Kr(t,e){return G(t.Yr,e.Yr)||F.comparator(t.key,e.key)}};Ku=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new nt(yt.$r)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ts(i,e,n,s);this.mutationQueue.push(a);for(let u of s)this.Zr=this.Zr.add(new yt(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return b.resolve(a)}lookupMutationBatch(t,e){return b.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=this.ei(n),i=s<0?0:s;return b.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?Oe:this.tr-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new yt(e,0),s=new yt(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,s],a=>{let u=this.Xr(a.Yr);i.push(u)}),b.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(G);return e.forEach(s=>{let i=new yt(s,0),a=new yt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],u=>{n=n.add(u.Yr)})}),b.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=n;F.isDocumentKey(i)||(i=i.child(""));let a=new yt(new F(i),0),u=new nt(G);return this.Zr.forEachWhile(c=>{let h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===s&&(u=u.add(c.Yr)),!0)},a),b.resolve(this.ti(u))}ti(t){let e=[];return t.forEach(n=>{let s=this.Xr(n);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){q(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return b.forEach(e.mutations,s=>{let i=new yt(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){let n=new yt(e,0),s=this.Zr.firstAfterOrEqual(n);return b.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){let e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};$u=class{constructor(t){this.ri=t,this.docs=(function(){return new ot(F.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return b.resolve(n?n.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let n=Ot();return e.forEach(s=>{let i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():Et.newInvalidDocument(s))}),b.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Ot(),a=e.path,u=new F(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Jc(wf(f),n)<=0||(s.has(f.key)||Ks(e,f))&&(i=i.insert(f.key,f.mutableCopy()))}return b.resolve(i)}getAllFromCollectionGroup(t,e,n,s){L(9500)}ii(t,e){return b.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Qu(this)}getSize(t){return b.resolve(this.size)}},Qu=class extends to{constructor(t){super(),this.Nr=t}applyChanges(t){let e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)}),b.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}};Wu=class{constructor(t){this.persistence=t,this.si=new Wt(e=>wn(e),Gs),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.oi=0,this._i=new Rs,this.targetCount=0,this.ai=mr.ur()}forEachTarget(t,e){return this.si.forEach((n,s)=>e(s)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),b.resolve()}Pr(t){this.si.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.ai=new mr(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.Pr(e),b.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,n){let s=0,i=[];return this.si.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)}),b.waitFor(i).next(()=>s)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){let n=this.si.get(e)||null;return b.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),b.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);let s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(a=>{i.push(s.markPotentiallyOrphaned(t,a))}),b.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),b.resolve()}getMatchingKeysForTargetId(t,e){let n=this._i.Hr(e);return b.resolve(n)}containsKey(t,e){return b.resolve(this._i.containsKey(e))}};Ps=class{constructor(t,e){this.ui={},this.overlays={},this.ci=new qt(0),this.li=!1,this.li=!0,this.hi=new zu,this.referenceDelegate=t(this),this.Pi=new Wu(this),this.indexManager=new Nu,this.remoteDocumentCache=(function(s){return new $u(s)})(n=>this.referenceDelegate.Ti(n)),this.serializer=new $i(e),this.Ii=new ju(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Gu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new Ku(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){N("MemoryPersistence","Starting transaction:",t);let s=new Hu(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(t,e){return b.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}},Hu=class extends Ci{constructor(t){super(),this.currentSequenceNumber=t}},no=class r{constructor(t){this.persistence=t,this.Ri=new Rs,this.Vi=null}static mi(t){return new r(t)}get fi(){if(this.Vi)return this.Vi;throw L(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),b.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),b.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(s=>this.fi.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,n=>{let s=F.fromPath(n);return this.gi(t,s).next(i=>{i||e.removeEntry(s,B.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(n=>{n?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return b.or([()=>b.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}},ro=class r{constructor(t,e){this.persistence=t,this.pi=new Wt(n=>Ct(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=Nm(this,e)}static mi(t,e){return new r(t,e)}Ei(){}di(t){return b.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){let e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}wr(t){let e=0;return this.pr(t,n=>{e++}).next(()=>e)}pr(t,e){return b.forEach(this.pi,(n,s)=>this.br(t,n,s).next(i=>i?b.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(t,a=>this.br(t,a,e).next(u=>{u||(n++,i.removeEntry(a,B.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),b.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),b.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=vi(t.data.value)),e}br(t,e,n){return b.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.pi.get(e);return b.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};Ju=class{constructor(t){this.serializer=t}k(t,e,n,s){let i=new xi("createOrUpgrade",e);n<1&&s>=1&&((function(c){c.createObjectStore(js)})(t),(function(c){c.createObjectStore(hs,{keyPath:yp}),c.createObjectStore($t,{keyPath:rd,autoIncrement:!0}).createIndex(fn,sd,{unique:!0}),c.createObjectStore(nr)})(t),zd(t),(function(c){c.createObjectStore(un)})(t));let a=b.resolve();return n<3&&s>=3&&(n!==0&&((function(c){c.deleteObjectStore(sr),c.deleteObjectStore(rr),c.deleteObjectStore(pn)})(t),zd(t)),a=a.next(()=>(function(c){let h=c.store(pn),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return h.put(ki,f)})(i))),n<4&&s>=4&&(n!==0&&(a=a.next(()=>(function(c,h){return h.store($t).J().next(g=>{c.deleteObjectStore($t),c.createObjectStore($t,{keyPath:rd,autoIncrement:!0}).createIndex(fn,sd,{unique:!0});let y=h.store($t),R=g.map(k=>y.put(k));return b.waitFor(R)})})(t,i))),a=a.next(()=>{(function(c){c.createObjectStore(ir,{keyPath:bp})})(t)})),n<5&&s>=5&&(a=a.next(()=>this.yi(i))),n<6&&s>=6&&(a=a.next(()=>((function(c){c.createObjectStore(ds)})(t),this.wi(i)))),n<7&&s>=7&&(a=a.next(()=>this.Si(i))),n<8&&s>=8&&(a=a.next(()=>this.bi(t,i))),n<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&s>=10&&(a=a.next(()=>this.Di(i))),n<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore(Co,{keyPath:Rp})})(t),(function(c){c.createObjectStore(xo,{keyPath:Pp})})(t)})),n<12&&s>=12&&(a=a.next(()=>{(function(c){let h=c.createObjectStore(Do,{keyPath:Mp});h.createIndex(Za,Op,{unique:!1}),h.createIndex(Pf,Fp,{unique:!1})})(t)})),n<13&&s>=13&&(a=a.next(()=>(function(c){let h=c.createObjectStore(Ni,{keyPath:wp});h.createIndex(Ii,Tp),h.createIndex(Af,Ip)})(t)).next(()=>this.Ci(t,i)).next(()=>t.deleteObjectStore(un))),n<14&&s>=14&&(a=a.next(()=>this.Fi(t,i))),n<15&&s>=15&&(a=a.next(()=>(function(c){c.createObjectStore(Zc,{keyPath:Vp,autoIncrement:!0}).createIndex(Ya,Cp,{unique:!1}),c.createObjectStore(es,{keyPath:xp}).createIndex(bf,Dp,{unique:!1}),c.createObjectStore(ns,{keyPath:Np}).createIndex(Rf,kp,{unique:!1})})(t))),n<16&&s>=16&&(a=a.next(()=>{e.objectStore(es).clear()}).next(()=>{e.objectStore(ns).clear()})),n<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore(tl,{keyPath:Lp})})(t)})),n<18&&s>=18&&Ia()&&(a=a.next(()=>{e.objectStore(es).clear()}).next(()=>{e.objectStore(ns).clear()})),a}wi(t){let e=0;return t.store(un).ee((n,s)=>{e+=Xi(s)}).next(()=>{let n={byteSize:e};return t.store(ds).put(Xa,n)})}yi(t){let e=t.store(hs),n=t.store($t);return e.J().next(s=>b.forEach(s,i=>{let a=IDBKeyRange.bound([i.userId,Oe],[i.userId,i.lastAcknowledgedBatchId]);return n.J(fn,a).next(u=>b.forEach(u,c=>{q(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let h=ln(this.serializer,c);return Vm(t,i.userId,h).next(()=>{})}))}))}Si(t){let e=t.store(sr),n=t.store(un);return t.store(pn).get(ki).next(s=>{let i=[];return n.ee((a,u)=>{let c=new W(a),h=(function(g){return[0,Ct(g)]})(c);i.push(e.get(h).next(f=>f?b.resolve():(g=>e.put({targetId:0,path:Ct(g),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>b.waitFor(i))})}bi(t,e){t.createObjectStore(fs,{keyPath:Sp});let n=e.store(fs),s=new bs,i=a=>{if(s.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Ct(c)})}};return e.store(un).ee({X:!0},(a,u)=>{let c=new W(a);return i(c.popLast())}).next(()=>e.store(nr).ee({X:!0},([a,u,c],h)=>{let f=te(u);return i(f.popLast())}))}Di(t){let e=t.store(rr);return e.ee((n,s)=>{let i=Zr(s),a=Sm(this.serializer,i);return e.put(a)})}Ci(t,e){let n=e.store(un),s=[];return n.ee((i,a)=>{let u=e.store(Ni),c=(function(g){return g.document?new F(W.fromString(g.document.name).popFirst(5)):g.noDocument?F.fromSegments(g.noDocument.path):g.unknownDocument?F.fromSegments(g.unknownDocument.path):L(36783)})(a).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(u.put(h))}).next(()=>b.waitFor(s))}Fi(t,e){let n=e.store($t),s=km(this.serializer),i=new Ps(no.mi,this.serializer.yt);return n.J().next(a=>{let u=new Map;return a.forEach(c=>{let h=u.get(c.userId)??K();ln(this.serializer,c).keys().forEach(f=>h=h.add(f)),u.set(c.userId,h)}),b.forEach(u,(c,h)=>{let f=new _t(h),g=Wi.wt(this.serializer,f),y=i.getIndexManager(f),R=Yi.wt(f,this.serializer,y,i.referenceDelegate);return new eo(s,R,g,y).recalculateAndSaveOverlaysForDocumentKeys(new ms(e,qt.ce),c).next()})})}};xe="IndexedDbPersistence",Da=18e5,Na=5e3,ka="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Mm="main",Xu=class r{constructor(t,e,n,s,i,a,u,c,h,f,g=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Mi=i,this.window=a,this.document=u,this.xi=h,this.Oi=f,this.Ni=g,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=y=>Promise.resolve(),!r.v())throw new C(A.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Lu(this,s),this.$i=e+Mm,this.serializer=new $i(c),this.Ui=new Ue(this.$i,this.Ni,new Ju(this.serializer)),this.hi=new bu,this.Pi=new Mu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=km(this.serializer),this.Ii=new Su,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&dt(xe,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(A.FAILED_PRECONDITION,ka);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Pi.getHighestSequenceNumber(t))}).then(t=>{this.ci=new qt(t,this.xi)}).then(()=>{this.li=!0}).catch(t=>(this.Ui&&this.Ui.close(),Promise.reject(t)))}Ji(t){return this.Qi=e=>V(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ui.$(e=>V(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Mi.enqueueAndForget(()=>V(this,null,function*(){this.started&&(yield this.Wi())})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>yi(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(t).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(t)).next(e=>this.isPrimary&&!e?this.Zi(t).next(()=>!1):!!e&&this.Xi(t).next(()=>!0))).catch(t=>{if(Je(t))return N(xe,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return N(xe,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Mi.enqueueRetryable(()=>this.Qi(t)),this.isPrimary=t})}Hi(t){return Xr(t).get(Ln).next(e=>b.resolve(this.es(e)))}ts(t){return yi(t).delete(this.clientId)}ns(){return V(this,null,function*(){if(this.isPrimary&&!this.rs(this.qi,Da)){this.qi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=At(e,ir);return n.J().next(s=>{let i=this.ss(s,Da),a=s.filter(u=>i.indexOf(u)===-1);return b.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ki)for(let e of t)this.Ki.removeItem(this._s(e.clientId))}})}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(t){return!!t&&t.ownerId===this.clientId}Yi(t){return this.Oi?b.resolve(!0):Xr(t).get(Ln).next(e=>{if(e!==null&&this.rs(e.leaseTimestampMs,Na)&&!this.us(e.ownerId)){if(this.es(e)&&this.networkEnabled)return!0;if(!this.es(e)){if(!e.allowTabSynchronization)throw new C(A.FAILED_PRECONDITION,ka);return!1}}return!(!this.networkEnabled||!this.inForeground)||yi(t).J().next(n=>this.ss(n,Na).find(s=>{if(this.clientId!==s.clientId){let i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,u=this.networkEnabled===s.networkEnabled;if(i||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&N(xe,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return V(this,null,function*(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),yield this.Ui.runTransaction("shutdown","readwrite",[js,ir],t=>{let e=new ms(t,qt.ce);return this.Zi(e).next(()=>this.ts(e))}),this.Ui.close(),this.Ps()})}ss(t,e){return t.filter(n=>this.rs(n.updateTimeMs,e)&&!this.us(n.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",t=>yi(t).J().next(e=>this.ss(e,Da).map(n=>n.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(t,e){return Yi.wt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new ku(t,this.serializer.yt.databaseId)}getDocumentOverlayCache(t){return Wi.wt(this.serializer,t)}getBundleCache(){return this.Ii}runTransaction(t,e,n){N(xe,"Starting transaction:",t);let s=e==="readonly"?"readonly":"readwrite",i=(function(c){return c===18?Bp:c===17?Df:c===16?Up:c===15?el:c===14?xf:c===13?Cf:c===12?qp:c===11?Vf:void L(60245)})(this.Ni),a;return this.Ui.runTransaction(t,s,i,u=>(a=new ms(u,this.ci?this.ci.next():qt.ce),e==="readwrite-primary"?this.Hi(a).next(c=>!!c||this.Yi(a)).next(c=>{if(!c)throw dt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new C(A.FAILED_PRECONDITION,Tf);return n(a)}).next(c=>this.Xi(a).next(()=>c)):this.Is(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Is(t){return Xr(t).get(Ln).next(e=>{if(e!==null&&this.rs(e.leaseTimestampMs,Na)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new C(A.FAILED_PRECONDITION,ka)})}Xi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Xr(t).put(Ln,e)}static v(){return Ue.v()}Zi(t){let e=Xr(t);return e.get(Ln).next(n=>this.es(n)?(N(xe,"Releasing primary lease."),e.delete(Ln)):b.resolve())}rs(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(dt(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();let t=/(?:Version|Mobile)\/1[456]/;Ta()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(t){try{let e=this.Ki?.getItem(this._s(t))!==null;return N(xe,`Client '${t}' ${e?"is":"is not"} zombied in LocalStorage`),e}catch(e){return dt(xe,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(t){dt("Failed to set zombie client id.",t)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};Yu=class r{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=K(),s=K();for(let i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new r(t,e.fromCache,n,s)}};Zu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};so=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Ta()?8:If($r())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){let i={result:null};return this.ys(t,e).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ws(t,e,s,n).next(a=>{i.result=a})}).next(()=>{if(i.result)return;let a=new Zu;return this.Ss(t,e,a).next(u=>{if(i.result=u,this.Vs)return this.bs(t,e,a,u.size)})}).next(()=>i.result)}bs(t,e,n,s){return n.documentReadCount<this.fs?(zn()<=Yt.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Kn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(zn()<=Yt.DEBUG&&N("QueryEngine","Query:",Kn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(zn()<=Yt.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Kn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,xt(e))):b.resolve())}ys(t,e){if(pd(e))return b.resolve(null);let n=xt(e);return this.indexManager.getIndexType(t,n).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Bi(e,null,"F"),n=xt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{let a=K(...i);return this.ps.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(c=>{let h=this.Ds(e,u);return this.Cs(e,h,a,c.readTime)?this.ys(t,Bi(e,null,"F")):this.vs(t,h,e,c)}))})))}ws(t,e,n,s){return pd(e)||s.isEqual(B.min())?b.resolve(null):this.ps.getDocuments(t,n).next(i=>{let a=this.Ds(e,i);return this.Cs(e,a,n,s)?b.resolve(null):(zn()<=Yt.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Kn(e)),this.vs(t,a,e,_f(s,tr)).next(u=>u))})}Ds(t,e){let n=new nt(Zf(t));return e.forEach((s,i)=>{Ks(t,i)&&(n=n.add(i))}),n}Cs(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(t,e,n){return zn()<=Yt.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Kn(e)),this.ps.getDocumentsMatchingQuery(t,e,Kt.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next(i=>(e.forEach(a=>{i=i.insert(a.key,a)}),i))}};hl="LocalStore",_y=3e8,tc=class{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new ot(G),this.xs=new Wt(i=>wn(i),Gs),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new eo(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}};Gm="firestore_clients";zm="firestore_mutations";Km="firestore_targets";Zt="SharedClientState",oo=class r{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ws(t,e,n){let s=JSON.parse(n),i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new C(s.error.code,s.error.message))),a?new r(t,e,s.state,i):(dt(Zt,`Failed to parse mutation state for ID '${e}': ${n}`),null)}Gs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},os=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ws(t,e){let n=JSON.parse(e),s,i=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return i&&n.error&&(i=typeof n.error.message=="string"&&typeof n.error.code=="string",i&&(s=new C(n.error.code,n.error.message))),i?new r(t,n.state,s):(dt(Zt,`Failed to parse target state for ID '${t}': ${e}`),null)}Gs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},ao=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ws(t,e){let n=JSON.parse(e),s=typeof n=="object"&&n.activeTargetIds instanceof Array,i=ol();for(let a=0;s&&a<n.activeTargetIds.length;++a)s=Ef(n.activeTargetIds[a]),i=i.add(n.activeTargetIds[a]);return s?new r(t,i):(dt(Zt,`Failed to parse client data for instance '${t}': ${e}`),null)}},ec=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Ws(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(dt(Zt,`Failed to parse online state: ${t}`),null)}},Vs=class{constructor(){this.activeTargetIds=ol()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},as=class{constructor(t,e,n,s,i){this.window=t,this.Mi=e,this.persistenceKey=n,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new ot(G),this.started=!1,this.Xs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=Kd(this.persistenceKey,this.Js),this.no=(function(c){return`firestore_sequence_number_${c}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Vs),this.ro=new RegExp(`^${Gm}_${a}_([^_]*)$`),this.io=new RegExp(`^${zm}_${a}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${Km}_${a}_(\\d+)$`),this.oo=(function(c){return`firestore_online_state_${c}`})(this.persistenceKey),this._o=(function(c){return`firestore_bundle_loaded_v2_${c}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(t){return!(!t||!t.localStorage)}start(){return V(this,null,function*(){let t=yield this.syncEngine.Ts();for(let n of t){if(n===this.Js)continue;let s=this.getItem(Kd(this.persistenceKey,n));if(s){let i=ao.Ws(n,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();let e=this.storage.getItem(this.oo);if(e){let n=this.uo(e);n&&this.co(n)}for(let n of this.Xs)this.Ys(n);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.no,JSON.stringify(t))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(t){let e=!1;return this.Zs.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.ho(t,"pending")}updateMutationState(t,e,n){this.ho(t,e,n),this.Po(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let s=this.storage.getItem(Ma(this.persistenceKey,t));if(s){let i=os.Ws(t,s);i&&(n=i.state)}}return e&&this.To.zs(t),this.ao(),n}removeLocalQueryTarget(t){this.To.js(t),this.ao()}isLocalQueryTarget(t){return this.To.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Ma(this.persistenceKey,t))}updateQueryState(t,e,n){this.Io(t,e,n)}handleUserChange(t,e,n){e.forEach(s=>{this.Po(s)}),this.currentUser=t,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(t){this.Eo(t)}notifyBundleLoaded(t){this.Ao(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return N(Zt,"READ",t,e),e}setItem(t,e){N(Zt,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){N(Zt,"REMOVE",t),this.storage.removeItem(t)}Ys(t){let e=t;if(e.storageArea===this.storage){if(N(Zt,"EVENT",e.key,e.newValue),e.key===this.eo)return void dt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(()=>V(this,null,function*(){if(this.started){if(e.key!==null){if(this.ro.test(e.key)){if(e.newValue==null){let n=this.Ro(e.key);return this.Vo(n,null)}{let n=this.mo(e.key,e.newValue);if(n)return this.Vo(n.clientId,n)}}else if(this.io.test(e.key)){if(e.newValue!==null){let n=this.fo(e.key,e.newValue);if(n)return this.po(n)}}else if(this.so.test(e.key)){if(e.newValue!==null){let n=this.yo(e.key,e.newValue);if(n)return this.wo(n)}}else if(e.key===this.oo){if(e.newValue!==null){let n=this.uo(e.newValue);if(n)return this.co(n)}}else if(e.key===this.no){let n=(function(i){let a=qt.ce;if(i!=null)try{let u=JSON.parse(i);q(typeof u=="number",30636,{So:i}),a=u}catch(u){dt(Zt,"Failed to read sequence number from WebStorage",u)}return a})(e.newValue);n!==qt.ce&&this.sequenceNumberHandler(n)}else if(e.key===this._o){let n=this.bo(e.newValue);yield Promise.all(n.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(e)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(t,e,n){let s=new oo(this.currentUser,t,e,n),i=$d(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Gs())}Po(t){let e=$d(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Eo(t){let e={clientId:this.Js,onlineState:t};this.storage.setItem(this.oo,JSON.stringify(e))}Io(t,e,n){let s=Ma(this.persistenceKey,t),i=new os(t,e,n);this.setItem(s,i.Gs())}Ao(t){let e=JSON.stringify(Array.from(t));this.setItem(this._o,e)}Ro(t){let e=this.ro.exec(t);return e?e[1]:null}mo(t,e){let n=this.Ro(t);return ao.Ws(n,e)}fo(t,e){let n=this.io.exec(t),s=Number(n[1]),i=n[2]!==void 0?n[2]:null;return oo.Ws(new _t(i),s,e)}yo(t,e){let n=this.so.exec(t),s=Number(n[1]);return os.Ws(s,e)}uo(t){return ec.Ws(t)}bo(t){return JSON.parse(t)}po(t){return V(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Co(t.batchId,t.state,t.error);N(Zt,`Ignoring mutation for non-active user ${t.user.uid}`)})}wo(t){return this.syncEngine.vo(t.targetId,t.state,t.error)}Vo(t,e){let n=e?this.Zs.insert(t,e):this.Zs.remove(t),s=this.lo(this.Zs),i=this.lo(n),a=[],u=[];return i.forEach(c=>{s.has(c)||a.push(c)}),s.forEach(c=>{i.has(c)||u.push(c)}),this.syncEngine.Fo(a,u).then(()=>{this.Zs=n})}co(t){this.Zs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}lo(t){let e=ol();return t.forEach((n,s)=>{e=e.unionWith(s.activeTargetIds)}),e}},uo=class{constructor(){this.Mo=new Vs,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Vs,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};nc=class{Oo(t){}shutdown(){}};Qd="ConnectivityMonitor",co=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){N(Qd,"Network connectivity changed: AVAILABLE");for(let t of this.qo)t(0)}ko(){N(Qd,"Network connectivity changed: UNAVAILABLE");for(let t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};_i=null;Oa="RestConnection",Ay={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},sc=class{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===ps?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,i){let a=rc(),u=this.zo(t,e.toUriEncodedString());N(Oa,`Sending RPC '${t}' ${a}:`,u,n);let c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);let{host:h}=new URL(u),f=hi(h);return this.Jo(t,u,c,n,f).then(g=>(N(Oa,`Received RPC '${t}' ${a}: `,g),g),g=>{throw zt(Oa,`RPC '${t}' ${a} failed with error: `,g,"url: ",u,"request:",n),g})}Ho(t,e,n,s,i,a){return this.Go(t,e,n,s,i)}jo(t,e,n){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Er})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,i)=>t[i]=s),n&&n.headers.forEach((s,i)=>t[i]=s)}zo(t,e){let n=Ay[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}};ic=class{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}};Pt="WebChannelConnection",oc=class extends sc{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,i){let a=rc();return new Promise((u,c)=>{let h=new Sa;h.setWithCredentials(!0),h.listenOnce(ba.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Qr.NO_ERROR:let g=h.getResponseJson();N(Pt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(g)),u(g);break;case Qr.TIMEOUT:N(Pt,`RPC '${t}' ${a} timed out`),c(new C(A.DEADLINE_EXCEEDED,"Request time out"));break;case Qr.HTTP_ERROR:let y=h.getStatus();if(N(Pt,`RPC '${t}' ${a} failed with status:`,y,"response text:",h.getResponseText()),y>0){let R=h.getResponseJson();Array.isArray(R)&&(R=R[0]);let k=R?.error;if(k&&k.status&&k.message){let x=(function(U){let z=U.toLowerCase().replace(/_/g,"-");return Object.values(A).indexOf(z)>=0?z:A.UNKNOWN})(k.status);c(new C(x,k.message))}else c(new C(A.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new C(A.UNAVAILABLE,"Connection failed."));break;default:L(9055,{l_:t,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{N(Pt,`RPC '${t}' ${a} completed.`)}});let f=JSON.stringify(s);N(Pt,`RPC '${t}' ${a} sending request:`,s),h.send(e,"POST",f,n,15)})}T_(t,e,n){let s=rc(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Va(),u=Pa(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;let f=i.join("");N(Pt,`Creating RPC '${t}' stream ${s}: ${f}`,c);let g=a.createWebChannel(f,c);this.I_(g);let y=!1,R=!1,k=new ic({Yo:D=>{R?N(Pt,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(y||(N(Pt,`Opening RPC '${t}' stream ${s} transport.`),g.open(),y=!0),N(Pt,`RPC '${t}' stream ${s} sending:`,D),g.send(D))},Zo:()=>g.close()}),x=(D,U,z)=>{D.listen(U,j=>{try{z(j)}catch(Z){setTimeout(()=>{throw Z},0)}})};return x(g,Fn.EventType.OPEN,()=>{R||(N(Pt,`RPC '${t}' stream ${s} transport opened.`),k.o_())}),x(g,Fn.EventType.CLOSE,()=>{R||(R=!0,N(Pt,`RPC '${t}' stream ${s} transport closed`),k.a_(),this.E_(g))}),x(g,Fn.EventType.ERROR,D=>{R||(R=!0,zt(Pt,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),k.a_(new C(A.UNAVAILABLE,"The operation could not be completed")))}),x(g,Fn.EventType.MESSAGE,D=>{if(!R){let U=D.data[0];q(!!U,16349);let z=U,j=z?.error||z[0]?.error;if(j){N(Pt,`RPC '${t}' stream ${s} received error:`,j);let Z=j.status,Y=(function(p){let w=pt[p];if(w!==void 0)return dm(w)})(Z),J=j.message;Y===void 0&&(Y=A.INTERNAL,J="Unknown error status: "+Z+" with message "+j.message),R=!0,k.a_(new C(Y,J)),g.close()}else N(Pt,`RPC '${t}' stream ${s} received:`,U),k.u_(U)}}),x(u,Ra.STAT_EVENT,D=>{D.stat===fi.PROXY?N(Pt,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===fi.NOPROXY&&N(Pt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{k.__()},0),k}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}};Cs=class{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();let e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&N("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};Wd="PersistentStream",lo=class{constructor(t,e,n,s,i,a,u,c){this.Mi=t,this.S_=n,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Cs(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return V(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}k_(){return V(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return V(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===A.RESOURCE_EXHAUSTED?(dt(e.toString()),dt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===A.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.r_(e)})}K_(){}auth(){this.state=1;let t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.D_===e&&this.G_(n,s)},n=>{t(()=>{let s=new C(A.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)})})}G_(t,e){let n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{n(()=>this.z_(s))}),this.stream.onMessage(s=>{n(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(()=>V(this,null,function*(){this.state=0,this.start()}))}z_(t){return N(Wd,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(N(Wd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ac=class extends lo{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();let e=uy(this.serializer,t),n=(function(i){if(!("targetChange"in i))return B.min();let a=i.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?ft(a.readTime):B.min()})(t);return this.listener.H_(e,n)}Y_(t){let e={};e.database=vu(this.serializer),e.addTarget=(function(i,a){let u,c=a.target;if(u=qi(c)?{documents:wm(i,c)}:{query:Fo(i,c).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=mm(i,a.resumeToken);let h=Iu(i,a.expectedCount);h!==null&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(B.min())>0){u.readTime=dr(i,a.snapshotVersion.toTimestamp());let h=Iu(i,a.expectedCount);h!==null&&(u.expectedCount=h)}return u})(this.serializer,t);let n=ly(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){let e={};e.database=vu(this.serializer),e.removeTarget=t,this.q_(e)}},uc=class extends lo{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return q(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){q(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();let e=cy(t.writeResults,t.commitTime),n=ft(t.commitTime);return this.listener.na(n,e)}ra(){let t={};t.database=vu(this.serializer),this.q_(t)}ea(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Ss(this.serializer,n))};this.q_(e)}};cc=class{},lc=class extends cc{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new C(A.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Go(t,Eu(e,n),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new C(A.UNKNOWN,i.toString())})}Ho(t,e,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Ho(t,Eu(e,n),s,a,u,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(A.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},hc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(dt(e),this.aa=!1):N("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};vn="RemoteStore",dc=class{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(a=>{n.enqueueAndForget(()=>V(this,null,function*(){Ye(this)&&(N(vn,"Restarting streams for network reachability change."),yield(function(c){return V(this,null,function*(){let h=M(c);h.Ea.add(4),yield Ar(h),h.Ra.set("Unknown"),h.Ea.delete(4),yield $s(h)})})(this))}))}),this.Ra=new hc(n,s)}};mc=class r{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Tt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){let a=Date.now()+n,u=new r(t,e,a,s,i);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new C(A.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};xs=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||F.comparator(e.key,n.key):(e,n)=>F.comparator(e.key,n.key),this.keyedMap=Yr(),this.sortedSet=new ot(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};fo=class{constructor(){this.ga=new ot(F.comparator)}track(t){let e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):L(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){let t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}},An=class r{constructor(t,e,n,s,i,a,u,c,h){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(t,e,n,s,i){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,xs.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&zs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}};gc=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}},pc=class{constructor(){this.queries=Jd(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){let s=M(e),i=s.queries;s.queries=Jd(),i.forEach((a,u)=>{for(let c of u.Sa)c.onError(n)})})(this,new C(A.ABORTED,"Firestore shutting down"))}};(Xd=yc||(yc={})).Ma="default",Xd.Cache="cache";Ds=class{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){let n=[];for(let s of t.docChanges)s.type!==3&&n.push(s);t=new An(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;let n=e!=="Offline";return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;let e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=An.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==yc.Cache}};mo=class{constructor(t,e){this.Qa=t,this.byteLength=e}$a(){return"metadata"in this.Qa}};go=class{constructor(t){this.serializer=t}$s(t){return se(this.serializer,t)}Us(t){return t.metadata.exists?Oo(this.serializer,t.document,!1):Et.newNoDocument(this.$s(t.metadata.name),this.Ks(t.metadata.readTime))}Ks(t){return ft(t)}},Ns=class{constructor(t,e){this.Ua=t,this.serializer=e,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=Ym(t)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.Qa.namedQuery)this.Ka.push(t.Qa.namedQuery);else if(t.Qa.documentMetadata){this.Wa.push({metadata:t.Qa.documentMetadata}),t.Qa.documentMetadata.exists||++e;let n=W.fromString(t.Qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.Qa.document&&(this.Wa[this.Wa.length-1].document=t.Qa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Gt({},this.progress)):null}za(t){let e=new Map,n=new go(this.serializer);for(let s of t)if(s.metadata.queries){let i=n.$s(s.metadata.name);for(let a of s.metadata.queries){let u=(e.get(a)||K()).add(i);e.set(a,u)}}return e}ja(t){return V(this,null,function*(){let e=yield Ey(t,new go(this.serializer),this.Wa,this.Ua.id),n=this.za(this.documents);for(let s of this.Ka)yield vy(t,s,n.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:e}})}};po=class{constructor(t){this.key=t}},yo=class{constructor(t){this.key=t}},_o=class{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=K(),this.mutatedKeys=K(),this.eu=Zf(t),this.tu=new xs(this.eu)}get nu(){return this.Ya}ru(t,e){let n=e?e.iu:new fo,s=e?e.tu:this.tu,i=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1,c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((f,g)=>{let y=s.get(f),R=Ks(this.query,g)?g:null,k=!!y&&this.mutatedKeys.has(y.key),x=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),D=!1;y&&R?y.data.isEqual(R.data)?k!==x&&(n.track({type:3,doc:R}),D=!0):this.su(y,R)||(n.track({type:2,doc:R}),D=!0,(c&&this.eu(R,c)>0||h&&this.eu(R,h)<0)&&(u=!0)):!y&&R?(n.track({type:0,doc:R}),D=!0):y&&!R&&(n.track({type:1,doc:y}),D=!0,(c||h)&&(u=!0)),D&&(R?(a=a.add(R),i=x?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Cs:u,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){let i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;let a=t.iu.ya();a.sort((f,g)=>(function(R,k){let x=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Rt:D})}};return x(R)-x(k)})(f.type,g.type)||this.eu(f.doc,g.doc)),this.ou(n),s=s??!1;let u=e&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,h=c!==this.Za;return this.Za=c,a.length!==0||h?{snapshot:new An(this.query,t.tu,i,a,t.mutatedKeys,c===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new fo,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=t.current)}_u(){if(!this.current)return[];let t=this.Xa;this.Xa=K(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});let e=[];return t.forEach(n=>{this.Xa.has(n)||e.push(new yo(n))}),this.Xa.forEach(n=>{t.has(n)||e.push(new po(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=K();let e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return An.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},Ze="SyncEngine",_c=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},wc=class{constructor(t){this.key=t,this.hu=!1}},Tc=class{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Wt(u=>Xf(u),zs),this.Iu=new Map,this.Eu=new Set,this.du=new ot(F.comparator),this.Au=new Map,this.Ru=new Rs,this.Vu={},this.mu=new Map,this.fu=mr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};Bo=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=Cn(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,n){return null}Mu(e,n){return null}vu(e){return Om(this.persistence,new so,e.initialUser,this.serializer)}Cu(e){return new Ps(no.mi,this.serializer)}Du(e){return new uo}terminate(){return V(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),ks=class extends Bo{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){q(this.persistence.referenceDelegate instanceof ro,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new Zi(n,t.asyncQueue,e)}Cu(t){let e=this.cacheSizeBytes!==void 0?Mt.withCacheSize(this.cacheSizeBytes):Mt.DEFAULT;return new Ps(n=>ro.mi(n,e),this.serializer)}},Ms=class r extends Bo{constructor(t,e,n){super(),this.xu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){yield _a(r.prototype,this,"initialize").call(this,t),yield this.xu.initialize(this,t),yield El(this.xu.syncEngine),yield Sr(this.xu.remoteStore),yield this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(t){return Om(this.persistence,new so,t.initialUser,this.serializer)}Fu(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new Zi(n,t.asyncQueue,e)}Mu(t,e){let n=new Ja(e,this.persistence);return new Ha(t.asyncQueue,n)}Cu(t){let e=ll(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Mt.withCacheSize(this.cacheSizeBytes):Mt.DEFAULT;return new Xu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,$m(),Ri(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(t){return new uo}},wo=class r extends Ms{constructor(t,e){super(t,e,!1),this.xu=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return V(this,null,function*(){yield _a(r.prototype,this,"initialize").call(this,t);let e=this.xu.syncEngine;this.sharedClientState instanceof as&&(this.sharedClientState.syncEngine={Co:Xy.bind(null,e),vo:t_.bind(null,e),Fo:e_.bind(null,e),Ts:Zy.bind(null,e),Do:Jy.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.Ji(n=>V(this,null,function*(){yield Yy(this.xu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Du(t){let e=$m();if(!as.v(e))throw new C(A.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=ll(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new as(e,t.asyncQueue,n,t.clientId,t.initialUser)}},Pr=(()=>{class r{initialize(e,n){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Yd(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Qy.bind(null,this.syncEngine),yield fc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return(function(){return new pc})()}createDatastore(e){let n=Cn(e.databaseInfo.databaseId),s=(function(a){return new oc(a)})(e.databaseInfo);return(function(a,u,c,h){return new lc(a,u,c,h)})(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return(function(s,i,a,u,c){return new dc(s,i,a,u,c)})(this.localStore,this.datastore,e.asyncQueue,n=>Yd(this.syncEngine,n,0),(function(){return co.v()?new co:new nc})())}createSyncEngine(e,n){return(function(i,a,u,c,h,f,g){let y=new Tc(i,a,u,c,h,f);return g&&(y.gu=!0),y})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return V(this,null,function*(){yield(function(n){return V(this,null,function*(){let s=M(n);N(vn,"RemoteStore shutting down."),s.Ea.add(5),yield Ar(s),s.Aa.shutdown(),s.Ra.set("Unknown")})})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return r.provider={build:()=>new r},r})();wr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):dt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}};Ec=class{constructor(t,e){this.Bu=t,this.serializer=e,this.metadata=new Tt,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then(n=>{n&&n.$a()?this.metadata.resolve(n.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.Qa)}`))},n=>this.metadata.reject(n))}close(){return this.Bu.cancel()}getMetadata(){return V(this,null,function*(){return this.metadata.promise})}bu(){return V(this,null,function*(){return yield this.getMetadata(),this.ku()})}ku(){return V(this,null,function*(){let t=yield this.qu();if(t===null)return null;let e=this.Lu.decode(t),n=Number(e);isNaN(n)&&this.Qu(`length string (${e}) is not valid number`);let s=yield this.$u(n);return new mo(JSON.parse(s),t.length+n)})}Uu(){return this.buffer.findIndex(t=>t===123)}qu(){return V(this,null,function*(){for(;this.Uu()<0&&!(yield this.Ku()););if(this.buffer.length===0)return null;let t=this.Uu();t<0&&this.Qu("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}$u(t){return V(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ku())&&this.Qu("Reached the end of bundle when more is expected.");let e=this.Lu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}Qu(t){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${t}`)}Ku(){return V(this,null,function*(){let t=yield this.Bu.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};vc=class{constructor(t,e){this.bundleData=t,this.serializer=e,this.cursor=0,this.elements=[];let n=this.bu();if(!n||!n.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.Qa)}`);this.metadata=n;do n=this.bu(),n!==null&&this.elements.push(n);while(n!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;let t=this.qu(),e=this.$u(t);return new mo(JSON.parse(e),t)}$u(t){if(this.cursor+t>this.bundleData.length)throw new C(A.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=t)}qu(){let t=this.cursor,e=this.cursor;for(;e<this.bundleData.length;){if(this.bundleData[e]==="{"){if(e===t)throw new Error("First character is a bracket and not a number");return this.cursor=e,Number(this.bundleData.slice(t,e))}e++}throw new Error("Reached the end of bundle when more is expected.")}};Ac=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new C(A.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield(function(s,i){return V(this,null,function*(){let a=M(s),u={documents:i.map(g=>As(a.serializer,g))},c=yield a.Ho("BatchGetDocuments",a.serializer.databaseId,W.emptyPath(),u,i.length),h=new Map;c.forEach(g=>{let y=ay(a.serializer,g);h.set(y.key.toString(),y)});let f=[];return i.forEach(g=>{let y=h.get(g.toString());q(!!y,55234,{key:g}),f.push(y)}),f})})(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new $e(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let s=F.fromPath(n);this.mutations.push(new ws(s,this.precondition(s)))}),yield(function(n,s){return V(this,null,function*(){let i=M(n),a={writes:s.map(u=>Ss(i.serializer,u))};yield i.Go("Commit",i.serializer.databaseId,W.emptyPath(),a)})})(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L(50498,{Gu:t.constructor.name});e=B.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new C(A.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(B.min())?ht.exists(!1):ht.updateTime(e):ht.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(B.min()))throw new C(A.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ht.updateTime(e)}return ht.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};Sc=class{constructor(t,e,n,s,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=s,this.deferred=i,this.zu=n.maxAttempts,this.M_=new Cs(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(()=>V(this,null,function*(){let t=new Ac(this.datastore),e=this.Hu(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(s=>{this.Yu(s)}))}).catch(n=>{this.Yu(n)})}))}Hu(t){try{let e=this.updateFunction(t);return!Bs(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Yu(t){this.zu>0&&this.Zu(t)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(t)}Zu(t){if(t?.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!hm(e)}return!1}};We="FirestoreClient",bc=class{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=_t.UNAUTHENTICATED,this.clientId=cs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,a=>V(this,null,function*(){N(We,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(N(We,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Tt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=Rr(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};nf=new Map;lg="firestore.googleapis.com",rf=!0,To=class{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new C(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lg,this.ssl=rf}else this.host=t.host,this.ssl=t.ssl??rf;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Pm;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Dm)throw new C(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}fp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cg(t.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new C(A.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new C(A.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new C(A.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Sn=class{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new To({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new C(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new To(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new La;switch(n.type){case"firstParty":return new ja(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){let n=nf.get(e);n&&(N("ComponentProvider","Removing Datastore"),nf.delete(e),n.terminate())})(this),Promise.resolve()}};bt=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},it=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ie(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Vn(e,r._jsonSchema))return new r(t,n||null,new F(W.fromString(e.referencePath)))}};it._jsonSchemaVersion="firestore/documentReference/1.0",it._jsonSchema={type:wt("string",it._jsonSchemaVersion),referencePath:wt("string")};ie=class r extends bt{constructor(t,e,n){super(t,e,vr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new it(this.firestore,null,new F(t))}withConverter(t){return new r(this.firestore,t,this._path)}};sf="AsyncQueue",Io=class{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Cs(this,"async_queue_retry"),this._c=()=>{let n=Ri();n&&N(sf,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;let e=Ri();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;let e=Ri();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});let e=new Tt;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}lc(){return V(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Je(t))throw t;N(sf,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(t){let e=this.ac.then(()=>(this.rc=!0,t().catch(n=>{throw this.nc=n,this.rc=!1,dt("INTERNAL UNHANDLED ERROR: ",of(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);let s=mc.createAndSchedule(this,t,e,n,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&L(47125,{Pc:of(this.nc)})}verifyOperationInProgress(){}Tc(){return V(this,null,function*(){let t;do t=this.ac,yield t;while(t!==this.ac)})}Ic(t){for(let e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){let e=this.tc.indexOf(t);this.tc.splice(e,1)}};Rc=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Tt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};j_=-1,et=class extends Sn{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Io,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Io(t),this._firestoreClient=void 0,yield t}})}};bn=class{constructor(t="count",e){this._internalFieldPath=e,this.type="AggregateField",this.aggregateType=t}},Pc=class{constructor(t,e,n){this._userDataWriter=e,this._data=n,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._userDataWriter.convertObjectMap(this._data)}};fe=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(mt.fromBase64String(t))}catch(e){throw new C(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(mt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Vn(t,r._jsonSchema))return r.fromBase64String(t.bytes)}};fe._jsonSchemaVersion="firestore/bytes/1.0",fe._jsonSchema={type:wt("string",fe._jsonSchemaVersion),bytes:wt("string")};we=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new C(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new It(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};Te=class{constructor(t){this._methodName=t}};Fe=class r{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return G(this._lat,t._lat)||G(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(t){if(Vn(t,r._jsonSchema))return new r(t.latitude,t.longitude)}};Fe._jsonSchemaVersion="firestore/geoPoint/1.0",Fe._jsonSchema={type:wt("string",Fe._jsonSchemaVersion),latitude:wt("number"),longitude:wt("number")};me=class r{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return(function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0})(this._values,t._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Vn(t,r._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new r(t.vectorValues);throw new C(A.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};me._jsonSchemaVersion="firestore/vectorValue/1.0",me._jsonSchema={type:wt("string",me._jsonSchemaVersion),vectorValues:wt("object")};y_=/^__.*__$/,Vc=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Ht(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ke(t,this.data,e,this.fieldTransforms)}},Eo=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Ht(t,this.data,this.fieldMask,e,this.fieldTransforms)}};vo=class r{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new r(Gt(Gt({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){let e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){let e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Ao(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(mg(this.Ac)&&y_.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}},Cc=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Cn(t)}Cc(t,e,n,s=!1){return new vo({Ac:t,methodName:e,Dc:n,path:It.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};Os=class r extends Te{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};xc=class r extends Te{_toFieldTransform(t){return new Tn(t.path,new Ge)}isEqual(t){return t instanceof r}},Dc=class r extends Te{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=gg(this,t,!0),n=this.vc.map(i=>Dn(i,e)),s=new ye(n);return new Tn(t.path,s)}isEqual(t){return t instanceof r&&On(this.vc,t.vc)}},Nc=class r extends Te{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=gg(this,t,!0),n=this.vc.map(i=>Dn(i,e)),s=new _e(n);return new Tn(t.path,s)}isEqual(t){return t instanceof r&&On(this.vc,t.vc)}},kc=class r extends Te{constructor(t,e){super(t),this.Fc=e}_toFieldTransform(t){let e=new ze(t.serializer,sm(t.serializer,this.Fc));return new Tn(t.path,e)}isEqual(t){return t instanceof r&&this.Fc===t.Fc}};__=new RegExp("[~\\*/\\[\\]]");Rn=class{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new it(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Mc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Ko("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Mc=class extends Rn{data(){return super.data()}};Ls=class{},Pn=class extends Ls{};qs=class r extends Pn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return Eg(t._query,e),new bt(t.firestore,t.converter,fu(t._query,e))}_parse(t){let e=xn(t.firestore);return(function(i,a,u,c,h,f,g){let y;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new C(A.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){cf(g,f);let k=[];for(let x of g)k.push(uf(c,i,x));y={arrayValue:{values:k}}}else y=uf(c,i,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||cf(g,f),y=pg(u,a,g,f==="in"||f==="not-in");return H.create(h,f,y)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};Ir=class r extends Ls{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:((function(s,i){let a=s,u=i.getFlattenedFilters();for(let c of u)Eg(a,c),a=fu(a,c)})(t._query,e),new bt(t.firestore,t.converter,fu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};Oc=class r extends Pn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=(function(s,i,a){if(s.startAt!==null)throw new C(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new C(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _n(i,a)})(t._query,this._field,this._direction);return new bt(t.firestore,t.converter,(function(s,i){let a=s.explicitOrderBy.concat([i]);return new Qt(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(t._query,e))}};So=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new bt(t.firestore,t.converter,Bi(t._query,this._limit,this._limitType))}};bo=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Ig(t,this.type,this._docOrFields,this._inclusive);return new bt(t.firestore,t.converter,(function(s,i){return new Qt(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)})(t._query,e))}};Ro=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Ig(t,this.type,this._docOrFields,this._inclusive);return new bt(t.firestore,t.converter,(function(s,i){return new Qt(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)})(t._query,e))}};Po=class{convertValue(t,e="none"){switch(Be(t)){case 0:return null;case 1:return t.booleanValue;case 2:return at(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(pe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return Xe(t,(s,i)=>{n[s]=this.convertValue(i,e)}),n}convertVectorValue(t){let e=t.fields?.[ar].arrayValue?.values?.map(n=>at(n.doubleValue));return new me(e)}convertGeoPoint(t){return new Fe(at(t.latitude),at(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=ko(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(gs(t));default:return null}}convertTimestamp(t){let e=ge(t);return new ut(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=W.fromString(t);q(Am(n),9688,{name:t});let s=new or(n.get(1),n.get(3)),i=new F(n.popFirst(5));return s.isEqual(e)||dt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}};Us=class extends Po{constructor(t){super(),this.firestore=t}convertBytes(t){return new fe(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new it(this.firestore,null,e)}};Ag="NOT SUPPORTED",ne=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Bt=class r extends Rn{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Yn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(Ko("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new C(A.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=r._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};Bt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Bt._jsonSchema={type:wt("string",Bt._jsonSchemaVersion),bundleSource:wt("string","DocumentSnapshot"),bundleName:wt("string"),bundle:wt("string")};Yn=class extends Bt{data(t={}){return super.data(t)}},jt=class r{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new ne(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Yn(this._firestore,this._userDataWriter,n.key,n,new ne(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(u=>{let c=new Yn(s._firestore,s._userDataWriter,u.doc.key,u.doc,new ne(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||u.type!==3).map(u=>{let c=new Yn(s._firestore,s._userDataWriter,u.doc.key,u.doc,new ne(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),h=-1,f=-1;return u.type!==0&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:T_(u.type),doc:c,oldIndex:h,newIndex:f}})}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new C(A.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=r._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=cs.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],n=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};jt._jsonSchemaVersion="firestore/querySnapshot/1.0",jt._jsonSchema={type:wt("string",jt._jsonSchemaVersion),bundleSource:wt("string","QuerySnapshot"),bundleName:wt("string"),bundle:wt("string")};ue=class extends Po{constructor(t){super(),this.firestore=t}convertBytes(t){return new fe(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new it(this.firestore,null,e)}};Fc=class{constructor(t){this.kind="memory",this._onlineComponentProvider=Pr.provider,this._offlineComponentProvider=t?.garbageCollector?t.garbageCollector._offlineComponentProvider:{build:()=>new ks(void 0)}}toJSON(){return{kind:this.kind}}},Lc=class{constructor(t){let e;this.kind="persistent",t?.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=E_(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}},qc=class{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Bo.provider}toJSON(){return{kind:this.kind}}},Uc=class{constructor(t){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new ks(t)}}toJSON(){return{kind:this.kind}}};Bc=class{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=Pr.provider,this._offlineComponentProvider={build:e=>new Ms(e,t?.cacheSizeBytes,this.forceOwnership)}}},jc=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=Pr.provider,this._offlineComponentProvider={build:e=>new wo(e,t?.cacheSizeBytes)}}};v_={maxAttempts:5};Gc=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=xn(t)}set(t,e,n){this._verifyNotCommitted();let s=Me(t,this._firestore),i=$o(s.converter,e,n),a=Go(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(a.toMutation(s._key,ht.none())),this}update(t,e,n,...s){this._verifyNotCommitted();let i=Me(t,this._firestore),a;return a=typeof(e=gt(e))=="string"||e instanceof we?bl(this._dataReader,"WriteBatch.update",i._key,e,n,s):Sl(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(a.toMutation(i._key,ht.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Me(t,this._firestore);return this._mutations=this._mutations.concat(new $e(e._key,ht.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(A.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};zc=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=xn(t)}get(t){let e=Me(t,this._firestore),n=new Us(this._firestore);return this._transaction.lookup([e._key]).then(s=>{if(!s||s.length!==1)return L(24041);let i=s[0];if(i.isFoundDocument())return new Rn(this._firestore,n,i.key,i,e.converter);if(i.isNoDocument())return new Rn(this._firestore,n,e._key,null,e.converter);throw L(18433,{doc:i})})}set(t,e,n){let s=Me(t,this._firestore),i=$o(s.converter,e,n),a=Go(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,n);return this._transaction.set(s._key,a),this}update(t,e,n,...s){let i=Me(t,this._firestore),a;return a=typeof(e=gt(e))=="string"||e instanceof we?bl(this._dataReader,"Transaction.update",i._key,e,n,s):Sl(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,a),this}delete(t){let e=Me(t,this._firestore);return this._transaction.delete(e._key),this}};Kc=class extends zc{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Me(t,this._firestore),n=new ue(this._firestore);return super.get(t).then(s=>new Bt(this._firestore,n,e._key,s._document,new ne(!1,!1),e.converter))}};$c=class{constructor(t){this._firestore=t,this.type="PersistentCacheIndexManager"}};df=new WeakMap;ff=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(t){return Qc.instance.onExistenceFilterMismatch(t)}},Qc=class r{constructor(){this.Mc=new Map}static get instance(){return wi||(wi=new r,(function(e){if(yu)throw new Error("a TestingHooksSpi instance is already set");yu=e})(wi)),wi}lt(t){this.Mc.forEach(e=>e(t))}onExistenceFilterMismatch(t){let e=Symbol(),n=this.Mc;return n.set(e,t),()=>n.delete(e)}},wi=null;(function(t,e=!0){(function(s){Er=s})(jh),qh(new Fh("firestore",(n,{instanceIdentifier:s,options:i})=>{let a=n.getProvider("app").getImmediate(),u=new et(new Ua(n.getProvider("auth-internal")),new Ga(a,n.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new C(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new or(h.options.projectId,f)})(a,s),a);return i=Gt({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),va(Wh,Hh,t),va(Wh,Hh,"esm2020")})()});var A_=li(()=>{bg()});export{M_ as a,zt as b,O_ as c,C as d,La as e,Jh as f,cs as g,It as h,F as i,fp as j,Q as k,ut as l,L_ as m,mt as n,or as o,m_ as p,bt as q,it as r,ie as s,q_ as t,U_ as u,g_ as v,B_ as w,hg as x,Rc as y,j_ as z,et as A,G_ as B,z_ as C,ct as D,K_ as E,$_ as F,Q_ as G,W_ as H,H_ as I,J_ as J,X_ as K,af as L,p_ as M,bn as N,Pc as O,fe as P,we as Q,Y_ as R,Te as S,Fe as T,me as U,Pn as V,Z_ as W,qs as X,tw as Y,Ir as Z,ew as _,nw as $,Oc as aa,rw as ba,So as ca,sw as da,iw as ea,bo as fa,ow as ga,aw as ha,Ro as ia,uw as ja,cw as ka,Po as la,lw as ma,hw as na,w_ as oa,dw as pa,fw as qa,ne as ra,Bt as sa,mw as ta,Yn as ua,jt as va,gw as wa,pw as xa,yw as ya,_w as za,ww as Aa,Tw as Ba,Iw as Ca,Ew as Da,vw as Ea,Aw as Fa,Sw as Ga,bw as Ha,lf as Ia,Rw as Ja,Pw as Ka,Qs as La,Vw as Ma,I_ as Na,Cw as Oa,xw as Pa,Dw as Qa,Nw as Ra,E_ as Sa,kw as Ta,Gc as Ua,Kc as Va,Mw as Wa,Ow as Xa,Fw as Ya,Lw as Za,qw as _a,Uw as $a,Bw as ab,jw as bb,Gw as cb,$c as db,zw as eb,Kw as fb,$w as gb,Qw as hb,Ww as ib,Hw as jb,ff as kb,A_ as lb};
